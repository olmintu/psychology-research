<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #3498db; --success: #27ae60; --warning: #f39c12; --error: #e74c3c; --bg: #f4f6f8; --info-bg: #ebf5fb; --gray: #95a5a6; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); color: #333; margin: 0; padding: 15px; line-height: 1.5; }
        
        .container { max-width: 900px; margin: 0 auto; background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        
        h1 { font-size: 1.6rem; text-align: center; color: #2c3e50; margin-bottom: 10px; }
        h2 { font-size: 1.3rem; color: #34495e; margin-top: 0; text-align: center; margin-bottom: 15px; }
        h3 { color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 5px; margin-top: 30px; }
        
        .instruction { background-color: var(--info-bg); border-left: 5px solid var(--primary); padding: 15px; border-radius: 4px; margin-bottom: 25px; font-size: 0.95rem; color: #2c3e50; line-height: 1.6; }
        .instruction ul { margin: 5px 0 10px 20px; padding: 0; }
        
        .anon-switch { background: #fff3cd; border: 1px solid #ffeeba; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: flex-start; gap: 10px; }
        .anon-switch input { width: 20px; height: 20px; margin-top: 3px; }
        .anon-warning { font-size: 0.85em; color: #856404; margin-top: 5px; display: none; }
        
        .step { display: none; opacity: 0; transition: opacity 0.3s ease; }
        .step.active { display: block; opacity: 1; }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 0.9rem; color: #555; }
        input[type="text"], input[type="number"], select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; background: #fff; appearance: none; }
        input:disabled, select:disabled { background-color: #f9f9f9; color: #aaa; border-color: #eee; }
        
        .btn-container { display: flex; gap: 15px; margin-top: 25px; }
        .btn { flex: 1; padding: 16px; border: none; border-radius: 10px; font-size: 17px; font-weight: 600; cursor: pointer; transition: transform 0.1s; color: white; }
        .btn:active { transform: scale(0.98); opacity: 0.9; }
        .btn-next { background-color: var(--primary); }
        .btn-back { background-color: var(--gray); }
        .btn-success { background-color: var(--success); }
        .btn-secondary { background-color: #95a5a6; margin-top: 10px; width: 100%; padding: 12px; }
        .btn-red { background-color: #dc3545; margin-top: 10px; width: 100%; padding: 12px; }
        .option-card { border: 2px solid #eee; padding: 12px; margin-bottom: 8px; border-radius: 10px; display: flex; align-items: center; cursor: pointer; transition: all 0.2s; background: #fff; }
        .option-card input { width: 22px; height: 22px; margin-right: 15px; flex-shrink: 0; }
        .option-card.checked { border-color: var(--primary); background-color: #f0f9ff; }

        .error-msg { color: #fff; background: var(--error); padding: 12px; border-radius: 8px; margin-top: 20px; text-align: center; display: none; font-weight: bold; }
        .highlight-error { border: 2px solid var(--error) !important; background-color: #fff5f5 !important; }

        table { width: 100%; border-collapse: collapse; margin-bottom: 40px; }
        th, td { padding: 12px; text-align: center; border-bottom: 1px solid #eee; vertical-align: middle; }
        th { background: #f8f9fa; font-size: 0.85rem; color: #333; position: sticky; top: 0; z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        td:first-child { text-align: left; font-weight: 500; font-size: 0.95rem; width: 45%; }
        
        .res-block { background: #fff; border: 1px solid #eee; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .score-badge { display: inline-block; padding: 5px 10px; border-radius: 15px; font-weight: bold; font-size: 0.9em; }
        .bg-green { background: #d4edda; color: #155724; }
        .bg-red { background: #f8d7da; color: #721c24; }
        .bg-blue { background: #d1ecf1; color: #0c5460; }
        canvas { max-height: 300px; margin-top: 15px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .dl-section { background: #f0f7fb; border: 2px dashed #3498db; padding: 20px; text-align: center; border-radius: 10px; margin-bottom: 30px; }
        #result-area { width: 100%; height: 80px; margin-top: 10px; font-size: 12px; padding: 10px; border: 1px solid #ddd; display: none; }

        /* DEV TOOLS */
        #dev-panel { display: none; background: #333; color: #fff; padding: 15px; border-radius: 8px; margin-top: 15px; }
        #dev-json-input { width: 100%; height: 100px; margin-top: 10px; font-family: monospace; font-size: 12px; color: #333; }
        .dev-btn { background: #555; border: 1px solid #777; color: white; padding: 8px 15px; cursor: pointer; border-radius: 4px; font-size: 0.9em; margin-right: 10px; }
        .dev-btn:hover { background: #666; }

        @media (max-width: 600px) {
            .container { padding: 15px; }
            th { font-size: 0.7rem; padding: 5px; }
            td { padding: 10px 2px; }
            td:first-child { font-size: 0.9rem; width: 100%; display: block; border-bottom: none; padding-bottom: 5px; color: var(--primary); font-weight: 600; }
            tr { display: block; border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 10px; }
            td:not(:first-child) { display: inline-block; width: 22%; border: none; }
            thead { display: none; } 
            td:not(:first-child)::before { content: attr(data-label); display: block; font-size: 0.7em; color: #888; margin-bottom: 5px; }
            input[type="radio"] { width: 24px; height: 24px; margin: 0; }
        }
        
        .progress-bar { height: 6px; background: #e9ecef; border-radius: 3px; margin-bottom: 20px; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }
    </style>
</head>
<body>

<div class="container">
    <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>

    <!-- –ê–ù–ö–ï–¢–ê -->
    <div class="step active" id="step-form">
        <h1>–ê–Ω–∫–µ—Ç–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞</h1>
        <div class="instruction">
            –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –í–∞–º –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ –≤ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏.<br>
            –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ <b>—Ç–æ–ª—å–∫–æ –≤ –æ–±–æ–±—â–µ–Ω–Ω–æ–º –≤–∏–¥–µ</b>.
        </div>
        
        <div class="anon-switch">
            <input type="checkbox" id="anon_mode" onchange="toggleAnon(); saveStateToLocal();">
            <div>
                <label for="anon_mode" style="margin:0; cursor:pointer;"><b>–ü—Ä–æ–π—Ç–∏ –æ–ø—Ä–æ—Å –∞–Ω–æ–Ω–∏–º–Ω–æ</b></label>
                <div class="anon-warning" id="anon_warning">
                    –°–≤–µ–¥–µ–Ω–∏—è –æ–± —É—á–∞—Å—Ç–Ω–∏–∫–µ –ø–æ–º–æ–≥–∞—é—Ç –ø–æ–Ω—è—Ç—å, –¥–ª—è –∫–∞–∫–∏—Ö –≥—Ä—É–ø–ø –ª—é–¥–µ–π –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã –≤ –±–æ–ª—å—à–µ–π —Å—Ç–µ–ø–µ–Ω–∏. 
                    –û—Ç–∫–∞–∑ –æ—Ç –∏—Ö —É–∫–∞–∑–∞–Ω–∏—è –ø—Ä–∏ –∞–Ω–æ–Ω–∏–º–Ω–æ–º –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ –º–æ–∂–µ—Ç —É–º–µ–Ω—å—à–∏—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å –∏ –æ–±–æ–±—â–∞–µ–º–æ—Å—Ç—å –≤—ã–≤–æ–¥–æ–≤ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.
                </div>
            </div>
        </div>

        <div class="form-group"><label>–í–∞—à–µ –∏–º—è (–∏–ª–∏ –ø—Å–µ–≤–¥–æ–Ω–∏–º): <span class="req">*</span></label><input type="text" id="fio" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω" onkeyup="checkDevMode(this.value)"></div>
        
        <!-- DEV TOOLS -->
        <div id="dev-panel">
            <div style="font-weight:bold; margin-bottom:10px;">üõ†Ô∏è –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</div>
            <div style="display:flex; align-items:center;">
                <button class="dev-btn" onclick="fillRandomData()">üé≤ –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å–ª—É—á–∞–π–Ω–æ</button>
                <button class="dev-btn" onclick="document.getElementById('dev-import').style.display='block'">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å JSON</button>
            </div>
            <div id="dev-import" style="display:none; margin-top:10px;">
                <textarea id="dev-json-input" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ JSON —Å—é–¥–∞..."></textarea>
                <button class="dev-btn" style="margin-top:5px; background:#27ae60" onclick="loadDevJSON()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                <div id="dev-error" style="color:#e74c3c; font-size:0.9em; margin-top:5px;"></div>
            </div>
        </div>

        <div style="display: flex; gap: 10px;">
            <div class="form-group" style="flex: 1;"><label>–ü–æ–ª: <span class="req">*</span></label><select id="gender" onchange="saveStateToLocal()"><option value="">–í—ã–±—Ä–∞—Ç—å...</option><option value="–ú—É–∂—Å–∫–æ–π">–ú—É–∂—Å–∫–æ–π</option><option value="–ñ–µ–Ω—Å–∫–∏–π">–ñ–µ–Ω—Å–∫–∏–π</option></select></div>
            <div class="form-group" style="flex: 1;"><label>–í–æ–∑—Ä–∞—Å—Ç: <span class="req">*</span></label><input type="number" id="age" placeholder="18" onchange="saveStateToLocal()"></div>
        </div>
        <div class="form-group"><label>–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: <span class="req">*</span></label><select id="family_status" onchange="saveStateToLocal()"><option value="">–í—ã–±—Ä–∞—Ç—å...</option><option value="–•–æ–ª–æ—Å—Ç/–ù–µ –∑–∞–º—É–∂–µ–º">–•–æ–ª–æ—Å—Ç / –ù–µ –∑–∞–º—É–∂–µ–º</option><option value="–ñ–µ–Ω–∞—Ç/–ó–∞–º—É–∂–µ–º">–ñ–µ–Ω–∞—Ç / –ó–∞–º—É–∂–µ–º</option><option value="–í —Ä–∞–∑–≤–æ–¥–µ">–í —Ä–∞–∑–≤–æ–¥–µ</option></select></div>
        <div class="form-group"><label>–ï—Å—Ç—å –ª–∏ –¥–µ—Ç–∏? <span class="req">*</span></label><select id="children" onchange="saveStateToLocal()"><option value="–ù–µ—Ç">–ù–µ—Ç</option><option value="–î–∞">–î–∞</option></select></div>
        <div class="form-group"><label>–†–∞–±–æ—Ç–∞–µ—Ç–µ –ª–∏ –í—ã? <span class="req">*</span></label><select id="is_working" onchange="toggleWorkPlace(); saveStateToLocal()"><option value="–ù–µ—Ç">–ù–µ—Ç</option><option value="–î–∞">–î–∞</option></select></div>
        <div class="form-group" id="work_place_block" style="display: none;"><label>–ì–¥–µ —Ä–∞–±–æ—Ç–∞–µ—Ç–µ? (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label><input type="text" id="work_place" onchange="saveStateToLocal()"></div>
        <div class="form-group"><label>–°—Ä–µ–¥–Ω–µ–µ —Å–ø–µ—Ü. –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ? <span class="req">*</span></label><select id="has_secondary_edu" onchange="saveStateToLocal()"><option value="–ù–µ—Ç">–ù–µ—Ç</option><option value="–î–∞">–î–∞</option></select></div>
        
        <div class="form-group"><label>–í–∞—à —Å—Ç–∞—Ç—É—Å –æ–±—É—á–µ–Ω–∏—è: <span class="req">*</span></label><select id="edu_status" onchange="toggleEduBlock(); saveStateToLocal()"><option value="">–í—ã–±—Ä–∞—Ç—å...</option><option value="–£—á—É—Å—å">–°—Ç—É–¥–µ–Ω—Ç (—É—á—É—Å—å —Å–µ–π—á–∞—Å)</option><option value="–ó–∞–∫–æ–Ω—á–∏–ª">–í—ã–ø—É—Å–∫–Ω–∏–∫ (—É–∂–µ –∑–∞–∫–æ–Ω—á–∏–ª)</option><option value="–ù–µ—Ç">–ù–µ —É—á–∏–ª—Å—è –≤ –í–£–ó–µ</option></select></div>
        <div id="edu_block" style="display: none; border-left: 3px solid #3498db; padding-left: 15px;">
            <div class="form-group"><label>–í–£–ó: <span class="req">*</span></label><input type="text" id="university" onchange="saveStateToLocal()"></div>
            <div class="form-group"><label>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å: <span class="req">*</span></label><input type="text" id="speciality" onchange="saveStateToLocal()"></div>
            <div style="display: flex; gap: 10px;">
                 <div class="form-group" style="flex: 1;"><label>–£—Ä–æ–≤–µ–Ω—å: <span class="req">*</span></label><select id="edu_level" onchange="saveStateToLocal()"><option value="–ë–∞–∫–∞–ª–∞–≤—Ä–∏–∞—Ç">–ë–∞–∫–∞–ª–∞–≤—Ä–∏–∞—Ç</option><option value="–ú–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞">–ú–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞</option><option value="–°–ø–µ—Ü–∏–∞–ª–∏—Ç–µ—Ç">–°–ø–µ—Ü–∏–∞–ª–∏—Ç–µ—Ç</option></select></div>
                 <div class="form-group" style="flex: 1;"><label>–û—Å–Ω–æ–≤–∞: <span class="req">*</span></label><select id="edu_basis" onchange="saveStateToLocal()"><option value="–ë—é–¥–∂–µ—Ç">–ë—é–¥–∂–µ—Ç</option><option value="–ü–ª–∞—Ç–Ω–æ–µ">–ü–ª–∞—Ç–Ω–æ–µ</option></select></div>
            </div>
            <div class="form-group" id="course_block"><label>–ö—É—Ä—Å: <span class="req">*</span></label><select id="course" onchange="saveStateToLocal()"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></div>
        </div>

        <div class="error-msg" id="form-error">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∏–ª–∏ –≤–∫–ª—é—á–∏—Ç–µ –ê–Ω–æ–Ω–∏–º–Ω—ã–π —Ä–µ–∂–∏–º!</div>
        <button class="btn btn-next" onclick="validateForm()">–ù–∞—á–∞—Ç—å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</button>
    </div>

    <!-- –ú–ï–¢–û–î–ò–ö–ê 1 -->
    <div class="step" id="step-bratus">
        <h2>1/3. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–µ —Å–º—ã—Å–ª—ã</h2>
        <div class="instruction">
            <p>–ü–µ—Ä–µ–¥ –≤–∞–º–∏ —Å–ø–∏—Å–æ–∫ –∏–∑ 24 —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π. –≠—Ç–æ –ø–µ—Ä–µ—á–µ–Ω—å –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–º—ã—Å–ª–æ–≤, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –ª—é–¥–∏.</p>
            <p>–í–∞–º –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç —Å–¥–µ–ª–∞—Ç—å –º—è–≥–∫—É—é —Ä–µ–π—Ç–∏–Ω–≥–æ–≤—É—é –æ—Ü–µ–Ω–∫—É –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞. –î–ª—è —ç—Ç–æ–≥–æ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ <b>—Ç—Ä–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</b>, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–Ω–∏–º–∞—é—Ç <b>1-–µ –º–µ—Å—Ç–æ</b> –≤ —Å–∏—Å—Ç–µ–º–µ –í–∞—à–∏—Ö –ª–∏—á–Ω—ã—Ö –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–º—ã—Å–ª–æ–≤, –∑–∞—Ç–µ–º —Ç—Ä–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –í—ã –º–æ–≥–ª–∏ –±—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ 2-–µ, –Ω–∞ 3-–µ –∏ —Ç.–¥. –¥–æ 8-–≥–æ –º–µ—Å—Ç–∞.</p>
        </div>
        <p style="text-align:center; font-weight:bold; color:#2980b9; margin-bottom:10px;" id="bratus-sub">–í—ã–±–µ—Ä–∏—Ç–µ 3 —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö</p>
        <div id="bratus-options"></div>
        <div class="error-msg" id="bratus-error">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–≤–Ω–æ 3 –ø—É–Ω–∫—Ç–∞!</div>
        <div class="btn-container"><button class="btn btn-back" onclick="prevBratusRank()">–ù–∞–∑–∞–¥</button><button class="btn btn-next" onclick="nextBratusRank()">–î–∞–ª–µ–µ</button></div>
    </div>

    <!-- –ú–ï–¢–û–î–ò–ö–ê 2 -->
    <div class="step" id="step-milman">
        <h2>2/3. –ú–æ—Ç–∏–≤–∞—Ü–∏—è</h2>
        <div class="instruction">
            <p>–ü–µ—Ä–µ–¥ –≤–∞–º–∏ 14 —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π, –∫–∞—Å–∞—é—â–∏—Ö—Å—è –≤–∞—à–∏—Ö –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–π –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å—Ç–æ—Ä–æ–Ω –≤–∞—à–µ–≥–æ –æ–±—Ä–∞–∑–∞ –∂–∏–∑–Ω–∏. –ü—Ä–æ—Å–∏–º –≤–∞—Å –≤—ã—Å–∫–∞–∑–∞—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –Ω–∏–º –ø–æ –∫–∞–∂–¥–æ–º—É –∏–∑ 8 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤, –ø—Ä–æ—Å—Ç–∞–≤–∏–≤ –æ–¥–Ω—É –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –æ—Ü–µ–Ω–æ–∫:</p>
            <ul><li><b>–¥–∞, —Å–æ–≥–ª–∞—Å–µ–Ω</b> </li><li><b>–ø–æ–∂–∞–ª—É–π —Å–æ–≥–ª–∞—Å–µ–Ω</b> </li><li><b>–∫–æ–≥–¥–∞ –∫–∞–∫, —Å–æ–≥–ª–∞—Å–µ–Ω –≤ –Ω–µ–∫–æ—Ç–æ—Ä–æ–π —Å—Ç–µ–ø–µ–Ω–∏</b> </li><li><b>–Ω–µ—Ç, –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω / –Ω–µ –∑–Ω–∞—é</b> </li></ul>
            <p>–°—Ç–∞—Ä–∞–π—Ç–µ—Å—å –æ—Ç–≤–µ—á–∞—Ç—å –±—ã—Å—Ç—Ä–æ, –Ω–µ –∑–∞–¥—É–º—ã–≤–∞–π—Ç–µ—Å—å –¥–æ–ª–≥–æ –Ω–∞–¥ –æ—Ç–≤–µ—Ç–∞–º–∏, –æ—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –æ—Ç 1 –¥–æ 14. –ù–∞ –≤—Å—é —Ä–∞–±–æ—Ç—É —É –≤–∞—Å –¥–æ–ª–∂–Ω–æ —É–π—Ç–∏ –Ω–µ –±–æ–ª–µ–µ 20 –º–∏–Ω—É—Ç.</p>
        </div>
        <div id="milman-container"></div>
        <div class="error-msg" id="milman-error">–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –ø–æ–¥—Å–≤–µ—á–µ–Ω–Ω—ã–µ –∫—Ä–∞—Å–Ω—ã–º!</div>
        <div class="btn-container"><button class="btn btn-back" onclick="prevMilman()">–ù–∞–∑–∞–¥</button><button class="btn btn-next" onclick="finishMilman()">–î–∞–ª–µ–µ</button></div>
    </div>

    <!-- –ú–ï–¢–û–î–ò–ö–ê 3 -->
    <div class="step" id="step-ipl">
        <h2>3/3. –ò–Ω–Ω–æ–≤–∞—Ü–∏–∏</h2>
        <div class="instruction">
            <p>–í–∞—à–µ–º—É –≤–Ω–∏–º–∞–Ω–∏—é –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è —Ä—è–¥ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏–π, –∫–∞–∂–¥–æ–µ –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–Ω–µ—Å—Ç–∏ –∫ —Å–µ–±–µ –∏ —Ä–µ—à–∏—Ç—å, –≤ –∫–∞–∫–æ–π –º–µ—Ä–µ –æ–Ω–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –í–∞—à—É –∂–∏–∑–Ω–µ–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é.</p>
            <p>–í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å <b>–ø–æ –ø–µ—Ä–≤–æ–º—É –ø–æ–±—É–∂–¥–µ–Ω–∏—é, –∑–∞—Ç—Ä–∞—á–∏–≤–∞—è –Ω–∞ –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å –Ω–µ –±–æ–ª–µ–µ 10-15 —Å–µ–∫—É–Ω–¥,</b> –∞ –∑–∞—Ç–µ–º –æ—Ç–º–µ—Ç–∏—Ç—å –µ–≥–æ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –≥—Ä–∞—Ñ–µ –±–ª–∞–Ω–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤.</p>
            <p>–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤:</p>
            <ul><li><b>1</b> ‚Äî –ù–µ —Å–æ–≥–ª–∞—Å–µ–Ω</li><li><b>2</b> ‚Äî –°–∫–æ—Ä–µ–µ –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω</li><li><b>3</b> ‚Äî –°–ª–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å</li><li><b>4</b> ‚Äî –°–∫–æ—Ä–µ–µ —Å–æ–≥–ª–∞—Å–µ–Ω</li><li><b>5</b> ‚Äî –°–æ–≥–ª–∞—Å–µ–Ω</li></ul>
        </div>
        <div id="ipl-container"></div>
        <div class="error-msg" id="ipl-error">–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –ø–æ–¥—Å–≤–µ—á–µ–Ω–Ω—ã–µ –∫—Ä–∞—Å–Ω—ã–º!</div>
        <div class="btn-container"><button class="btn btn-back" onclick="prevIPL()">–ù–∞–∑–∞–¥</button><button class="btn btn-success" onclick="finishSurvey()">–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button></div>
    </div>

    <div class="step" id="step-loading" style="text-align:center; padding: 40px 0;">
        <h2 style="color:var(--primary)">–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...</h2>
        <div class="spinner"></div>
        <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É</p>
    </div>

    <!-- –†–ï–ó–£–õ–¨–¢–ê–¢–´ -->
    <div class="step" id="step-results">
        <h1 style="color:var(--success)">–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!</h1>
        <p id="final-msg" style="text-align:center">–î–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è...</p>
        
        <div class="dl-section">
            <h3 style="margin-top:0">üìÅ –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h3>
            <p style="font-size:0.9em; margin-bottom:15px">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—é.</p>
            <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
                <button class="btn btn-success" style="flex:0 0 auto; min-width:200px;" onclick="downloadJSON()">üì• –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª</button>
                <button class="btn btn-secondary" style="flex:0 0 auto; min-width:200px; margin-top:0;" onclick="copyResult()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç</button>
            </div>
            <textarea id="result-area" readonly></textarea>
            <p id="copy-msg" style="color:var(--success); display:none; font-weight:bold; margin-top:5px;">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!</p>
        </div>

        <h2 style="margin-top:40px;">üìä –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h2>
        <div style="
    background:#fff3cd;
    border:1px solid #ffeeba;
    color:#856404;
    padding:15px;
    border-radius:8px;
    margin-bottom:25px;
    font-size:0.95em;
    line-height:1.6;
">
    <b>–í–Ω–∏–º–∞–Ω–∏–µ!</b> –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –±–µ–∑ —É—á–∞—Å—Ç–∏—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤, –Ω–µ —Å–ª–µ–¥—É–µ—Ç –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å–ª–∏—à–∫–æ–º —Å–µ—Ä—å–µ–∑–Ω–æ.
    –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å –∏–º–µ—é—Ç —Ç–æ–ª—å–∫–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è, –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º –ø—Å–∏—Ö–æ–ª–æ–≥–æ–º.
</div>
        <div class="res-block">
            <h3>1. –°–∏—Å—Ç–µ–º–∞ –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–º—ã—Å–ª–æ–≤</h3>
            <p>–ß–µ–º –Ω–∏–∂–µ —Å—Ç–æ–ª–±–µ—Ü (–º–µ–Ω—å—à–µ –±–∞–ª–ª–æ–≤), —Ç–µ–º <b>–≤–∞–∂–Ω–µ–µ</b> –¥–ª—è –≤–∞—Å —ç—Ç–∞ —Å—Ñ–µ—Ä–∞.</p>
           <!-- —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ–∏–∫ –ë—Ä–∞—Ç—É—Å—è –æ—Ç–∫–ª—é—á—ë–Ω -->
            <div id="chartBratus" style="display:none;"></div>
            <div id="textBratus" style="margin-top:15px; font-size:0.9em; line-height:1.6;"></div>

            <button class="btn btn-secondary" onclick="toggleDetails('detailsBratus')">
                üìñ –ü–æ–¥—Ä–æ–±–Ω–µ–µ 
            </button>
            <div id="detailsBratus" style="display:none; margin-top:15px; font-size:0.9em; line-height:1.6;">
            <p>–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–ª—É—á–µ–Ω–Ω–æ–π —Å—É–º–º—ã –ø–æ –∫–∞–∂–¥–æ–π –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ü–µ–Ω–∏—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–π –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –≤–∞—à–µ–π –ª–∏—á–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–º—ã—Å–ª–æ–≤.</p>

                <p> <b>‚Ä¢ –ì–µ–¥–æ–Ω–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–º—ã—Å–ª—ã.</b> –û—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ —á–µ–ª–æ–≤–µ–∫–∞ –ø–æ–ª—É—á–∞—Ç—å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ –æ—Ç –∂–∏–∑–Ω–∏, –±—ã—Ç—å —Å—á–∞—Å—Ç–ª–∏–≤—ã–º, –Ω–∞—Å–ª–∞–∂–¥–∞—Ç—å—Å—è –≤—Å–µ–º —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —á–µ–ª–æ–≤–µ–∫—É —ç–º–æ—Ü–∏–π –∏ –æ—â—É—â–µ–Ω–∏–π.</p>
                
                <p> <b>‚Ä¢ –°—Ç–∞—Ç—É—Å–Ω—ã–µ —Å–º—ã—Å–ª—ã.</b> –û—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ —á–µ–ª–æ–≤–µ–∫–∞ –∑–∞–Ω–∏–º–∞—Ç—å –≤—ã—Å–æ–∫–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –æ–±—â–µ—Å—Ç–≤–µ, –∞–∫—Ç–∏–≤–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å –∫–∞—Ä—å–µ—Ä—É, –¥–æ–±–∏–≤–∞—Ç—å—Å—è —É—Å–ø–µ—Ö–∞ –∏ –ø—Ä–∏–∑–Ω–∞–Ω–∏—è –≤ –≥–ª–∞–∑–∞—Ö –æ–∫—Ä—É–∂–∞—é—â–∏—Ö.</p>
                
                <p> <b>‚Ä¢ –ö–æ–º–º—É–Ω–∏–∫–∞—Ç–∏–≤–Ω—ã–µ —Å–º—ã—Å–ª—ã.</b> –û—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ —á–µ–ª–æ–≤–µ–∫–∞ –æ–±—â–∞—Ç—å—Å—è —Å –¥—Ä—É–≥–∏–º–∏ –ª—é–¥—å–º–∏, –ø–µ—Ä–µ–∂–∏–≤–∞—Ç—å —ç–º–æ—Ü–∏–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –æ–±—â–µ–Ω–∏–µ–º, —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–≤–æ—é –Ω—É–∂–Ω–æ—Å—Ç—å –∏ –ø—Ä–∏—á–∞—Å—Ç–Ω–æ—Å—Ç—å –∫ –∂–∏–∑–Ω–∏ –¥—Ä—É–≥–∏—Ö –ª—é–¥–µ–π.</p>
                
                <p> <b>‚Ä¢ –°–µ–º–µ–π–Ω—ã–µ —Å–º—ã—Å–ª—ã.</b> –û—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ —á–µ–ª–æ–≤–µ–∫–∞ –∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ —á–ª–µ–Ω–∞—Ö —Å–≤–æ–µ–π —Å–µ–º—å–∏, –∂–∏—Ç—å —Ä–∞–¥–∏ –Ω–µ–µ, –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤—Å–µ –ª—É—á—à–µ–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –¥–µ—Ç—è–º, —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Å—É–¥—å–±–µ —Ä–æ–¥–Ω—ã—Ö –∏ –±–ª–∏–∑–∫–∏—Ö –ª—é–¥–µ–π.</p>
                
                <p> <b>‚Ä¢ –≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Å–º—ã—Å–ª—ã.</b> –û—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ —á–µ–ª–æ–≤–µ–∫–∞ –ø—Ä–∏–¥–∞–≤–∞—Ç—å —Ü–µ–Ω–Ω–æ—Å—Ç—å —Å–∞–º–æ–º—É –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—é –∂–∏–∑–Ω–∏, –∏–º–µ—Ç—å —Å–≤–æ–±–æ–¥—É –≤—ã–±–æ—Ä–∞, –∏—Å–ø—ã—Ç—ã–≤–∞—Ç—å –ª—é–±–æ–≤—å –≤–æ –≤—Å–µ—Ö –µ–µ –ø—Ä–æ—è–≤–ª–µ–Ω–∏—è—Ö.</p>
                
                <p> <b>‚Ä¢ –ö–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Å–º—ã—Å–ª—ã.</b> –û—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ —á–µ–ª–æ–≤–µ–∫–∞ –ø–æ–∑–Ω–∞–≤–∞—Ç—å –∂–∏–∑–Ω—å, —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è—Ö –æ–∫—Ä—É–∂–∞—é—â–µ–≥–æ –º–∏—Ä–∞ –∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –ª–∏—á–Ω–æ—Å—Ç–∏, –∏—Å–∫–∞—Ç—å —Å–º—ã—Å–ª –∏ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–∏—Å—Ö–æ–¥—è—â–µ–≥–æ.</p>
                
                <p> <b>‚Ä¢ –ê–ª—å—Ç—Ä—É–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–º—ã—Å–ª—ã.</b> –û—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ —á–µ–ª–æ–≤–µ–∫–∞ –±–µ—Å–∫–æ—Ä—ã—Å—Ç–Ω–æ –ø–æ–º–æ–≥–∞—Ç—å –¥—Ä—É–≥–∏–º –ª—é–¥—è–º, –æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–æ–¥–µ–π—Å—Ç–≤–∏–µ, –¥–µ–ª–∞—Ç—å –¥–æ–±—Ä–æ, —Å–ª—É–∂–∏—Ç—å –æ–±—â–µ–º—É –±–ª–∞–≥—É, –ø—Ä–µ–Ω–µ–±—Ä–µ–≥–∞—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –≤—ã–≥–æ–¥–æ–π.</p>
                
                <p> <b>‚Ä¢ –°–º—ã—Å–ª—ã —Å–∞–º–æ—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.</b> –û—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ —á–µ–ª–æ–≤–µ–∫–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç—å —Å–≤–æ–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ, —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ —Å–≤–æ–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å —Å–≤–æ—é –ª–∏—á–Ω–æ—Å—Ç—å –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å –æ–∫—Ä—É–∂–∞—é—â–∏–º –º–∏—Ä–æ–º.</p>
            </div>
        </div>

        <div class="res-block">
            <h3>2. –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–∏—á–Ω–æ—Å—Ç–∏</h3>
            <p>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∂–µ–ª–∞–µ–º–æ–≥–æ (–ò–¥–µ–∞–ª—å–Ω–æ–µ) –∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–≥–æ (–†–µ–∞–ª—å–Ω–æ–µ). –û–±–æ–±—â—ë–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∂–∏–∑–Ω–µ–Ω–Ω–æ–π –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π —Å—Ñ–µ—Ä.</p>
            <canvas id="chartMilman"></canvas>
            <div id="textMilman" style="margin-top:15px;"></div>

<button class="btn btn-secondary" onclick="toggleDetails('detailsMilman')">
    üìñ –ü–æ–¥—Ä–æ–±–Ω–µ–µ 
</button>
<div id="emoWarningBlock" style="display:none; margin-bottom:15px; padding:12px; border:1px solid #e0c97f; background:#fffbe6; border-radius:8px; font-size:0.95em;">
</div>
<div id="detailsMilman" style="display:none; margin-top:15px; font-size:0.9em; line-height:1.6;">
    <h3>–ñ–∏–∑–Ω—å: –ò–¥–µ–∞–ª –∏ –†–µ–∞–ª—å–Ω–æ—Å—Ç—å</h3>
    <canvas id="chartMilmanLife" height="200"></canvas>
  
    <h3 style="margin-top:30px">–†–∞–±–æ—Ç–∞ / –£—á—ë–±–∞: –ò–¥–µ–∞–ª –∏ –†–µ–∞–ª—å–Ω–æ—Å—Ç—å</h3>
    <canvas id="chartMilmanWork" height="200"></canvas>

    <h3 style="margin-top:30px">–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å</h3>
<canvas id="chartMilmanEmo" height="200"></canvas>

</div>

        </div>

        <div class="res-block">
            <h3>3. –ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –ª–∏—á–Ω–æ—Å—Ç–∏</h3>
              <div id="iplDetails"></div>
            <div id="textIPL"></div>

<button class="btn btn-secondary" onclick="toggleDetails('detailsIPL')">
    üìñ –ü–æ–¥—Ä–æ–±–Ω–µ–µ 
</button>
<div id="detailsIPL" style="display:none; margin-top:15px; font-size:0.9em; line-height:1.6;"></div>

        </div>

        <div style="text-align:center; margin-top:30px;">
            <button class="btn btn-red" onclick="clearState()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
        </div>
    </div>
</div>

<script>
// --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
const GOOGLE_URL = "https://script.google.com/macros/s/AKfycbyBH_ksIaHmQxklthf1SgxzmhxAPkqABdkTFTin1TObQJZ98DudLE_20IbqEHR-SKaqCg/exec";
const STORAGE_KEY = "survey_state_v10";

// –î–ê–ù–ù–´–ï
const bratus_stmts=[{id:1,t:"...—á—Ç–æ–±—ã –ø–æ–º–æ–≥–∞—Ç—å –¥—Ä—É–≥–∏–º –ª—é–¥—è–º"},{id:2,t:"...—á—Ç–æ–±—ã –±—ã—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–º"},{id:3,t:"...—á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ"},{id:4,t:"...—á—Ç–æ–±—ã —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å—Å—è"},{id:5,t:"...—á—Ç–æ–±—ã –¥–æ–±–∏–≤–∞—Ç—å—Å—è —É—Å–ø–µ—Ö–∞"},{id:6,t:"...—á—Ç–æ–±—ã –±—ã—Ç—å —Å –±–ª–∏–∑–∫–∏–º —á–µ–ª–æ–≤–µ–∫–æ–º"},{id:7,t:"...—á—Ç–æ–±—ã –ø–µ—Ä–µ–¥–∞—Ç—å –≤—Å–µ –ª—É—á—à–µ–µ —Å–≤–æ–∏–º –¥–µ—Ç—è–º"},{id:8,t:"...—á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å —Å–µ–±—è —Å–∞–º–æ–≥–æ"},{id:9,t:"...—á—Ç–æ–±—ã –¥–µ–ª–∞—Ç—å –¥–æ–±—Ä–æ"},{id:10,t:"...—á—Ç–æ–±—ã –∂–∏—Ç—å"},{id:11,t:"...—á—Ç–æ–±—ã –∏—Å–ø—ã—Ç—ã–≤–∞—Ç—å —Å—á–∞—Å—Ç—å–µ"},{id:12,t:"...—á—Ç–æ–±—ã –æ—Å—É—â–µ—Å—Ç–≤–∏—Ç—å —Å–µ–±—è"},{id:13,t:"...—á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —Ö–æ—Ä–æ—à—É—é –∫–∞—Ä—å–µ—Ä—É"},{id:14,t:"...—á—Ç–æ–±—ã —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å, —á—Ç–æ –∫–æ–º—É-—Ç–æ –Ω—É–∂–µ–Ω"},{id:15,t:"...—á—Ç–æ–±—ã –∂–∏—Ç—å —Ä–∞–¥–∏ —Å–≤–æ–µ–π —Å–µ–º—å–∏"},{id:16,t:"...—á—Ç–æ–±—ã –ø–æ–∑–Ω–∞–≤–∞—Ç—å –ë–æ–≥–∞"},{id:17,t:"...—á—Ç–æ–±—ã —É–ª—É—á—à–∞—Ç—å –º–∏—Ä"},{id:18,t:"...—á—Ç–æ–±—ã –ª—é–±–∏—Ç—å"},{id:19,t:"...—á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –æ—â—É—â–µ–Ω–∏–π –∏ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏–π"},{id:20,t:"...—á—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ —Å–≤–æ–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏"},{id:21,t:"...—á—Ç–æ–±—ã –∑–∞–Ω–∏–º–∞—Ç—å –¥–æ—Å—Ç–æ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –æ–±—â–µ—Å—Ç–≤–µ"},{id:22,t:"...—á—Ç–æ–±—ã —Ä–∞–¥–æ–≤–∞—Ç—å—Å—è –æ–±—â–µ–Ω–∏—é —Å –¥—Ä—É–≥–∏–º–∏"},{id:23,t:"...—á—Ç–æ–±—ã –ø–æ–º–æ–≥–∞—Ç—å —Å–≤–æ–∏–º —Ä–æ–¥–Ω—ã–º –∏ –±–ª–∏–∑–∫–∏–º"},{id:24,t:"...—á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –∂–∏–∑–Ω—å"}];

const milman_qs=[
    {q:"–í —Å–≤–æ–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –≤ –∂–∏–∑–Ω–∏ –Ω—É–∂–Ω–æ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è —Å–ª–µ–¥—É—é—â–∏—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤:", i:[ "¬´–í—Ä–µ–º—è - –¥–µ–Ω—å–≥–∏¬ª. –ù—É–∂–Ω–æ —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è –∏—Ö –±–æ–ª—å—à–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å.", "¬´–ì–ª–∞–≤–Ω–æ–µ - –∑–¥–æ—Ä–æ–≤—å–µ¬ª. –ù—É–∂–Ω–æ –±–µ—Ä–µ—á—å —Å–µ–±—è –∏ —Å–≤–æ–∏ –Ω–µ—Ä–≤—ã.", "–°–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç—å —Å –¥—Ä—É–∑—å—è–º–∏.", "–°–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞–¥–æ –æ—Ç–¥–∞–≤–∞—Ç—å —Å–µ–º—å–µ.", "–ù—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –¥–æ–±—Ä–æ, –¥–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ –¥–æ—Ä–æ–≥–æ –æ–±—Ö–æ–¥–∏—Ç—Å—è.", "–ù—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ–µ, —á—Ç–æ–±—ã –∑–∞–≤–æ–µ–≤–∞—Ç—å –º–µ—Å—Ç–æ –ø–æ–¥ —Å–æ–ª–Ω—Ü–µ–º.", "–ù—É–∂–Ω–æ –ø—Ä–∏–æ–±—Ä–µ—Ç–∞—Ç—å –±–æ–ª—å—à–µ –∑–Ω–∞–Ω–∏–π, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –ø—Ä–∏—á–∏–Ω—ã –∏ —Å—É—â–Ω–æ—Å—Ç—å —Ç–æ–≥–æ, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–æ–∫—Ä—É–≥.", "–ù—É–∂–Ω–æ —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è –æ—Ç–∫—Ä—ã—Ç—å —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ, —Å–æ–∑–¥–∞—Ç—å, –∏–∑–æ–±—Ä–µ—Å—Ç–∏." ]},
    {q:"–í —Å–≤–æ–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —Ä–∞–±–æ—Ç–µ –Ω—É–∂–Ω–æ —Å–ª–µ–¥–æ–≤–∞—Ç—å —Ç–∞–∫–∏–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º:", i:[ "–†–∞–±–æ—Ç–∞ - —ç—Ç–æ –≤—ã–Ω—É–∂–¥–µ–Ω–Ω–∞—è –∂–∏–∑–Ω–µ–Ω–Ω–∞—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å.", "–ì–ª–∞–≤–Ω–æ–µ - –Ω–µ –¥–æ–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.", "–ù—É–∂–Ω–æ —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å–µ–±—è —Å–ø–æ–∫–æ–π–Ω—ã–º–∏, —É–¥–æ–±–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏.", "–ù—É–∂–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ —Å—Ç—Ä–µ–º–∏—Ç—Å—è –∫ —Å–ª—É–∂–µ–±–Ω–æ–º—É –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—é.", "–ì–ª–∞–≤–Ω–æ–µ - –∑–∞–≤–æ–µ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç –∏ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ.", "–ù—É–∂–Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å—Å—è –≤ —Å–≤–æ–µ–º –¥–µ–ª–µ.", "–í —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç–µ –≤—Å–µ–≥–¥–∞ –Ω–∞–¥–æ –Ω–∞–π—Ç–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ, —á—Ç–æ –º–æ–∂–µ—Ç —É–≤–ª–µ—á—å.", "–ù—É–∂–Ω–æ –Ω–µ —Ç–æ–ª—å–∫–æ —É–≤–ª–µ—á—å—Å—è —Å–∞–º–æ–º—É, –Ω–æ –∏ —É–≤–ª–µ—á—å —Ä–∞–±–æ—Ç–æ–π –¥—Ä—É–≥–∏—Ö." ]},
    {q:"–°—Ä–µ–¥–∏ –º–æ–∏—Ö –¥–µ–ª –≤ —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –±–æ–ª—å—à–æ–µ –º–µ—Å—Ç–æ –∑–∞–Ω–∏–º–∞—é—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–ª–∞:", i:[ "–¢–µ–∫—É—â–∏–µ, –¥–æ–º–∞—à–Ω–∏–µ.", "–û—Ç–¥—ã—Ö, —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è.", "–í—Å—Ç—Ä–µ—á–∏ —Å –¥—Ä—É–∑—å—è–º–∏.", "–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–µ–ª–∞.", "–ó–∞–Ω—è—Ç–∏—è —Å –¥–µ—Ç—å–º–∏.", "–£—á–µ–±–∞, —á—Ç–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π –¥–ª—è —Ä–∞–±–æ—Ç—ã –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã.", "–•–æ–±–±–∏.", "–ü–æ–¥—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ –¥–µ–Ω–µ–≥." ]},
    {q:"–°—Ä–µ–¥–∏ –º–æ–∏—Ö —Ä–∞–±–æ—á–∏—Ö –¥–µ–ª –º–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –∑–∞–Ω–∏–º–∞—é—Ç:", i:[ "–î–µ–ª–æ–≤–æ–µ –æ–±—â–µ–Ω–∏–µ (–ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã, –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è, –æ–±—Å—É–∂–¥–µ–Ω–∏—è –∏ —Ç. –¥.).", "–õ–∏—á–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ (–Ω–∞ —Ç–µ–º—ã, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ä–∞–±–æ—Ç–æ–π).", "–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞.", "–£—á–µ–±–∞, –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –ø–æ–≤—ã—à–µ–Ω–∏–µ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏.", "–†–∞–±–æ—Ç–∞ —Ç–≤–æ—Ä—á–µ—Å–∫–æ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞.", "–†–∞–±–æ—Ç–∞, –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤–ª–∏—è—é—â–∞—è –Ω–∞ –∑–∞—Ä–∞–±–æ—Ç–æ–∫ (—Å–¥–µ–ª—å–Ω–∞—è, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è).", "–†–∞–±–æ—Ç–∞, —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥ –¥—Ä—É–≥–∏–º–∏.", "–°–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è, –ø–µ—Ä–µ–∫—É—Ä—ã, –æ—Ç–¥—ã—Ö." ]},
    {q:"–ï—Å–ª–∏ –±—ã –º–Ω–µ –¥–æ–±–∞–≤–∏–ª–∏ –≤—ã—Ö–æ–¥–Ω–æ–π –¥–µ–Ω—å, —è –±—ã —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—Ç–∏–ª –µ–≥–æ –Ω–∞ —Ç–æ, —á—Ç–æ–±—ã:", i:[ "–ó–∞–Ω–∏–º–∞—Ç—å—Å—è —Ç–µ–∫—É—â–∏–º–∏ –¥–æ–º–∞—à–Ω–∏–º–∏ –¥–µ–ª–∞–º–∏.", "–û—Ç–¥—ã—Ö–∞—Ç—å.", "–†–∞–∑–≤–ª–µ–∫–∞—Ç—å—Å—è.", "–ó–∞–Ω–∏–º–∞—Ç—å—Å—è –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–æ–π.", "–ó–∞–Ω–∏–º–∞—Ç—å—Å—è —É—á–µ–±–æ–π, –ø–æ–ª—É—á–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö –∑–Ω–∞–Ω–∏–π.", "–ó–∞–Ω–∏–º–∞—Ç—å—Å—è —Ç–≤–æ—Ä—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–æ–π.", "–î–µ–ª–∞—Ç—å –¥–µ–ª–æ, –≤ –∫–æ—Ç–æ—Ä–æ–º —á—É–≤—Å—Ç–≤—É–µ—à—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ –¥—Ä—É–≥–∏–º–∏.", "–î–µ–ª–∞—Ç—å –¥–µ–ª–æ, –¥–∞—é—â–µ–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å." ]},
    {q:"–ï—Å–ª–∏ –±—ã —É –º–µ–Ω—è –±—ã–ª–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ-—Å–≤–æ–µ–º—É –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å, —è –±—ã —Å—Ç–∞–ª —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è:", i:[ "–¢–µ–º, —á—Ç–æ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏.", "–û–±—â–µ–Ω–∏–µ–º —Å –ª—é–¥—å–º–∏ –ø–æ –¥–µ–ª–∞–º (–ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã, –æ–±—Å—É–∂–¥–µ–Ω–∏—è).", "–õ–∏—á–Ω—ã–º –æ–±—â–µ–Ω–∏–µ–º (—Ä–∞–∑–≥–æ–≤–æ—Ä–∞–º–∏, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Å —Ä–∞–±–æ—Ç–æ–π).", "–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–æ–π.", "–£—á–µ–±–æ–π, –ø–æ–ª—É—á–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö –∑–Ω–∞–Ω–∏–π, –ø–æ–≤—ã—à–µ–Ω–∏–µ–º –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏.", "–¢–≤–æ—Ä—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–æ–π.", "–†–∞–±–æ—Ç–æ–π, –≤ –∫–æ—Ç–æ—Ä–æ–π —á—É–≤—Å—Ç–≤—É–µ—à—å –ø–æ–ª—å–∑—É –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å.", "–†–∞–±–æ—Ç–æ–π, –∑–∞ –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –ø–æ–ª—É—á–∏—Ç—å." ]},
    {q:"–Ø —á–∞—Å—Ç–æ —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—é —Å –¥—Ä—É–∑—å—è–º–∏ –∏ –∑–Ω–∞–∫–æ–º—ã–º–∏ –Ω–∞ —Ç–∞–∫–∏–µ —Ç–µ–º—ã:", i:[ "–ì–¥–µ —á—Ç–æ –º–æ–∂–Ω–æ –∫—É–ø–∏—Ç—å, –∫–∞–∫ —Ö–æ—Ä–æ—à–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤—Ä–µ–º—è.", "–ü—Ä–æ –æ–±—â–∏—Ö –∑–Ω–∞–∫–æ–º—ã—Ö.", "–û —Ç–æ–º, —á—Ç–æ –≤–∏–∂—É –∏ —Å–ª—ã—à—É –≤–æ–∫—Ä—É–≥.", "–ö–∞–∫ –¥–æ–±–∏—Ç—å—Å—è —É—Å–ø–µ—Ö–∞ –≤ –∂–∏–∑–Ω–∏.", "–û —Ä–∞–±–æ—Ç–µ.", "–û —Å–≤–æ–∏—Ö —É–≤–ª–µ—á–µ–Ω–∏—è—Ö.", "–û —Å–≤–æ–∏—Ö —É—Å–ø–µ—Ö–∞—Ö –∏ –ø–ª–∞–Ω–∞—Ö.", "–û –∂–∏–∑–Ω–∏, –∫–Ω–∏–≥–∞—Ö, –∫–∏–Ω–æ—Ñ–∏–ª—å–º–∞—Ö, –ø–æ–ª–∏—Ç–∏–∫–µ." ]},
    {q:"–ú–æ—è —Ä–∞–±–æ—Ç–∞ –¥–∞–µ—Ç –º–Ω–µ –ø—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ:", i:[ "–î–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –¥–ª—è –∂–∏–∑–Ω–∏.", "–û–±—â–µ–Ω–∏–µ —Å –ª—é–¥—å–º–∏, –¥—Ä—É–∂–µ—Å–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è.", "–ê–≤—Ç–æ—Ä–∏—Ç–µ—Ç –∏ —É–≤–∞–∂–µ–Ω–∏–µ –æ–∫—Ä—É–∂–∞—é—â–∏—Ö.", "–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏ –∏ –±–µ—Å–µ–¥—ã.", "–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏–µ –æ—Ç —Ä–∞–±–æ—Ç—ã.", "–ß—É–≤—Å—Ç–≤–æ —Å–≤–æ–µ–π –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏.", "–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—ã—à–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å.", "–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–ª—É–∂–µ–±–Ω–æ–≥–æ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è." ]},
    {q:"–ë–æ–ª—å—à–µ –≤—Å–µ–≥–æ –º–Ω–µ —Ö–æ—á–µ—Ç—Å—è –±—ã–≤–∞—Ç—å –≤ —Ç–∞–∫–æ–º –æ–±—â–µ—Å—Ç–≤–µ, –≥–¥–µ:", i:[ "–£—é—Ç–Ω–æ, —Ö–æ—Ä–æ—à–∏–µ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è.", "–ú–æ–∂–Ω–æ –æ–±—Å—É–¥–∏—Ç—å –≤–æ–ª–Ω—É—é—â–∏–µ —Ç–µ–±—è —Ä–∞–±–æ—á–∏–µ —Ç–µ–º—ã.", "–¢–µ–±—è —É–≤–∞–∂–∞—é—Ç, —Å—á–∏—Ç–∞—é—Ç –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–æ–º.", "–ú–æ–∂–Ω–æ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è —Å –Ω—É–∂–Ω—ã–º–∏ –ª—é–¥—å–º–∏, –∑–∞–≤—è–∑–∞—Ç—å –ø–æ–ª–µ–∑–Ω—ã–µ —Å–≤—è–∑–∏.", "–ú–æ–∂–Ω–æ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –Ω–æ–≤—ã—Ö –¥—Ä—É–∑–µ–π.", "–ë—ã–≤–∞—é—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∑–∞—Å–ª—É–∂–µ–Ω–Ω—ã–µ –ª—é–¥–∏.", "–í—Å–µ —Å–≤—è–∑–∞–Ω—ã –æ–±—â–∏–º –¥–µ–ª–æ–º.", "–ú–æ–∂–Ω–æ –ø—Ä–æ—è–≤–∏—Ç—å –∏ —Ä–∞–∑–≤–∏—Ç—å —Å–≤–æ–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏." ]},
    {q:"–Ø —Ö–æ—Ç–µ–ª –±—ã –Ω–∞ —Ä–∞–±–æ—Ç–µ –±—ã—Ç—å —Ä—è–¥–æ–º —Å —Ç–∞–∫–∏–º–∏ –ª—é–¥—å–º–∏:", i:[ "–° –∫–æ—Ç–æ—Ä—ã–º–∏ –º–æ–∂–Ω–æ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Ç–µ–º—ã.", "–ö–æ—Ç–æ—Ä—ã–º –º–æ–≥ –±—ã –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Å–≤–æ–π –æ–ø—ã—Ç –∏ –∑–Ω–∞–Ω–∏—è.", "–° –∫–æ—Ç–æ—Ä—ã–º–∏ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å.", "–ö–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç –∏ –≤–µ—Å –Ω–∞ —Ä–∞–±–æ—Ç–µ.", "–ö–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –Ω–∞—É—á–∏—Ç—å —á–µ–º—É-–Ω–∏–±—É–¥—å –ø–æ–ª–µ–∑–Ω–æ–º—É.", "–ö–æ—Ç–æ—Ä—ã–µ –∑–∞—Å—Ç–∞–≤–ª—è—é—Ç —Ç–µ–±—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∞–∫—Ç–∏–≤–Ω–µ–µ –Ω–∞ —Ä–∞–±–æ—Ç–µ.", "–ö–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç –º–Ω–æ–≥–æ –∑–Ω–∞–Ω–∏–π –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –∏–¥–µ–π.", "–ö–æ—Ç–æ—Ä—ã–µ –≥–æ—Ç–æ–≤—ã –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Ç–µ–±—è –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö." ]},
    {q:"–ö –Ω–∞—Å—Ç–æ—è—â–µ–º—É –≤—Ä–µ–º–µ–Ω–∏ —è –∏–º–µ—é –≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏:", i:[ "–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–µ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ.", "–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ —Ä–∞–∑–≤–ª–µ–∫–∞—Ç—å—Å—è.", "–•–æ—Ä–æ—à–∏–µ —É—Å–ª–æ–≤–∏—è –∂–∏–∑–Ω–∏.", "–•–æ—Ä–æ—à—É—é —Å–µ–º—å—é.", "–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –≤—Ä–µ–º—è –≤ –æ–±—â–µ—Å—Ç–≤–µ.", "–£–≤–∞–∂–µ–Ω–∏–µ, –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –∏ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –¥—Ä—É–≥–∏—Ö.", "–ß—É–≤—Å—Ç–≤–æ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö.", "–°–æ–∑–¥–∞–Ω–∏–µ —á–µ–≥–æ-—Ç–æ —Ü–µ–Ω–Ω–æ–≥–æ, –ø–æ–ª–µ–∑–Ω–æ–≥–æ." ]},
    {q:"–Ø –¥—É–º–∞—é, —á—Ç–æ –∏–º–µ—é –≤ —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç–µ –≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏:", i:[ "–•–æ—Ä–æ—à—É—é –∑–∞—Ä–ø–ª–∞—Ç—É, –¥—Ä—É–≥–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ –±–ª–∞–≥–∞.", "–•–æ—Ä–æ—à–∏–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã.", "–•–æ—Ä–æ—à–∏–π –∫–æ–ª–ª–µ–∫—Ç–∏–≤, –¥—Ä—É–∂–µ—Å–∫–∏–µ –≤–∑–∞–∏–º–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è.", "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.", "–•–æ—Ä–æ—à—É—é –¥–æ–ª–∂–Ω–æ—Å—Ç—å.", "–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å.", "–ê–≤—Ç–æ—Ä–∏—Ç–µ—Ç –∏ —É–≤–∞–∂–µ–Ω–∏–µ –∫–æ–ª–ª–µ–≥.", "–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å." ]},
    {q:"–ë–æ–ª—å—à–µ –≤—Å–µ–≥–æ –º–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è, –∫–æ–≥–¥–∞:", i:[ "–ù–µ –Ω—É–∂–Ω–æ –¥—É–º–∞—Ç—å –æ –Ω–∞—Å—É—â–Ω—ã—Ö –∑–∞–±–æ—Ç–∞—Ö.", "–ï—Å—Ç—å –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–µ, –ø—Ä–∏—è—Ç–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ.", "–ö—Ä—É–≥–æ–º –æ–∂–∏–≤–ª–µ–Ω–∏–µ, –≤–µ—Å–µ–ª–∞—è —Å—É–µ—Ç–∞.", "–ü—Ä–µ–¥—Å—Ç–æ–∏—Ç –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤—Ä–µ–º—è –≤ –≤–µ—Å–µ–ª–æ–º –æ–±—â–µ—Å—Ç–≤–µ.", "–ò—Å–ø—ã—Ç—ã–≤–∞—é —á—É–≤—Å—Ç–≤–æ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è, –ø–æ–∏—Å–∫–∞.", "–ò—Å–ø—ã—Ç—ã–≤–∞—é —á—É–≤—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.", "–ü–æ–≥—Ä—É–∂–µ–Ω –≤ —Å–≤–æ—é —Ä–∞–±–æ—Ç—É.", "–í–∫–ª—é—á–µ–Ω –≤ —Å–æ–≤–º–µ—Å—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É —Å –¥—Ä—É–≥–∏–º–∏." ]},
    {q:"–ö–æ–≥–¥–∞ –º–µ–Ω—è –ø–æ—Å—Ç–∏–≥–∞–µ—Ç –Ω–µ—É–¥–∞—á–∞, –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Ç–æ, —á—Ç–æ —è —Ö–æ—á—É:", i:[ "–Ø —Ä–∞—Å—Å—Ç—Ä–∞–∏–≤–∞—é—Å—å –∏ –¥–æ–ª–≥–æ –ø–µ—Ä–µ–∂–∏–≤–∞—é.", "–°—Ç–∞—Ä–∞—é—Å—å –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —á—Ç–æ-–Ω–∏–±—É–¥—å –¥—Ä—É–≥–æ–µ, –ø—Ä–∏—è—Ç–Ω–æ–µ.", "–¢–µ—Ä—è—é—Å—å, –Ω–µ –∑–Ω–∞—é —á—Ç–æ –¥–µ–ª–∞—Ç—å, –∑–ª—é—Å—å –Ω–∞ —Å–µ–±—è.", "–ó–ª—é—Å—å –Ω–∞ —Ç–æ, —á—Ç–æ –º–Ω–µ –ø–æ–º–µ—à–∞–ª–æ.", "–°—Ç–∞—Ä–∞—é—Å—å –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è —Å–ø–æ–∫–æ–π–Ω—ã–º, –∏ –æ–±—ã—á–Ω–æ –º–Ω–µ —ç—Ç–æ —É–¥–∞–µ—Ç—Å—è.", "–ü–µ—Ä–µ–∂–∏–¥–∞—é, –∫–æ–≥–¥–∞ –ø—Ä–æ–π–¥–µ—Ç –ø–µ—Ä–≤–∞—è —Ä–µ–∞–∫—Ü–∏—è, –∏ —Å–ø–æ–∫–æ–π–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ.", "–°—Ç–∞—Ä–∞—é—Å—å –ø–æ–Ω—è—Ç—å, –≤ —á–µ–º —è —Å–∞–º –±—ã–ª –≤–∏–Ω–æ–≤–∞—Ç.", "–°—Ç–∞—Ä–∞—é—Å—å –ø–æ–Ω—è—Ç—å –ø—Ä–∏—á–∏–Ω—ã –Ω–µ—É–¥–∞—á–∏ –∏ –ø–æ–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª–æ–∂–µ–Ω–∏–µ." ]}
];

const ipl_qs=[
    "–í—Å–µ –∑–Ω–∞–Ω–∏—è –æ –º–∏—Ä–µ –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –∫–Ω–∏–≥, –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–π —Å–µ—Ç–∏.", "–ö–æ–≥–¥–∞ —è –¥—É–º–∞—é –æ –±—É–¥—É—â–µ–º, –Ω–µ —á—É–≤—Å—Ç–≤—É—é —Å—Ç—Ä–∞—Ö–∞ –∑–∞ —Å–≤–æ—é —Å–µ–º—å—é, —Å—Ç—Ä–∞–Ω—É, –≥–¥–µ —è –∂–∏–≤—É.", "–Ø —Å–º–æ–≥ –±—ã –ø–æ–±–æ—Ä–æ—Ç—å —Å—Ç—Ä–∞—Ö –∑–∞ —Å–≤–æ—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∑–∞–Ω—è—Ç—å—Å—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–º –≤–∏–¥–æ–º —Å–ø–æ—Ä—Ç–∞, –ø—Ä—ã–≥–Ω—É—Ç—å —Å –ø–∞—Ä–∞—à—é—Ç–æ–º, –Ω—ã—Ä–Ω—É—Ç—å —Å –∞–∫–≤–∞–ª–∞–Ω–≥–æ–º.", "–Ø –±–µ–∑ —É—Å–∏–ª–∏–π –ø–µ—Ä–µ–∫–ª—é—á–∞—é—Å—å –Ω–∞ —Ä–∞–±–æ—á–∏–π —Ä–µ–∂–∏–º –ø–æ—Å–ª–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ –∏–ª–∏ –æ—Ç–ø—É—Å–∫–∞.", "–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –ø–æ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ª–µ—Å—Ç–Ω–∏—Ü–µ ‚Äì –≥–ª–∞–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π —è —Å—Ç–∞—Ä–∞—é—Å—å –æ–≤–ª–∞–¥–µ—Ç—å –Ω–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∞ –¥–ª—è –º–µ–Ω—è –Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞.", "–ü—Ä–æ–∏—Å—Ö–æ–¥—è—â–∏–µ —Å–æ –º–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω—ã –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç —É –º–µ–Ω—è —á—É–≤—Å—Ç–≤–∞ —Ç—Ä–µ–≤–æ–≥–∏ –∏–ª–∏ –±–µ—Å–ø–æ–∫–æ–π—Å—Ç–≤–∞.", "–†—è–¥–æ–≤–æ–π —á–µ–ª–æ–≤–µ–∫ –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ –æ–∑–æ–Ω–æ–≤—ã—Ö –¥—ã—Ä, –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ –ø—Ä–∏—Ä–æ–¥–Ω–æ–π —Å—Ä–µ–¥—ã –∏ –ø—Ä–æ—á–∏–µ –ø–æ–¥–æ–±–Ω—ã–µ –∫–∞—Ç–∞–∫–ª–∏–∑–º—ã.", "–ö–æ–≥–¥–∞ —è –∏–¥—É –ø–æ —Ö–æ—Ä–æ—à–æ –∑–Ω–∞–∫–æ–º–æ–π –¥–æ—Ä–æ–≥–µ, —Ç–æ —Å—Ä–∞–∑—É –ø–æ–¥–º–µ—á–∞—é –ø—Ä–æ–∏–∑–æ—à–µ–¥—à–∏–µ –≤–æ–∫—Ä—É–≥ –ø–µ—Ä–µ–º–µ–Ω—ã.", "–õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–æ—Ü–∏–∞–ª—å–Ω–æ-–ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –æ—á–µ—Ä–µ–¥–Ω–æ–º—É –∫—Ä–∏–∑–∏—Å—É.", "–Ø - –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏, –ø–æ—ç—Ç–æ–º—É —á—å–∏-–ª–∏–±–æ –ø–æ–ø—ã—Ç–∫–∏ –≤–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –º–æ–µ–π —Ä–∞–±–æ—Ç—ã, —Ç–æ–ª—å–∫–æ –≤—Ä–µ–¥—è—Ç –¥–µ–ª—É.", "–Ø –ª–µ–≥–∫–æ –Ω–∞—Ö–æ–∂—É —è–∑—ã–∫ —Å –Ω–æ–≤—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º, –≤–µ–¥—É —Å–µ–±—è –∫–∞–∫ –æ–±—ã—á–Ω–æ –≤ –∫—Ä—É–≥—É –Ω–µ–∑–Ω–∞–∫–æ–º—ã—Ö –ª—é–¥–µ–π.", "–Ø –Ω–µ –ø—Ä–∏–¥–∞—é –æ—Å–æ–±–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–º—É –º–µ—Å—Ç—É –æ—Ç–¥—ã—Ö–∞, –ø–∏—Ç–∞–Ω–∏—é.", "–Ø —Ä–µ–≥—É–ª—è—Ä–Ω–æ –∏ —Å –∏–Ω—Ç–µ—Ä–µ—Å–æ–º —á–∏—Ç–∞—é –∫–Ω–∏–≥–∏ ¬´–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –∞–≤—Ç–æ—Ä–æ–≤¬ª, —Å–ª—É—à–∞—é –Ω–æ–≤—ã–µ, –Ω–µ–æ–±—ã—á–Ω—ã–µ –≤–∏–¥—ã –º—É–∑—ã–∫–∏, –ø–æ—Å–µ—â–∞—é –≤—ã—Å—Ç–∞–≤–∫–∏, —Ç–µ–∞—Ç—Ä.", "–í —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –º–∏—Ä–µ, —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ –ø–æ—Å–ª–æ–≤–∏—Ü–µ ‚Äì –º–Ω–æ–≥–æ –Ω–æ–≤–æ–≥–æ, –º–∞–ª–æ —Ö–æ—Ä–æ—à–µ–≥–æ.", "–û–±—ã—á–Ω–æ –º–Ω–µ —Ç—Ä—É–¥–Ω–æ –≤–∑—è—Ç—å—Å—è –∑–∞ –Ω–æ–≤–æ–µ –¥–µ–ª–æ.", "–ö—É–ª—å—Ç—É—Ä–Ω—ã–º –≤–ø–æ–ª–Ω–µ –º–æ–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å —Ç–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç –≤—ã—Å—à–µ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ.", "–ï—Å–ª–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç –º–æ–∏–º –º–æ—Ä–∞–ª—å–Ω—ã–º –∏–ª–∏ –Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω—ã–º –Ω–æ—Ä–º–∞–º, —è –±–µ–∑ –∫–æ–ª–µ–±–∞–Ω–∏–π —Å–º–µ–Ω—é –º–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∞ –ø—Ä–µ—Å—Ç–∏–∂–Ω–∞ –∏ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ –æ–ø–ª–∞—á–∏–≤–∞–µ–º–∞.", "–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ª—é–¥–µ–π –∂–∏–≤–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–π, –Ω–∞—Å—ã—â–µ–Ω–Ω–æ–π –∂–∏–∑–Ω—å—é.", "–Ø —Å—Ç–∞—Ä–∞—é—Å—å –ø—Ä–∏—Å–ª—É—à–∏–≤–∞—Ç—å—Å—è –∫ –ø—Ä–∏—Ä–æ–¥–Ω–æ–º—É —Ä–∏—Ç–º—É –º–∏—Ä–∞.", "–î–ª—è –º–µ–Ω—è –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å –ø—Ä–∏–Ω—è—Ç—ã–µ –≤ –º–æ–µ–π —Å—Ä–µ–¥–µ –ø—Ä–∞–≤–∏–ª–∞.", "–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —Å—É—Ç–∏ —á–µ–≥–æ-–ª–∏–±–æ, –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–ø—Ä–æ—Å–∏—Ç—å –æ–± —ç—Ç–æ–º —É —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤.", "–•–æ—Ä–æ—à–∏–π –¥—Ä—É–≥ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏–∑–º–µ–Ω–∏—Ç —Å–≤–æ–∏ —Å–∏–º–ø–∞—Ç–∏–∏ –∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–æ –º–Ω–µ.", "–Ø —Å –∏–Ω—Ç–µ—Ä–µ—Å–æ–º, –Ω–µ–ø—Ä–µ–¥–≤–∑—è—Ç–æ –∏ –±–µ–∑ —Å–∫–µ–ø—Ç–∏—Ü–∏–∑–º–∞ –æ—Ç–Ω–æ—à—É—Å—å –∫ –∫—É–ª—å—Ç—É—Ä–Ω—ã–º —Ç—Ä–∞–¥–∏—Ü–∏—è–º —Å–∞–º—ã—Ö —Ä–∞–∑–Ω—ã—Ö –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–µ–π.", "–ñ–∏–∑–Ω–µ–Ω–Ω—ã–µ, —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞ –Ω–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –º–Ω–µ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Å–ª–µ–¥–∏—Ç—å –∑–∞ –Ω–æ–≤–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–æ–π –ø–æ –º–æ–µ–π —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏.", "–õ—É—á—à–µ –∂–∏—Ç—å –≤ —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–∏–µ.", "–Ø —Å —Ç—Ä—É–¥–æ–º –ø—Ä–∏–≤—ã–∫–∞—é –∫ –Ω–æ–≤–æ–º—É –∫–æ–ª–ª–µ–∫—Ç–∏–≤—É, —Ä–∞–±–æ—Ç–µ, –º–µ—Å—Ç—É –æ—Ç–¥—ã—Ö–∞.", "–Ø —Å–∫–µ–ø—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–Ω–æ—à—É—Å—å –∫–æ –≤—Å—è–∫–æ–≥–æ —Ä–æ–¥–∞ –Ω–æ–≤–æ–≤–≤–µ–¥–µ–Ω–∏—è–º, –Ω–µ—Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–º –ø–æ–¥—Ö–æ–¥–∞–º –≤ –∂–∏–≤–æ–ø–∏—Å–∏, –∫–∏–Ω–æ, —Ç–µ–∞—Ç—Ä–∞–ª—å–Ω—ã—Ö –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞—Ö.", "–Ø –≤—Å–µ —á–∞—â–µ –∑–∞–¥—É–º—ã–≤–∞—é—Å—å –Ω–∞–¥ —Ç–µ–º, —á—Ç–æ –≤—Ä–µ–º—è –±—ã—Å—Ç—Ä–æ—Ç–µ—á–Ω–æ –∏ –±–µ–∑–∂–∞–ª–æ—Å—Ç–Ω–æ.", "–ú–µ–Ω—è —Ä–∞–¥—É—é—Ç —Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–æ—à–ª–∏ –≤ –º–æ–µ–π –∂–∏–∑–Ω–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è.", "–ú–µ–Ω—è –Ω–µ –ø—É–≥–∞–µ—Ç –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞ –≤–Ω–µ–∑–∞–ø–Ω–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –æ—Å–≤–æ–∏—Ç—å –Ω–æ–≤—É—é —Å—Ñ–µ—Ä—É –∑–Ω–∞–Ω–∏–π.", "–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∏–ª—å —Ä–∞–±–æ—Ç—ã, –æ–¥–Ω–∞–∂–¥—ã –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å, –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏ –ª—é–¥–µ–π –≤—ã–Ω—É–∂–¥–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å.", "–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –±–µ–∑ –æ—à–∏–±–æ–∫ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ —Å–æ–≤—Å–µ–º –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Å–º–µ–Ω–æ–π –ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞, –∏ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è–º–∏ –∫ –∫–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–∏.", "–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–∞—Å–ø–æ—Ä—è–¥–∫–µ –¥–Ω—è –≤—ã–∑—ã–≤–∞—é—Ç —É –º–µ–Ω—è —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ.", "–û–±—ã—á–Ω–æ —è –ª–µ–≥–∫–æ –º–µ–Ω—è—é –ø—Ä–∏–Ω—è—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ, —É—á–∏—Ç—ã–≤–∞—è —Ä–∞–∑—É–º–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥—Ä—É–≥–∏—Ö.", "–Ø –±–µ–∑ —Ç—Ä—É–¥–∞ –æ—Ä–∏–µ–Ω—Ç–∏—Ä—É—è—Å—å –Ω–∞ –Ω–µ–∑–Ω–∞–∫–æ–º–æ–π –º–µ—Å—Ç–Ω–æ—Å—Ç–∏.", "–ú–Ω–µ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–∏–ª, —á—Ç–æ–±—ã –æ–±—Ä–∞—Ç–∏—Ç—å –Ω–µ–±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–µ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞ –Ω–∞ —Å–≤–æ—é –ø–æ–ª—å–∑—É."
];

// –°–æ—Å—Ç–æ—è–Ω–∏–µ
let state = { meta: {}, bratus: {}, rank: 1, milman: {}, ipl: {}, timing: {start: Date.now(), milman_start:0, ipl_start:0} };
let anonMode = false;

// --- PERSISTENCE ---
function saveStateToLocal() { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); updateProgress(); }
function loadStateFromLocal() {
    let saved = localStorage.getItem(STORAGE_KEY);
    if (saved) Object.assign(state, JSON.parse(saved));
}
function clearState() { localStorage.removeItem(STORAGE_KEY); window.location.reload(); }

// INIT
window.onload = function() {
    if (localStorage.getItem(STORAGE_KEY)) {
        loadStateFromLocal();
        if (state.finished) {
            finishSurvey(true);
        } else if (Object.keys(state.ipl).length > 0) {
            switchStep('step-form', 'step-ipl'); renderIPL();
        } else if (Object.keys(state.milman).length > 0) {
            switchStep('step-form', 'step-milman'); renderMilman();
        } else if (state.rank > 1 || (state.bratus && Object.keys(state.bratus).length > 0)) {
            switchStep('step-form', 'step-bratus'); renderBratus();
        } else if (state.meta.fio) {
            restoreForm();
        }
    }
};

function restoreForm() {
    if (state.meta.mode === 'anon' || state.meta.fio === "–ê–Ω–æ–Ω–∏–º") {
        document.getElementById('anon_mode').checked = true;
        toggleAnon();
    }
    for(let k in state.meta) { let el = document.getElementById(k); if(el) el.value = state.meta[k]; }
    toggleWorkPlace(); toggleEduBlock();
}

function updateProgress() {
    let current = 0;
    if (document.getElementById('step-bratus').classList.contains('active')) current = state.rank;
    else if (document.getElementById('step-milman').classList.contains('active')) current = 9;
    else if (document.getElementById('step-ipl').classList.contains('active')) current = 10;
    else if (document.getElementById('step-results').classList.contains('active')) current = 11;
    
    let pct = Math.min(100, (current / 11) * 100);
    document.querySelector('.progress-fill').style.width = pct + "%";
}

// --- GOD MODE (DEV) ---
function checkDevMode(val) {
    if(val.toLowerCase().trim() === 'dev') {
        document.getElementById('dev-panel').style.display = 'block';
    }
}

function fillRandomData() {
    state.meta = { fio: "–¢–µ—Å—Ç–æ–≤—ã–π –Æ–∑–µ—Ä", gender: "–ú—É–∂—Å–∫–æ–π", age: "25", family_status: "–•–æ–ª–æ—Å—Ç/–ù–µ –∑–∞–º—É–∂–µ–º", children: "–ù–µ—Ç", is_working: "–î–∞", work_place: "IT", has_secondary_edu: "–ù–µ—Ç", edu_status: "–£—á—É—Å—å", university: "–°—É—Ä–ì–£", speciality: "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è", edu_level: "–ë–∞–∫–∞–ª–∞–≤—Ä–∏–∞—Ç", edu_basis: "–ë—é–¥–∂–µ—Ç", course: "4", mode: "dev" };
    
    let ids = Array.from({length:24}, (_, i) => i + 1);
    for(let r=1; r<=8; r++) {
        state.bratus[r] = [];
        for(let k=0; k<3; k++) {
            let randIdx = Math.floor(Math.random() * ids.length);
            state.bratus[r].push(ids[randIdx]);
            ids.splice(randIdx, 1);
        }
    }
    state.rank = 8;
    for(let q=0; q<14; q++) for(let i=0; i<8; i++) state.milman[`${q}_${i}`] = Math.floor(Math.random() * 4);
    for(let i=0; i<36; i++) state.ipl[i] = Math.floor(Math.random() * 5) + 1;
    
    saveStateToLocal();
    finishSurvey();
}

function loadDevJSON() {
    try {
        let json = document.getElementById('dev-json-input').value;
        let data = JSON.parse(json);
        if(data.bratus && data.milman && data.ipl) {
            state = data;
            state.meta.mode = "dev"; // Force dev to avoid pollution
            saveStateToLocal();
            finishSurvey(true);
        } else {
            alert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON (–Ω–µ—Ç –ø–æ–ª–µ–π bratus/milman/ipl)");
        }
    } catch(e) {
        document.getElementById('dev-error').innerText = "–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞: " + e.message;
    }
}

// --- –õ–û–ì–ò–ö–ê ---
function toggleAnon() {
    anonMode = document.getElementById('anon_mode').checked;
    state.meta.mode = anonMode ? 'anon' : 'normal';
    document.getElementById('anon_warning').style.display = anonMode ? 'block' : 'none';
    document.querySelectorAll('.req').forEach(el => el.style.display = anonMode ? 'none' : 'inline');
    const inputs = document.querySelectorAll('#step-form input:not(#anon_mode), #step-form select');
    inputs.forEach(el => el.style.backgroundColor = anonMode ? '#f9f9f9' : '#fff');
    saveStateToLocal();
}

function toggleWorkPlace() { document.getElementById('work_place_block').style.display = (document.getElementById('is_working').value === "–î–∞") ? 'block' : 'none'; }
function toggleEduBlock() {
    const status = document.getElementById('edu_status').value;
    document.getElementById('edu_block').style.display = (status === "–£—á—É—Å—å" || status === "–ó–∞–∫–æ–Ω—á–∏–ª") ? 'block' : 'none';
    document.getElementById('course_block').style.display = (status === "–£—á—É—Å—å") ? 'block' : 'none';
}

function validateForm() {
    let ids = ['fio','gender','age','family_status','children','is_working','has_secondary_edu','edu_status'];
    const status = document.getElementById('edu_status').value;
    if(status === '–£—á—É—Å—å') ids = ids.concat(['university','speciality','edu_level','edu_basis','course']);
    else if(status === '–ó–∞–∫–æ–Ω—á–∏–ª') ids = ids.concat(['university','speciality','edu_level','edu_basis']);
    
    let valid = true;
    anonMode = document.getElementById('anon_mode').checked;
    
    if (!anonMode) {
        ids.forEach(id => {
            let el = document.getElementById(id);
            if(!el || !el.value) { if(el) el.style.borderColor = "var(--error)"; valid = false; } 
            else { if(el) el.style.borderColor = "#ddd"; state.meta[id] = el.value; }
        });
    } else {
        ids.forEach(id => { state.meta[id] = "–ê–Ω–æ–Ω–∏–º"; });
    }
    if(!valid) { document.getElementById('form-error').style.display = 'block'; return; }
    
    saveStateToLocal();
    switchStep('step-form', 'step-bratus');
    renderBratus();
}

function renderBratus() {
    const c = document.getElementById('bratus-options'); c.innerHTML = "";
    document.getElementById('bratus-sub').innerHTML = `–í—ã–±–µ—Ä–∏—Ç–µ <b>3</b> —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è <b>${state.rank}-–≥–æ –º–µ—Å—Ç–∞</b>`;
    
    let used = []; 
    for(let k in state.bratus) if(parseInt(k) !== state.rank) used = used.concat(state.bratus[k]);
    
    bratus_stmts.forEach(s => {
        if(!used.includes(s.id)) {
            let div = document.createElement('div'); div.className = 'option-card'; div.innerHTML = `<input type="checkbox" value="${s.id}"> ${s.t}`;
            if(state.bratus[state.rank] && state.bratus[state.rank].includes(s.id)) { div.classList.add('checked'); div.querySelector('input').checked = true; }
            div.onclick = (e) => { 
                if(e.target.tagName!=='INPUT') div.querySelector('input').click(); 
                div.classList.toggle('checked', div.querySelector('input').checked); 
                saveStateToLocal();
            };
            div.querySelector('input').onchange = () => saveStateToLocal();
            c.appendChild(div);
        }
    });
    updateProgress();
}
function nextBratusRank() {
    const ch = document.querySelectorAll('#bratus-options input:checked');
    if(ch.length !== 3) { document.getElementById('bratus-error').style.display = 'block'; return; }
    document.getElementById('bratus-error').style.display = 'none';
    state.bratus[state.rank] = Array.from(ch).map(i => parseInt(i.value));
    saveStateToLocal();
    if(state.rank < 8) { state.rank++; renderBratus(); window.scrollTo(0,0); }
    else { state.timing.milman_start = Date.now(); switchStep('step-bratus', 'step-milman'); renderMilman(); }
}
function prevBratusRank() { if(state.rank > 1) { state.rank--; renderBratus(); } else switchStep('step-bratus', 'step-form'); saveStateToLocal(); }

function renderMilman() {
    const c = document.getElementById('milman-container');
    document.getElementById('progress').style.width = "60%"; 
    if(c.innerHTML) {
        for(let k in state.milman) { 
            let el = document.querySelector(`input[name="m_${k}"][value="${state.milman[k]}"]`); 
            if(el) el.checked = true; 
        }
        return; 
    }
    
    milman_qs.forEach((q, qi) => {
        let h = `<div class="q-block"><h3>${qi+1}. ${q.q}</h3><table><thead><tr><th>–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</th><th>–î–∞, —Å–æ–≥–ª–∞—Å–µ–Ω</th><th>–ü–æ–∂–∞–ª—É–π —Å–æ–≥–ª–∞—Å–µ–Ω </th><th>–ö–æ–≥–¥–∞ –∫–∞–∫</th><th>–ù–µ—Ç / –ù–µ –∑–Ω–∞—é</th></tr></thead><tbody>`;
        q.i.forEach((txt, ii) => {
            let nm = `m_${qi}_${ii}`;
            h += `<tr id="row_${nm}"><td>${txt}</td>
            <td data-label="++ (–î–∞)"><input type="radio" name="${nm}" value="3" onclick="saveM('${nm}',3)"></td>
            <td data-label="+ (–ü–æ–∂–∞–ª—É–π)"><input type="radio" name="${nm}" value="2" onclick="saveM('${nm}',2)"></td>
            <td data-label="= (–ö–æ–≥–¥–∞ –∫–∞–∫)"><input type="radio" name="${nm}" value="1" onclick="saveM('${nm}',1)"></td>
            <td data-label="- / ? (–ù–µ—Ç)"><input type="radio" name="${nm}" value="0" onclick="saveM('${nm}',0)"></td></tr>`;
        });
        c.innerHTML += h + "</tbody></table></div>";
    });
    for(let k in state.milman) { 
        let el = document.querySelector(`input[name="m_${k}"][value="${state.milman[k]}"]`); 
        if(el) el.checked = true; 
    }
    updateProgress();
}
function saveM(k, v) { state.milman[k.replace('m_','')] = v; document.getElementById('row_'+k).classList.remove('highlight-error'); saveStateToLocal(); }
function finishMilman() {
    if(!validateGroup('m', 14, 8)) return;
    
    // Check for Fast Clicker (less than 60s)
    if (state.timing && state.timing.milman_start) {
        let dur = (Date.now() - state.timing.milman_start) / 1000;
        if (dur < 60) {
            state.meta.flags = (state.meta.flags || "") + "FAST_MILMAN;";
        }
    }

    switchStep('step-milman', 'step-ipl');
    renderIPL();
}
function prevMilman() { switchStep('step-milman', 'step-bratus'); saveStateToLocal(); }

function renderIPL() {
    const c = document.getElementById('ipl-container');
    if(c.innerHTML) {
        for(let k in state.ipl) { 
            let el = document.querySelector(`input[name="ipl_${k}"][value="${state.ipl[k]}"]`); 
            if(el) el.checked = true; 
        }
        return;
    }
    let h = `<table><thead><tr><th>–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</th><th>1 (–ù–µ —Å–æ–≥–ª–∞—Å–µ–Ω)</th><th>2</th><th>3</th><th>4</th><th>5 (–°–æ–≥–ª–∞—Å–µ–Ω)</th></tr></thead><tbody>`;
    ipl_qs.forEach((txt, i) => {
        let nm = `ipl_${i}`;
        h += `<tr id="row_${nm}"><td>${i+1}. ${txt}</td>${[1,2,3,4,5].map(v => `<td data-label="${v}"><input type="radio" name="${nm}" value="${v}" onclick="saveI(${i},${v})"></td>`).join('')}</tr>`;
    });
    c.innerHTML = h + "</tbody></table>";
    for(let k in state.ipl) { 
        let el = document.querySelector(`input[name="ipl_${k}"][value="${state.ipl[k]}"]`); 
        if(el) el.checked = true; 
    }
    updateProgress();
}
function saveI(i, v) { state.ipl[i] = v; document.getElementById('row_ipl_'+i).classList.remove('highlight-error'); saveStateToLocal(); }
function prevIPL() { switchStep('step-ipl', 'step-milman'); saveStateToLocal(); }

// --- –§–ò–ù–ê–õ ---
function finishSurvey(skipFetch = false) {
    if(!skipFetch && !validateGroup('ipl', 36, 1)) return;
    
    state.finished = true; 
    saveStateToLocal();
    updateProgress();

    if(skipFetch) {
        switchStep('step-ipl', 'step-results'); 
        switchStep('step-form', 'step-results'); 
        calculateAndShowResults(true);
        return;
    }

    switchStep('step-ipl', 'step-loading');
    
    const isDev = state.meta.mode === 'dev';

    if (!isDev) {
        fetch(GOOGLE_URL, { method: "POST", mode: "no-cors", headers: { "Content-Type": "application/json" }, body: JSON.stringify(state) })
        .then(() => { document.getElementById('final-msg').innerHTML = "–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ <b style='color:green'>—Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –æ–±–ª–∞–∫–µ</b>."; })
        .catch(() => { document.getElementById('final-msg').innerHTML = "<b style='color:red'>–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏!</b> –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª."; });
    } else {
        console.log("DEV MODE: –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞.");
        document.getElementById('final-msg').innerHTML = "<b style='color:orange'>[–†–ï–ñ–ò–ú –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–ê]</b> –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –æ–±–ª–∞–∫–æ –æ—Ç–∫–ª—é—á–µ–Ω–∞.";
    }

    calculateAndShowResults();
}

function calculateAndShowResults(immediate = false) {
    // 1. –ë–†–ê–¢–£–°–¨
    const cats_map = { '–ê–ª—å—Ç—Ä—É–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ': [1,9,17], '–≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ': [2,10,18], '–ì–µ–¥–æ–Ω–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ': [3,11,19], '–°–∞–º–æ—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏': [4,12,20], '–°—Ç–∞—Ç—É—Å–Ω—ã–µ': [5,13,21], '–ö–æ–º–º—É–Ω–∏–∫–∞—Ç–∏–≤–Ω—ã–µ': [6,14,22], '–°–µ–º–µ–π–Ω—ã–µ': [7,15,23], '–ö–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ': [8,16,24] };
    let b_labels=[], b_data=[], b_desc="";
    let id_to_rank = {}; for(let r in state.bratus) state.bratus[r].forEach(id => id_to_rank[id] = parseInt(r));
    for(let c in cats_map) { 
        let sum = 0; cats_map[c].forEach(id => sum += (id_to_rank[id] || 0)); 
        b_labels.push(c); b_data.push(sum);
        let status = sum <= 9 ? "<span style='color:green'>–î–æ–º–∏–Ω–∏—Ä—É—é—Ç</span>" : (sum <= 17 ? "–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ" : "<span style='color:red'>–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã —Å–ª–∞–±–æ</span>");
        b_desc += `<div><b>${c}:</b> ${sum} (${status})</div>`;
    }

    // 2. –ú–ò–õ–¨–ú–ê–ù
    const m_keys = [ ['P','P','O','D','OD','S','DR','DR'], ['P','K','K','S','S','DR','DR','OD'], ['P','K','O','OD','OD','-','D','P'], ['D','O','OD','D','DR','P','OD','K'], ['P','K','K','OD','DR','DR','OD','P'], ['D','D','O','S','-','DR','OD','P'], ['K','O','S','S','P','DR','DR','O'], ['P','O','S','O','DR','OD','DR','S'], ['K','D','S','S','O','S','D','K'], ['O','OD','P','S','P','OD','DR','-'], ['P','K','K','O','S','S','OD','DR'], ['P','K','K','DR','S','S','OD','P'], ['ast','ast','ast','ast','st','st','st','st'], ['ast','ast','ast','ast','st','st','st','st'] ];
    const sub_map = {
  0:'life_ideal',
  1:'work_ideal',
  2:'life_real',
  3:'work_real',

  4:'life_ideal',
  5:'work_ideal',
  6:'life_real',
  7:'work_real',

  8:'life_ideal',
  9:'work_ideal',
  10:'life_real',
  11:'work_real'
};
let m_scores = {
  life: {
    ideal: { P:0,K:0,S:0,O:0,D:0,DR:0,OD:0 },
    real:  { P:0,K:0,S:0,O:0,D:0,DR:0,OD:0 }
  },
  work: {
    ideal: { P:0,K:0,S:0,O:0,D:0,DR:0,OD:0 },
    real:  { P:0,K:0,S:0,O:0,D:0,DR:0,OD:0 }
  }
};
   // –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
   window.emo = { E_st:0, E_ast:0, F_st:0, F_ast:0 };
let emo = window.emo;

// –ü–æ–¥—Å—á—ë—Ç –ú–∏–ª—å–º–∞–Ω–∞
for(let q = 0; q < 14; q++) {

    if (q < 12) { 
        // ===== –ú–û–¢–ò–í–ê–¶–ò–Ø =====
        let sub = sub_map[q]; // life_ideal, work_real –∏ —Ç.–ø.
        let [scope, state2] = sub.split('_'); // life/work , ideal/real

        for(let i = 0; i < 8; i++) {
            let val = state.milman[`${q}_${i}`] || 0;
            let scale = m_keys[q][i];

            if(scale !== '-' && m_scores[scope][state2][scale] !== undefined) {
                m_scores[scope][state2][scale] += val;
            }
        }

    } else {
        // ===== –≠–ú–û–¶–ò–ò =====
        for(let i = 0; i < 8; i++) {
            let val = state.milman[`${q}_${i}`] || 0;
            let scale = m_keys[q][i]; // 'st' –∏–ª–∏ 'ast'
            
            if(q === 12) { 
                // –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
                if(scale === 'st') emo.E_st += val;
                if(scale === 'ast') emo.E_ast += val;
            }

            if(q === 13) {
                // –§—Ä—É—Å—Ç—Ä–∞—Ü–∏—è
                if(scale === 'st') emo.F_st += val;
                if(scale === 'ast') emo.F_ast += val;
            }
        }
    }
}
   let emoIsUndefined = false;
   let emoTypeText = "<span class='score-badge bg-blue'>–ù–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω</span> –ù–µ —É–¥–∞—ë—Ç—Å—è –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –æ—Ç–Ω–µ—Å—Ç–∏ –ø—Ä–æ—Ñ–∏–ª—å –∫ –æ–¥–Ω–æ–º—É –∏–∑ —Ç–∏–ø–æ–≤";

if (emo.E_st > emo.E_ast && emo.F_st > emo.F_ast) {
    emoTypeText = "<span class='score-badge bg-blue'>–°—Ç–µ–Ω–∏—á–µ—Å–∫–∏–π</span> ‚Äî –¥–µ—è—Ç–µ–ª—å–Ω—ã–π –∏ —É—Å—Ç–æ–π—á–∏–≤—ã–π —Ç–∏–ø. –í—ã –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ –∞–∫—Ç–∏–≤–Ω—ã–µ, –±–æ–¥—Ä—ã–µ —ç–º–æ—Ü–∏–∏, –Ω–æ –∏ –≤ —Ç—Ä—É–¥–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö –¥–µ–π—Å—Ç–≤—É–µ—Ç–µ —Å–æ–±—Ä–∞–Ω–Ω–æ, –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–æ –∏ –Ω–µ –ø–∞–¥–∞–µ—Ç–µ –¥—É—Ö–æ–º. –°—Ç—Ä–µ—Å—Å –≤–∞—Å –º–æ–±–∏–ª–∏–∑—É–µ—Ç.";
}
else if (emo.E_ast > emo.E_st && emo.F_ast > emo.F_st) {
    emoTypeText = "<span class='score-badge bg-blue'>–ê—Å—Ç–µ–Ω–∏—á–µ—Å–∫–∏–π</span> ‚Äî —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ç–∏–ø, —Å—Ç—Ä–µ–º—è—â–∏–π—Å—è –∫ –≥–∞—Ä–º–æ–Ω–∏–∏ –∏ –ø–æ–∫–æ—é. –í—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ —Å–ø–æ–∫–æ–π–Ω—ã–µ, –ø—Ä–∏—è—Ç–Ω—ã–µ —ç–º–æ—Ü–∏–∏, –∞ –≤ —Å—Ç—Ä–µ—Å—Å–µ —Å–∫–ª–æ–Ω–Ω—ã –ø–µ—Ä–µ–∂–∏–≤–∞—Ç—å, —Ä–∞–∑–¥—Ä–∞–∂–∞—Ç—å—Å—è –∏–ª–∏ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –±–µ—Å–ø–æ–º–æ—â–Ω–æ—Å—Ç—å. –í–∞–º —Å–ª–µ–¥—É–µ—Ç –∏–∑–±–µ–≥–∞—Ç—å –ø–µ—Ä–µ–≥—Ä—É–∑–æ–∫.";
}
else if (emo.E_ast > emo.E_st && emo.F_st > emo.F_ast) {
    emoTypeText = "<span class='score-badge bg-blue'>–°–º–µ—à–∞–Ω–Ω—ã–π —Å—Ç–µ–Ω–∏—á–µ—Å–∫–∏–π</span> –í –æ–±—ã—á–Ω–æ–π –∂–∏–∑–Ω–∏ –≤–∞–º –ø–æ –¥—É—à–µ —É—é—Ç, –≥–∞—Ä–º–æ–Ω–∏—è –∏ –ø—Ä–∏—è—Ç–Ω—ã–µ —ç–º–æ—Ü–∏–∏. –ù–æ –∫–æ–≥–¥–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –≤—ã–∑–æ–≤, –≤—ã —É–º–µ–µ—Ç–µ —Å–æ–±—Ä–∞—Ç—å—Å—è, —Å—Ç–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–º –∏ –Ω–∞—á–∞—Ç—å –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ. –í–∞—à–∞ —Å–∏–ª–∞ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –Ω—É–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç.";
}
else if (emo.E_st > emo.E_ast && emo.F_ast > emo.F_st) {
    emoTypeText = "<span class='score-badge bg-blue'>–°–º–µ—à–∞–Ω–Ω—ã–π –∞—Å—Ç–µ–Ω–∏—á–µ—Å–∫–∏–π</span> –í—ã —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã–π –∏ —ç–Ω–µ—Ä–≥–∏—á–Ω—ã–π —á–µ–ª–æ–≤–µ–∫ –≤ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ—Å—Ç–∏. –û–¥–Ω–∞–∫–æ –≤ —Å–∏—Ç—É–∞—Ü–∏—è—Ö –¥–∞–≤–ª–µ–Ω–∏—è, –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏–ª–∏ –Ω–µ—É–¥–∞—á —ç—Ç–∞ —ç–Ω–µ—Ä–≥–∏—è –º–æ–∂–µ—Ç —Å–º–µ–Ω–∏—Ç—å—Å—è —Ä–∞—Å—Ç–µ—Ä—è–Ω–Ω–æ—Å—Ç—å—é, —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ–º –∏–ª–∏ –æ–±–∏–¥–æ–π. –í–∞–º –Ω—É–∂–Ω–æ —É—á–∏—Ç—å—Å—è –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ—é –∞–∫—Ç–∏–≤–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é –Ω–∞ –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–µ–π.";
}
else {
    emoIsUndefined = true;
}
window.emoIsUndefined = emoIsUndefined;
window.emoTypeText = emoTypeText;
const warning = document.getElementById("emoWarningBlock");

if (emoTypeText === "<span class='score-badge bg-blue'>–ù–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω</span> –ù–µ —É–¥–∞—ë—Ç—Å—è –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –æ—Ç–Ω–µ—Å—Ç–∏ –ø—Ä–æ—Ñ–∏–ª—å –∫ –æ–¥–Ω–æ–º—É –∏–∑ —Ç–∏–ø–æ–≤") {
    warning.style.display = "block";
    warning.innerHTML = `
<b>‚ö†Ô∏è –ü–æ—á–µ–º—É —Ç–∏–ø –≤–∞—à–µ–≥–æ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–∏–ª—Å—è?</b><br><br>
–¢–µ—Å—Ç —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –¥–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞: –æ–±—ã—á–Ω–æ–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ —Å—Ç—Ä–µ—Å—Å.  
–í –≤–∞—à–µ–º —Å–ª—É—á–∞–µ –±–∞–ª–ª—ã –ø–æ –æ–¥–Ω–æ–º—É –∏–ª–∏ –æ–±–æ–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –æ–∫–∞–∑–∞–ª–∏—Å—å —Ä–∞–≤–Ω—ã–º–∏, –ø–æ—ç—Ç–æ–º—É –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–æ–π —Å—Ç–∏–ª—å –ø—Ä–µ–æ–±–ª–∞–¥–∞–µ—Ç.<br><br>

<b>–≠—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞.</b> –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –±–∞–ª–∞–Ω—Å–µ –∏–ª–∏ –≤—ã –≥–∏–±–∫–æ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö. –î–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ —á–µ—Ä–µ–∑ –≤—Ä–µ–º—è –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É –¥–ª—è –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ—Å—Ç–æ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ —Ä–∞–º–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏.
`;
} else {
    warning.style.display = "none";
}
// ===== –î–ê–ù–ù–´–ï –î–õ–Ø –ì–†–ê–§–ò–ö–û–í –ú–ò–õ–¨–ú–ê–ù–ê =====

const scales_order = ['P','K','S','O','D','DR','OD'];
const scales_names = [
  '–ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ',
  '–ö–æ–º—Ñ–æ—Ä—Ç',
  '–°–æ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å',
  '–û–±—â–µ–Ω–∏–µ',
  '–û–±—â–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å',
  '–¢–≤–æ—Ä—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å',
  '–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–æ–ª—å–∑–∞'
];

// –ñ–ò–ó–ù–¨
let life_ideal_data = scales_order.map(s => m_scores.life.ideal[s]);
let life_real_data  = scales_order.map(s => m_scores.life.real[s]);

// –†–ê–ë–û–¢–ê
let work_ideal_data = scales_order.map(s => m_scores.work.ideal[s]);
let work_real_data  = scales_order.map(s => m_scores.work.real[s]);
// ===== –ò–ù–¢–ï–ì–†–ê–õ–¨–ù–´–ô –ü–†–û–§–ò–õ–¨ =====
let integral_ideal_data = scales_order.map((s, i) =>
    (life_ideal_data[i] + work_ideal_data[i]) / 2
);

let integral_real_data = scales_order.map((s, i) =>
    (life_real_data[i] + work_real_data[i]) / 2
);
window.milmanData = {
    scales_names,
    life_ideal_data,
    life_real_data,
    work_ideal_data,
    work_real_data
};  
// –û–ë–™–ï–ö–¢ –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê –¢–ò–ü–ê
let integral = {};
scales_order.forEach((s, i) => {
    integral[s] = integral_ideal_data[i];
});
// ===== –¢–ò–ü –ú–û–¢–ò–í–ê–¶–ò–û–ù–ù–û–ì–û –ü–†–û–§–ò–õ–Ø (–ü–û –ò–ù–¢–ï–ì–†–ê–õ–£ –ò–î–ï–ê–õ–û–í) =====

let sum_develop = integral.D + integral.DR + integral.OD;
let sum_maintain = integral.P + integral.K + integral.S;
let diff = sum_develop - sum_maintain;

let motivationTypeText = "";

if (diff >= 5) {
    motivationTypeText = "<span class='score-badge bg-blue'>–ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π</span> –í—ã ‚Äî —á–µ–ª–æ–≤–µ–∫ —Ä–æ—Å—Ç–∞. –î–ª—è –≤–∞—Å –≤–∞–∂–Ω–µ–µ –¥–≤–∏–≥–∞—Ç—å—Å—è –≤–ø–µ—Ä—ë–¥, –æ—Å–≤–∞–∏–≤–∞—Ç—å –Ω–æ–≤–æ–µ –∏ —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è, —á–µ–º –ø—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–µ–∫—É—â–µ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –¥–µ–ª. –≠—Ç–æ –∫–∞—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–æ –≤–µ–¥—ë—Ç –∫ —É—Å–ø–µ—Ö—É –≤ —Ä–∞–±–æ—Ç–µ –∏ —É—á—ë–±–µ.";
}
else if (diff <= -5) {
    motivationTypeText = "<span class='score-badge bg-blue'>–†–µ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π</span> –î–ª—è –≤–∞—Å –≥–ª–∞–≤–Ω–æ–µ ‚Äî —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –∫–æ–º—Ñ–æ—Ä—Ç –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ —É–∂–µ –µ—Å—Ç—å. –ú–æ—Ç–∏–≤—ã ¬´–æ—Å—Ç–∞–≤–∏—Ç—å –≤—Å—ë –∫–∞–∫ –µ—Å—Ç—å¬ª –æ–±—ã—á–Ω–æ —Å–∏–ª—å–Ω–µ–µ, —á–µ–º –∂–µ–ª–∞–Ω–∏–µ —Ä–∏—Å–∫–æ–≤–∞—Ç—å –∏ –º–µ–Ω—è—Ç—å—Å—è. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –∑–∞—Å—Ç–æ—é.";
}
else {
    // —Å—á–∏—Ç–∞–µ–º –ø–∏–∫–∏
    let values = scales_order.map(s => integral[s]);
    let peaks = 0;

    for(let i = 0; i < values.length; i++) {
        let v = values[i];

        if (i === 0) {
            if (v >= values[1] + 4) peaks++;
        }
        else if (i === values.length - 1) {
            if (v >= values[values.length - 2] + 4) peaks++;
        }
        else {
            if (v >= values[i-1] + 2 && v >= values[i+1] + 2) peaks++;
        }
    }

    if (peaks >= 3) motivationTypeText = "<span class='score-badge bg-blue'>–ò–º–ø—É–ª—å—Å–∏–≤–Ω—ã–π</span> –í–∞—à–∞ –º–æ—Ç–∏–≤–∞—Ü–∏—è ‚Äî —ç—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–∞—á–µ–ª–∏. –£ –≤–∞—Å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—á–µ–Ω—å —Å–∏–ª—å–Ω—ã—Ö, –Ω–æ —Ä–∞–∑–Ω—ã—Ö –∏ –¥–∞–∂–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã—Ö –∂–µ–ª–∞–Ω–∏–π. –ò–∑-–∑–∞ —ç—Ç–æ–≥–æ –≤–∞—à–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –∏ —ç–Ω–µ—Ä–≥–∏—è –º–æ–≥—É—Ç —á–∞—Å—Ç–æ –∏ —Ä–µ–∑–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è.";
    else if (peaks === 2) motivationTypeText = "<span class='score-badge bg-blue'>–≠–∫—Å–ø—Ä–µ—Å—Å–∏–≤–Ω—ã–π</span> –£ –≤–∞—Å —á—ë—Ç–∫–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã: –≤—ã —è—Ä–∫–æ –≤—ã–¥–µ–ª—è–µ—Ç–µ —á—Ç–æ-—Ç–æ –≤–∞–∂–Ω–æ–µ –¥–ª—è —Å–µ–±—è –∫–∞–∫ –≤ —Å—Ñ–µ—Ä–µ –∫–æ–º—Ñ–æ—Ä—Ç–∞, —Ç–∞–∫ –∏ –≤ —Å—Ñ–µ—Ä–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π. –í—ã —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ —Å–∞–º–æ—É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—é –∏ –ª—é–±–∏—Ç–µ, –∫–æ–≥–¥–∞ –≤–∞—à–∏ —É—Å–ø–µ—Ö–∏ –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞–º–µ—á–∞—é—Ç –¥—Ä—É–≥–∏–µ.";
    else motivationTypeText = "<span class='score-badge bg-blue'>–£–ø–ª–æ—â–µ–Ω–Ω—ã–π</span> –£ –≤–∞—Å –Ω–µ—Ç —è—Ä–∫–æ –≤—ã—Ä–∞–∂–µ–Ω–Ω—ã—Ö ¬´–≤–µ—Ä—à–∏–Ω¬ª –∏–ª–∏ ¬´–ø—Ä–æ–≤–∞–ª–æ–≤¬ª —Å—Ä–µ–¥–∏ –º–æ—Ç–∏–≤–æ–≤ ‚Äî –≤—Å–µ –æ–Ω–∏ –≤—ã—Ä–∞–∂–µ–Ω—ã –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ. –≠—Ç–æ –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å, —á—Ç–æ –ø–æ–∫–∞ –Ω–µ—Ç —á—ë—Ç–∫–∏—Ö –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –∏–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∫–∞—Ä—Ç–∏–Ω–∞ –∂–µ–ª–∞–Ω–∏–π –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —è—Å–Ω–∞. –ó–∞–º–µ—Ç–Ω–∞ —Ç–µ–Ω–¥–µ–Ω—Ü–∏—è –µ–≥–æ —É–º–µ–Ω—å—à–µ–Ω–∏—è —Å –≤–æ–∑—Ä–∞—Å—Ç–æ–º.";
}

    // 3. –ò–ü–õ
    let ipl_sum = 0;
    let rev_idx = [0, 4, 6, 8, 9, 13, 14, 15, 19, 21, 23, 24, 25, 26, 27, 30, 31, 32];
    for(let i=0; i<36; i++) { let val = state.ipl[i]; if(rev_idx.includes(i)) val = 6 - val; ipl_sum += val; }
    // ===== –≠–¢–ê–ü 1. –¢–∏–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ò–ü–õ (6 —à–∫–∞–ª) =====
// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –ø–æ –Ω–æ–º–µ—Ä—É –≤–æ–ø—Ä–æ—Å–∞ (1-based)
function A(q) {
    return state.ipl[q - 1] || 0;
}
// 6 —Ç–∏–ø–æ–≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ë–ï–ó –∏–Ω–≤–µ—Ä—Å–∏–π, —Å—Ç—Ä–æ–≥–æ –ø–æ –º–µ—Ç–æ–¥–∏–∫–µ)
let ipl_types = {
    OI: A(8) + A(13) + A(17) + A(21) + A(30) + A(34),
    FN: A(1) + A(5) + A(16) + A(24) + A(25) + A(32),

    PD: A(2) + A(6) + A(18) + A(19) + A(23) + A(29),
    NG: A(9) + A(14) + A(22) + A(27) + A(28) + A(33),

    IP: A(3) + A(4) + A(11) + A(12) + A(35) + A(36),
    VP: A(7) + A(10) + A(15) + A(20) + A(26) + A(31)
};
// ===== –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –°–¢–ò–õ–Ø –ò–ü–õ =====
function pick(aName, aVal, bName, bVal) {
    if (aVal > bVal) return aName;
    if (bVal > aVal) return bName;
    return null; // —Ä–∞–≤–Ω—ã ‚Äî –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ
}
let t1 = pick("OI", ipl_types.OI, "FN", ipl_types.FN);
let t2 = pick("PD", ipl_types.PD, "NG", ipl_types.NG);
let t3 = pick("IP", ipl_types.IP, "VP", ipl_types.VP);
let iplStyleKey = null;
let iplStyleText = null;
let iplStyleDefined = true;
if (!t1 || !t2 || !t3) {
    iplStyleDefined = false;
} else {
    iplStyleKey = `${t1}_${t2}_${t3}`;
}
const IPL_STYLE_DESCRIPTIONS = {
    "OI_NG_VP": {
    title: "–û—Å–º—ã—Å–ª–µ–Ω–Ω–æ-–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–π / –ù–µ–≥–∞—Ç–∏–≤–Ω–æ-–≥–µ–Ω–µ—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π / –í—ã–Ω—É–∂–¥–µ–Ω–Ω–æ-–ø—Ä–∏—Å–ø–æ—Å–æ–±–∏—Ç–µ–ª—å–Ω—ã–π",
    text: "–í—ã –∞–∫—Ç–∏–≤–Ω–æ –∏ –æ—Å–º—ã—Å–ª–µ–Ω–Ω–æ –∏—â–µ—Ç–µ –Ω–æ–≤–æ–µ, –Ω–æ –≤ —Ü–µ–ª–æ–º —Å–∫–ª–æ–Ω–Ω—ã –Ω–∞—Å—Ç–æ—Ä–æ–∂–µ–Ω–Ω–æ –∏ –æ–±–æ–±—â—ë–Ω–Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç—å—Å—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º. –í –ø–æ–≤–µ–¥–µ–Ω–∏–∏ —á–∞—â–µ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç–µ—Å—å –∫ —Å–∏—Ç—É–∞—Ü–∏–∏, —á–µ–º –ø—ã—Ç–∞–µ—Ç–µ—Å—å –µ—ë –∏–∑–º–µ–Ω–∏—Ç—å. –≠—Ç–æ –ø—Ä–æ—Ñ–∏–ª—å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è: –≤—ã –º–Ω–æ–≥–æ –Ω–∞–±–ª—é–¥–∞–µ—Ç–µ –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç–µ, –Ω–æ –¥–µ–π—Å—Ç–≤—É–µ—Ç–µ —Å–¥–µ—Ä–∂–∞–Ω–Ω–æ –∏ –Ω–µ —Å—Ä–∞–∑—É."
  },
  "OI_PD_VP": {
    title: "–û—Å–º—ã—Å–ª–µ–Ω–Ω–æ-–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–π / –ü–æ–∑–∏—Ç–∏–≤–Ω–æ-–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π / –í—ã–Ω—É–∂–¥–µ–Ω–Ω–æ-–ø—Ä–∏—Å–ø–æ—Å–æ–±–∏—Ç–µ–ª—å–Ω—ã–π",
    text: "–í—ã –∞–∫—Ç–∏–≤–Ω–æ –∏—â–µ—Ç–µ –Ω–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –≤ —Ü–µ–ª–æ–º –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ—Å—å –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º, –Ω–æ –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏ —á–∞—â–µ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç–µ—Å—å –ø–æ–¥ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞, —á–µ–º –ø—ã—Ç–∞–µ—Ç–µ—Å—å –∏—Ö –º–µ–Ω—è—Ç—å. –í—ã —Å–∫–ª–æ–Ω–Ω—ã —Å–Ω–∞—á–∞–ª–∞ –ø–æ–Ω—è—Ç—å –∏ –ø—Ä–∏–Ω—è—Ç—å –Ω–æ–≤–æ–µ, –ø—Ä–µ–∂–¥–µ —á–µ–º –Ω–∞—á–∏–Ω–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è."
  },
  "OI_NG_IP": {
    title: "–û—Å–º—ã—Å–ª–µ–Ω–Ω–æ-–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–π / –ù–µ–≥–∞—Ç–∏–≤–Ω–æ-–≥–µ–Ω–µ—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π / –ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–Ω–æ-–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π",
    text: "–í—ã –∞–∫—Ç–∏–≤–Ω–æ –∏—â–µ—Ç–µ –Ω–æ–≤–æ–µ –∏ —Å–∫–ª–æ–Ω–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–Ω–æ—Å–∏—Ç—å—Å—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º, –µ—Å–ª–∏ —Å—á–∏—Ç–∞–µ—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é –≤–∞–∂–Ω–æ–π, –¥–µ–π—Å—Ç–≤—É–µ—Ç–µ —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ –∏ —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –µ—ë –∏–∑–º–µ–Ω–∏—Ç—å. –≠—Ç–æ –ø—Ä–æ—Ñ–∏–ª—å —á–µ–ª–æ–≤–µ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–æ–≤—à–µ—Å—Ç–≤–∞ –Ω–∞ –≤–µ—Ä—É, –Ω–æ –≥–æ—Ç–æ–≤ –±–æ—Ä–æ—Ç—å—Å—è –∑–∞ –Ω—É–∂–Ω—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è."
  },
  "OI_PD_IP": {
    title: "–û—Å–º—ã—Å–ª–µ–Ω–Ω–æ-–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–π / –ü–æ–∑–∏—Ç–∏–≤–Ω–æ-–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π / –ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–Ω–æ-–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π",
    text: "–í—ã –∞–∫—Ç–∏–≤–Ω–æ –∏—â–µ—Ç–µ –Ω–æ–≤–æ–µ, –ø–æ–∑–∏—Ç–∏–≤–Ω–æ –∏ –æ—Å–º—ã—Å–ª–µ–Ω–Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ—Å—å –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –∏ –≥–æ—Ç–æ–≤—ã —Å–∞–º–∏ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è. –≠—Ç–æ –Ω–∞–∏–±–æ–ª–µ–µ ¬´–∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–π¬ª –ø—Ä–æ—Ñ–∏–ª—å: –≤—ã –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ –Ω–æ–≤–æ–µ, –Ω–æ –∏ —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –≤–æ–ø–ª–æ—â–∞—Ç—å –µ–≥–æ –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å."
  },
  "FN_PD_IP": {
    title: "–§–æ—Ä–º–∞–ª—å–Ω–æ-–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å—Å–∫–∏–π / –ü–æ–∑–∏—Ç–∏–≤–Ω–æ-–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π / –ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–Ω–æ-–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π",
    text: "–í—ã —Å–∫–æ—Ä–µ–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, —á–µ–º –∞–∫—Ç–∏–≤–Ω–æ –∏—â–µ—Ç–µ –µ—ë, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –≤ —Ü–µ–ª–æ–º –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ—Å—å –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –∏ —Å–ø–æ—Å–æ–±–Ω—ã –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–Ω–æ. –ß–∞—Å—Ç–æ –≤—ã –Ω–∞—á–∏–Ω–∞–µ—Ç–µ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å, –∫–æ–≥–¥–∞ –≤–∏–¥–∏—Ç–µ –ø–æ–Ω—è—Ç–Ω—É—é –∏ –ø–æ–ª–µ–∑–Ω—É—é —Ü–µ–ª—å."
  },
  "FN_NG_IP": {
    title: "–§–æ—Ä–º–∞–ª—å–Ω–æ-–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å—Å–∫–∏–π / –ù–µ–≥–∞—Ç–∏–≤–Ω–æ-–≥–µ–Ω–µ—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π / –ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–Ω–æ-–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π",
    text: "–í—ã —Å–∫–ª–æ–Ω–Ω—ã –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ –∏ –∫—Ä–∏—Ç–∏—á–Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç—å—Å—è –∫ –Ω–æ–≤–æ–º—É, –Ω–µ —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∞–∫—Ç–∏–≤–Ω–æ –µ–≥–æ –∏—Å–∫–∞—Ç—å, –Ω–æ –≤ –≤–∞–∂–Ω—ã—Ö –¥–ª—è —Å–µ–±—è —Å–∏—Ç—É–∞—Ü–∏—è—Ö –º–æ–∂–µ—Ç–µ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ –∏ –Ω–∞—Å—Ç–æ–π—á–∏–≤–æ, –ø—ã—Ç–∞—è—Å—å –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–ª–æ–∂–µ–Ω–∏–µ –¥–µ–ª."
  },
  "FN_PD_VP": {
    title: "–§–æ—Ä–º–∞–ª—å–Ω–æ-–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å—Å–∫–∏–π / –ü–æ–∑–∏—Ç–∏–≤–Ω–æ-–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π / –í—ã–Ω—É–∂–¥–µ–Ω–Ω–æ-–ø—Ä–∏—Å–ø–æ—Å–æ–±–∏—Ç–µ–ª—å–Ω—ã–π",
    text: "–í—ã —Å–∫–æ—Ä–µ–µ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ –∏ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, —á–µ–º –∞–∫—Ç–∏–≤–Ω–æ –µ—ë –∏—â–µ—Ç–µ, –≤ —Ü–µ–ª–æ–º –Ω–µ–ø–ª–æ—Ö–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ—Å—å –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º, –Ω–æ –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏ —á–∞—â–µ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç–µ—Å—å –∫ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞–º, —á–µ–º –ø—ã—Ç–∞–µ—Ç–µ—Å—å –∏—Ö –º–µ–Ω—è—Ç—å."
  },
  "FN_NG_VP": {
    title: "–§–æ—Ä–º–∞–ª—å–Ω–æ-–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å—Å–∫–∏–π / –ù–µ–≥–∞—Ç–∏–≤–Ω–æ-–≥–µ–Ω–µ—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π / –í—ã–Ω—É–∂–¥–µ–Ω–Ω–æ-–ø—Ä–∏—Å–ø–æ—Å–æ–±–∏—Ç–µ–ª—å–Ω—ã–π",
    text: "–í—ã –Ω–µ —Å–∫–ª–æ–Ω–Ω—ã –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–∫–∞—Ç—å –Ω–æ–≤–æ–µ, –æ—Ç–Ω–æ—Å–∏—Ç–µ—Å—å –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º —Å–∫–æ—Ä–µ–µ –Ω–∞—Å—Ç–æ—Ä–æ–∂–µ–Ω–Ω–æ –∏ –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ –ø—Ä–∏—Å–ø–æ—Å–∞–±–ª–∏–≤–∞—Ç—å—Å—è –∫ —Å–∏—Ç—É–∞—Ü–∏–∏. –≠—Ç–æ –ø—Ä–æ—Ñ–∏–ª—å –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞."
  }
};
    // ===== –≠–¢–ê–ü 2. –ê—Å–ø–µ–∫—Ç—ã –ò–ü–õ (–ì, –ê, –ü) =====
    // —Ñ—É–Ω–∫—Ü–∏—è —Å —É—á—ë—Ç–æ–º –∏–Ω–≤–µ—Ä—Å–∏–π
function A2(q, inv = false) {
    let v = state.ipl[q - 1] || 0;
    return inv ? (6 - v) : v;
}
let ipl_aspects = {
    G: A2(1,true) + A2(5,true) + A2(8) + A2(13) + A2(16,true) + A2(17) + A2(21) + 
       A2(24,true) + A2(25,true) + A2(30) + A2(32,true) + A2(34),

    A: A2(2) + A2(6) + A2(9,true) + A2(14,true) + A2(18) + A2(19) +
       A2(22,true) + A2(23) + A2(27,true) + A2(28,true) + A2(29) + A2(33,true),

    P: A2(3) + A2(4) + A2(7,true) + A2(10,true) + A2(11) + A2(12) +
       A2(15,true) + A2(20,true) + A2(26,true) + A2(31,true) + A2(35) + A2(36)
};
    // ===== –≠–¢–ê–ü 3. –£—Ä–æ–≤–Ω–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –º–∏—Ä–æ–º =====

let ipl_levels = {
    nature:
        A2(1,true) + A2(6) + A2(7,true) + A2(8) + A2(12) +
        A2(19) + A2(21) + A2(28,true) + A2(35),

    social:
        A2(2) + A2(5,true) + A2(9,true) + A2(11) +
        A2(22,true) + A2(26,true) + A2(31,true) + A2(32,true) + A2(34),

    culture:
        A2(3) + A2(10,true) + A2(13) + A2(14,true) +
        A2(16,true) + A2(20,true) + A2(23) + A2(24,true) + A2(27,true),

    life:
        A2(4) + A2(15,true) + A2(17) + A2(18) +
        A2(25,true) + A2(29) + A2(30) + A2(33,true) + A2(36)
};
function renderBigScalesBlock(title, dataArr, maxValue, color, labelsMap) {
    let html = `
        <div style="margin-top:25px;">
            <h3 style="margin-bottom:15px;">${title}</h3>
    `;

    dataArr.forEach(item => {
        let percent = Math.max(5, (item.value / maxValue) * 100);

        html += `
            <div style="margin-bottom:14px;">
                <div style="display:flex; justify-content:space-between; font-size:1.05em; margin-bottom:4px;">
                    <div><b>${labelsMap[item.key]}</b></div>
                    <div><b>${item.value}</b></div>
                </div>

                <div style="background:#eee; border-radius:8px; overflow:hidden; height:22px;">
                    <div style="width:${percent}%; height:100%; background:${color};"></div>
                </div>
            </div>
        `;
    });

    html += `
        <div style="display:flex; justify-content:space-between; font-size:0.9em; color:#666; margin-top:4px;">
            <div>0</div>
            <div>${maxValue}</div>
        </div>
        </div>
    `;

    return html;
}
//—à–∫–∞–ª—ã —Ç–∏–ø–æ–≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞
function renderScalesBlock(title, dataObj, maxValue, color, descriptionHTML = "") {
    let html = `
    <div style="
        margin-top:25px;
        padding:18px;
        border-radius:12px;
        background:#f8f9fa;
        border:1px solid #ddd;
    ">
        <h2 style="margin-top:0;">${title}</h2>
        ${descriptionHTML}
    `;

    for (let key in dataObj) {
        let val = dataObj[key];
        let percent = Math.max(2, (val / maxValue) * 100);

        html += `
        <div style="display:flex; justify-content:space-between; font-size:1.05em; margin-bottom:4px;">
    <div style="max-width:85%;">
        <b>${key}</b>
    </div>
    <div><b>${val}</b></div>
</div>
                <div style="background:#eee; border-radius:8px; overflow:hidden; height:22px;">
                    <div style="width:${percent}%; height:100%; background:${color};"></div>
                </div>
            </div>
        `;
    }

    html += `
        <div style="display:flex; justify-content:space-between; font-size:0.85em; color:#666; margin-top:-5px;">
            <div>0</div>
            <div>${maxValue}</div>
        </div>
    </div>
    `;

    return html;
}
//–≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–∞—Ä —Ç–∏–ø–æ–≤ —Ä–µ–∞–∫—Ü–∏–π
function renderIPLTypesPairs(ipl_types) {
    const MAX = 30; // 6 –≤–æ–ø—Ä–æ—Å–æ–≤ * 5 –±–∞–ª–ª–æ–≤

    function bar(name, value, isWinner, isEqual) {
        let base = "rgb(0,128,128)";
        let bg = isWinner ? base : "rgba(0,128,128,0.35)";
        let border = isWinner ? "3px solid #004d4d" : "1px solid #ccc";

        if (isEqual) {
            bg = "rgba(160,160,160,0.4)";
            border = "1px dashed #888";
        }

        let percent = Math.max(3, value / MAX * 100);

        return `
        <div style="margin-bottom:8px;">
            <div style="display:flex; justify-content:space-between; font-size:1.1em;">
                <div><b>${name}</b></div>
                <div>${value}</div>
            </div>
            <div style="background:#eee; border-radius:6px; overflow:hidden; height:18px; border:${border}">
                <div style="width:${percent}%; height:100%; background:${bg};"></div>
            </div>
        </div>
        `;
    }

    function pairBlock(title, desc, aKey, aName, bKey, bName) {
        let a = ipl_types[aKey];
        let b = ipl_types[bKey];

        let aWin = a > b;
        let bWin = b > a;
        let isEqual = a === b;

        let note = "";
        if (isEqual) {
            note = `<div style="margin-top:6px; font-size:0.85em; color:#555;">‚öñÔ∏è –†–∞–∑–ª–∏—á–∏—è –Ω–µ –≤—ã—è–≤–ª–µ–Ω—ã</div>`;
        }

        return `
        <div style="border:1px solid #ddd; border-radius:10px; padding:12px; margin-bottom:15px;">
            <div style="font-size:1.1em; line-height:1.6; margin-bottom:12px;">${title}</div>
            <div style="font-size:1.1em; line-height:1.6; margin-bottom:12px;">${desc}</div>

            ${bar(aName, a, aWin, isEqual)}
            ${bar(bName, b, bWin, isEqual)}

            <div style="display:flex; justify-content:space-between; font-size:0.8em; color:#666; margin-top:-4px;">
                <div>0</div>
                <div>${MAX}</div>
            </div>

            ${note}
        </div>
        `;
    }

    let html = `
    <h3>–¢–∏–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞</h3>
    <div style="font-size:1.1em; line-height:1.6; margin-bottom:12px;">
        –≠—Ç–∏ —à–∫–∞–ª—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, <b>–∫–∞–∫ –∏–º–µ–Ω–Ω–æ</b> –≤—ã —Ä–µ–∞–ª–∏–∑—É–µ—Ç–µ —Å–≤–æ–∏ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
        –∫–∞–∫ –∏—â–µ—Ç–µ –Ω–æ–≤–æ–µ, –∫–∞–∫ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –∫–∞–∫ –¥–µ–π—Å—Ç–≤—É–µ—Ç–µ –≤ –Ω–æ–≤–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏.
    </div>
    `;

    html += pairBlock(
        "<b>üß† –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</b>",
        "–ö–∞–∫ –≤—ã –∏—â–µ—Ç–µ –∏ –æ—Å–≤–∞–∏–≤–∞–µ—Ç–µ –Ω–æ–≤–æ–µ.",
        "OI", "–û—Å–º—ã—Å–ª–µ–Ω–Ω–æ-–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–π",
        "FN", "–§–æ—Ä–º–∞–ª—å–Ω–æ-–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å—Å–∫–∏–π"
    );

    html += pairBlock(
        "<b>‚öñÔ∏è –û—Ü–µ–Ω–∫–∞ –Ω–æ–≤–æ–≥–æ</b>",
        "–ö–∞–∫ –≤—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ—Å—å –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –∏ –Ω–æ–≤–æ–≤–≤–µ–¥–µ–Ω–∏—è–º.",
        "PD", "–ü–æ–∑–∏—Ç–∏–≤–Ω–æ-–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π",
        "NG", "–ù–µ–≥–∞—Ç–∏–≤–Ω–æ-–≥–µ–Ω–µ—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π"
    );

    html += pairBlock(
        "<b>üöÄ –î–µ–π—Å—Ç–≤–∏–µ –≤ –Ω–æ–≤–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏</b> ",
        "–ö–∞–∫ –≤—ã –≤–µ–¥—ë—Ç–µ —Å–µ–±—è, –∫–æ–≥–¥–∞ —Å–∏—Ç—É–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π.",
        "IP", "–ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–Ω–æ-–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π",
        "VP", "–í—ã–Ω—É–∂–¥–µ–Ω–Ω–æ-–ø—Ä–∏—Å–ø–æ—Å–æ–±–∏—Ç–µ–ª—å–Ω—ã–π"
    );

    return html;
}
    setTimeout(() => {
        if(!immediate) switchStep('step-loading', 'step-results');
        
        document.getElementById('result-area').value = JSON.stringify(state, null, 2);

        
      // --- –ù–û–í–´–ô –í–ò–ó–£–ê–õ –ë–†–ê–¢–£–°–Ø ---

// –°–æ–±–∏—Ä–∞–µ–º –º–∞—Å—Å–∏–≤
let brArr = [];
for(let i=0;i<b_labels.length;i++) {
    brArr.push({ name: b_labels[i], sum: b_data[i] });
}

// –°–æ—Ä—Ç–∏—Ä—É–µ–º: —á–µ–º –º–µ–Ω—å—à–µ —Å—É–º–º–∞ ‚Äî —Ç–µ–º –≤—ã—à–µ
brArr.sort((a,b) => a.sum - b.sum);

// –†–∏—Å—É–µ–º
let html = `<div style="font-weight:bold; text-align:center; margin-bottom:10px;">–ñ–∏–∑–Ω–µ–Ω–Ω—ã–µ —Å–º—ã—Å–ª—ã</div>`;

brArr.forEach(row => {
    let cls = '';
    let color = '';

    if(row.sum <= 9) color = '#27ae60';       // –≤–µ–¥—É—â–∏–µ
    else if(row.sum <= 17) color = '#f1c40f'; // –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ
    else color = '#e74c3c';                   // –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ

    let percent = Math.max(5, (25 - row.sum) / 25 * 100);

    html += `
        <div style="display:flex; align-items:center; margin-bottom:8px; gap:10px;">
            <div style="width:180px; font-size:0.9em;">${row.name}</div>
            <div style="flex:1; background:#eee; border-radius:6px; overflow:hidden; height:18px;">
                <div style="width:${percent}%; height:100%; background:${color};"></div>
            </div>
            <div style="width:40px; text-align:right; font-weight:bold;">${row.sum}</div>
        </div>
    `;
});

html += `
<div style="margin-top:10px; font-size:0.85em;">
    <span style="color:#27ae60; font-weight:bold;">‚ñ†</span> –≤–µ–¥—É—â–∏–µ ‚Üí
    <span style="color:#f1c40f; font-weight:bold;">‚ñ†</span> –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ ‚Üí
    <span style="color:#e74c3c; font-weight:bold;">‚ñ†</span> –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ
</div>
`;
document.getElementById('textBratus').innerHTML = html + '<div style="margin-top:15px;">' + b_desc + '</div>';

        
if(window.chartM) window.chartM.destroy();

window.chartM = new Chart(document.getElementById('chartMilman').getContext('2d'), {
    type: 'line',
    data: {
        labels: scales_names,
        datasets: [
            {
                label: '–ñ–µ–ª–∞–µ–º–æ–µ ‚Äì –ò–¥–µ–∞–ª',
                data: integral_ideal_data,
                borderColor: '#27ae60',
                backgroundColor: 'rgba(39,174,96,0.1)',
                fill: true
            },
            {
                label: '–¢–µ–∫—É—â–µ–µ ‚Äì –†–µ–∞–ª—å–Ω–æ—Å—Ç—å',
                data: integral_real_data,
                borderColor: '#e74c3c',
                backgroundColor: 'rgba(231,76,60,0.1)',
                fill: true
            }
        ]
    },
    options: {
        scales: { y: { min: 0 } }
    }
});
document.getElementById('textMilman').innerHTML = `
    <div style="margin-top:15px; border-top:1px solid #eee; padding-top:10px;">
        –í—ã—à–µ –ø–æ–∫–∞–∑–∞–Ω <b>–æ–±–æ–±—â—ë–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –º–æ—Ç–∏–≤–∞—Ü–∏–∏</b>: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ.
        –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ (–∂–∏–∑–Ω—å, —Ä–∞–±–æ—Ç–∞, —ç–º–æ—Ü–∏–∏) —Å–º. –≤–æ –≤–∫–ª–∞–¥–∫–µ ¬´–ü–æ–¥—Ä–æ–±–Ω–µ–µ¬ª.
        <div style="margin-top:15px; border-top:1px solid #eee; padding-top:10px;">
        <div><b>–¢–∏–ø –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è:</b> ${motivationTypeText}</div>
        <div><p>   </p> </div>
        <div><b>–¢–∏–ø —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è:</b> ${emoTypeText}</div>
    </div>
`;

        let ipl_level = ipl_sum >= 118 ? "–í—ã—Å–æ–∫–∏–π" : (ipl_sum >= 95 ? "–°—Ä–µ–¥–Ω–∏–π" : "–ù–∏–∑–∫–∏–π");
        let ipl_cls = ipl_sum >= 118 ? "bg-green" : (ipl_sum >= 95 ? "bg-blue" : "bg-red");
        let ipl_text = ipl_sum >= 118 ? "<b>–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞ –ª–∏—á–Ω–æ—Å—Ç–∏.</b> –í—ã –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —Ä–∞–∑–≤–∏—Ç–∏–µ, –ø–æ–∏—Å–∫ –Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏. –ù–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∫–æ—Ä–µ–µ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –∫–∞–∫ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤—ã–∑–æ–≤, —á–µ–º –∫–∞–∫ —É–≥—Ä–æ–∑–∞. –í–∞–º —Å–≤–æ–π—Å—Ç–≤–µ–Ω–Ω–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∏—Å–∫–∞—Ç—å –Ω–æ–≤—ã–µ —Å–ø–æ—Å–æ–±—ã –¥–µ–π—Å—Ç–≤–∏–π –∏ –ø–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø—Ä–∏–≤—ã—á–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã. " : (ipl_sum >= 95 ? "<b>–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞ –ª–∏—á–Ω–æ—Å—Ç–∏ .</b> –í—ã –≤ —Ü–µ–ª–æ–º –æ—Ç–∫—Ä—ã—Ç—ã –∫ –Ω–æ–≤–æ–º—É, –Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç–µ –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –∏–∑–±–∏—Ä–∞—Ç–µ–ª—å–Ω–æ –∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ. –ü—Ä–µ–∂–¥–µ —á–µ–º —á—Ç–æ-—Ç–æ –º–µ–Ω—è—Ç—å, –≤–∞–º –≤–∞–∂–Ω–æ –ø–æ–Ω—è—Ç—å —Å–º—ã—Å–ª, –ø–æ–ª—å–∑—É –∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è. –í—ã –≥–æ—Ç–æ–≤—ã –æ—Å–≤–∞–∏–≤–∞—Ç—å –Ω–æ–≤–æ–µ, –µ—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –≤ —ç—Ç–æ–º –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å." : "<b>–ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞ –ª–∏—á–Ω–æ—Å—Ç–∏.</b> –í—ã –≤ —Ü–µ–ª–æ–º –æ—Ç–∫—Ä—ã—Ç—ã –∫ –Ω–æ–≤–æ–º—É, –Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç–µ –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –∏–∑–±–∏—Ä–∞—Ç–µ–ª—å–Ω–æ –∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ. –ü—Ä–µ–∂–¥–µ —á–µ–º —á—Ç–æ-—Ç–æ –º–µ–Ω—è—Ç—å, –≤–∞–º –≤–∞–∂–Ω–æ –ø–æ–Ω—è—Ç—å —Å–º—ã—Å–ª, –ø–æ–ª—å–∑—É –∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è. –í—ã –≥–æ—Ç–æ–≤—ã –æ—Å–≤–∞–∏–≤–∞—Ç—å –Ω–æ–≤–æ–µ, –µ—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –≤ —ç—Ç–æ–º –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å.");
        let iplPercent = Math.round((ipl_sum / 180) * 100);

let iplColor =
    ipl_sum >= 118 ? "linear-gradient(90deg, #2ecc71, #27ae60)" :
    ipl_sum >= 95  ? "linear-gradient(90deg, #3498db, #2980b9)" :
                     "linear-gradient(90deg, #e74c3c, #c0392b)";

        document.getElementById('textIPL').innerHTML = `
            <div style="display:flex; align-items:center; gap:15px; margin-bottom:15px;">
                <div style="font-size:2.5em; font-weight:bold; color:#2c3e50;">${ipl_sum}</div>
                <div><span class="score-badge ${ipl_cls}" style="font-size:1.1em;">–£—Ä–æ–≤–µ–Ω—å: ${ipl_level}</span></div>
            </div>
            <div style="margin-top:15px;">
    <div style="display:flex; justify-content:space-between; font-size:0.9em;">
       
    </div>
    <div style="background:#eee; border-radius:20px; height:30px; overflow:hidden;">
        <div style="height:100%; width:${iplPercent}%; background:${iplColor};"></div>
    </div>
    <p>${ipl_text}</p>
</div>
        `;
        

let detailsHTML = "";
// 1. –¢–∏–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ø–æ–ø–∞—Ä–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ)
detailsHTML += renderIPLTypesPairs(ipl_types);
let styleHTML = `<div style="
    margin-top:25px;
    padding:18px;
    border-radius:12px;
    background:#f8f9fa;
    border:1px solid #ddd;
">`;

styleHTML += `<h2 style="margin-top:0;">üß¨ –°—Ç–∏–ª—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞</h2>`;

if (!iplStyleDefined) {
    styleHTML += `
        <div style="font-size:1.05em;">
            <b>–°—Ç–∏–ª—å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω.</b><br><br>
            –í –æ–¥–Ω–æ–π –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–∞—Ä–∞—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –∑–Ω–∞—á–µ–Ω–∏—è –æ–∫–∞–∑–∞–ª–∏—Å—å —Ä–∞–≤–Ω—ã–º–∏, –ø–æ—ç—Ç–æ–º—É –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥–æ–º–∏–Ω–∏—Ä—É—é—â–∏–π —Ç–∏–ø.
            –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –±–∞–ª–∞–Ω—Å –∏–ª–∏ —Å–º–µ—à–∞–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å, –ª–∏–±–æ —Å–∏—Ç—É–∞—Ü–∏—é, –∫–æ–≥–¥–∞ —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤—ã—Ä–∞–∂–µ–Ω—ã –æ–¥–∏–Ω–∞–∫–æ–≤–æ —Å–∏–ª—å–Ω–æ.<br><br>
            <i>–≠—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞ –∏ –Ω–µ ¬´–ø–ª–æ—Ö–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç¬ª. –¢–∞–∫–æ–π –ø—Ä–æ—Ñ–∏–ª—å –≥–æ–≤–æ—Ä–∏—Ç –æ –≥–∏–±–∫–æ—Å—Ç–∏ –∏–ª–∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤ —Ç–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥ –∂–∏–∑–Ω–∏.</i>
        </div>
    `;
} else {
    const info = IPL_STYLE_DESCRIPTIONS[iplStyleKey];

    styleHTML += `
        <div style="font-size:1.15em; font-weight:bold; margin-bottom:10px;">
            ${info.title}
        </div>
        <div style="font-size:1.05em; line-height:1.6;">
            ${info.text}
        </div>
    `;
}

styleHTML += `</div>`;
// 2. –°—Ç–∏–ª—å
detailsHTML += styleHTML;
//3. ===== –ê–°–ü–ï–ö–¢–´ –ò–ü–õ =====
detailsHTML += renderBigScalesBlock(
    "üß© –ê—Å–ø–µ–∫—Ç—ã –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞",
    [
        { key: "G", value: ipl_aspects.G },
        { key: "A", value: ipl_aspects.A },
        { key: "P", value: ipl_aspects.P }
    ],
    60,
    "rgb(173, 216, 230)",
    {
        G: " –ì–Ω–æ—Å–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞—Å–ø–µ–∫—Ç (–ì) ‚Äì –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∏ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –≤ –Ω–µ–º",
        A: "–ê–∫—Å–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π (–ê) ‚Äì –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞–¥–µ–∫–≤–∞—Ç–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ –Ω–æ–≤–æ–≥–æ —è–≤–ª–µ–Ω–∏—è",
        P: "–ü—Ä–∞–∫—Å–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π (–ü) ‚Äì –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –Ω–æ–≤–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏"
    }
);
// ===== –¢–ò–ü –î–û–ú–ò–ù–ò–†–û–í–ê–ù–ò–Ø –ê–°–ü–ï–ö–¢–û–í =====
let aspectArr = [
    { key: "G", val: ipl_aspects.G },
    { key: "A", val: ipl_aspects.A },
    { key: "P", val: ipl_aspects.P }
];
const aspectKeyRU = {
  G: "–ì",
  A: "–ê",
  P: "–ü"
};
aspectArr.sort((a, b) => b.val - a.val);

// –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞
let aspectsDefined = true;
if (aspectArr[0].val === aspectArr[1].val || aspectArr[1].val === aspectArr[2].val) {
    aspectsDefined = false;
}

let aspectTypeKeyRU = aspectArr.map(x => aspectKeyRU[x.key]).join("");

const ASPECT_DOMINANCE_INFO = {
    "–ü–ì–ê": "–î–æ–º–∏–Ω–∏—Ä—É—é—â–µ–π —è–≤–ª—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–ü), –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å—É–±–¥–æ–º–∏–Ω–∞–Ω—Ç—ã –∏ —Ñ–æ–Ω–∞ –≤—ã—Å—Ç—É–ø–∞—é—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—é –Ω–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–ì) –∏ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ–π –æ—Ü–µ–Ω–∫–µ –Ω–æ–≤—ã—Ö —è–≤–ª–µ–Ω–∏–π (–ê).",
    "–ü–ê–ì": "–î–æ–º–∏–Ω–∏—Ä—É—é—â–µ–π —è–≤–ª—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–ü), –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å—É–±–¥–æ–º–∏–Ω–∞–Ω—Ç—ã –∏ —Ñ–æ–Ω–∞ –≤—ã—Å—Ç—É–ø–∞—é—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ–π –æ—Ü–µ–Ω–∫–µ –Ω–æ–≤—ã—Ö —è–≤–ª–µ–Ω–∏–π (–ê) –∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—é –Ω–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–ì).",

    "–ì–ê–ü": "–î–æ–º–∏–Ω–∏—Ä—É—é—â–µ–π —è–≤–ª—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—é –Ω–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–ì), –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å—É–±–¥–æ–º–∏–Ω–∞–Ω—Ç—ã –∏ —Ñ–æ–Ω–∞ –≤—ã—Å—Ç—É–ø–∞—é—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ–π –æ—Ü–µ–Ω–∫–µ –Ω–æ–≤—ã—Ö —è–≤–ª–µ–Ω–∏–π (–ê) –∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–ü).",
    "–ì–ü–ê": "–î–æ–º–∏–Ω–∏—Ä—É—é—â–µ–π —è–≤–ª—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—é –Ω–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–ì), –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å—É–±–¥–æ–º–∏–Ω–∞–Ω—Ç—ã –∏ —Ñ–æ–Ω–∞ –≤—ã—Å—Ç—É–ø–∞—é—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–ü) –∏ –∫ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ–π –æ—Ü–µ–Ω–∫–µ –Ω–æ–≤—ã—Ö —è–≤–ª–µ–Ω–∏–π (–ê).",

    "–ê–ü–ì": "–î–æ–º–∏–Ω–∏—Ä—É—é—â–µ–π —è–≤–ª—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ–π –æ—Ü–µ–Ω–∫–µ –Ω–æ–≤—ã—Ö —è–≤–ª–µ–Ω–∏–π (–ê), –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å—É–±–¥–æ–º–∏–Ω–∞–Ω—Ç—ã –∏ —Ñ–æ–Ω–∞ –≤—ã—Å—Ç—É–ø–∞—é—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–ü) –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—é –Ω–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–ì).",
    "–ê–ì–ü": "–î–æ–º–∏–Ω–∏—Ä—É—é—â–µ–π —è–≤–ª—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ–π –æ—Ü–µ–Ω–∫–µ –Ω–æ–≤—ã—Ö —è–≤–ª–µ–Ω–∏–π (–ê), –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å—É–±–¥–æ–º–∏–Ω–∞–Ω—Ç—ã –∏ —Ñ–æ–Ω–∞ –≤—ã—Å—Ç—É–ø–∞—é—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—é –Ω–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–ì) –∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–ü)."
};
// ===== –ë–õ–û–ö –¢–ò–ü–ê –î–û–ú–ò–ù–ò–†–û–í–ê–ù–ò–Ø –ê–°–ü–ï–ö–¢–û–í =====
let aspectTypeHTML = `
<div style="
    margin-top:25px;
    padding:18px;
    border-radius:12px;
    background:#f8f9fa;
    border:1px solid #ddd;
">
    <h2 style="margin-top:0;">üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π</h2>
`;

if (!aspectsDefined) {
    aspectTypeHTML += `
        <div style="font-size:1.05em;">
            <b>–¢–∏–ø –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω.</b><br><br>
            –ó–Ω–∞—á–µ–Ω–∏—è –∞—Å–ø–µ–∫—Ç–æ–≤ –æ–∫–∞–∑–∞–ª–∏—Å—å —Ä–∞–≤–Ω—ã–º–∏ –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–∏–º–∏, –ø–æ—ç—Ç–æ–º—É –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å –¥–æ–º–∏–Ω–∏—Ä—É—é—â–∏–π, —Å—É–±–¥–æ–º–∏–Ω–∞–Ω—Ç–Ω—ã–π –∏ —Ñ–æ–Ω–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã.
        </div>
    `;
} else {
    aspectTypeHTML += `
        <div style="font-size:1.15em; font-weight:bold; margin-bottom:10px;">
            –¢–∏–ø ${aspectTypeKeyRU}
        </div>
        <div style="font-size:1.05em; line-height:1.6;">
            ${ASPECT_DOMINANCE_INFO[aspectTypeKeyRU]}
        </div>
    `;
}

aspectTypeHTML += `</div>`;

detailsHTML += aspectTypeHTML;
//4. ===== –£–†–û–í–ù–ò =====
detailsHTML += renderBigScalesBlock(
    "üåç –ò–ü–õ –Ω–∞ —É—Ä–æ–≤–Ω—è—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –º–∏—Ä–æ–º",
    [
        { key: "nature", value: ipl_levels.nature },
        { key: "social", value: ipl_levels.social },
        { key: "culture", value: ipl_levels.culture },
        { key: "life", value: ipl_levels.life }
    ],
    45,
    "rgb(144, 238, 144)",
    {
        nature: "–ü—Ä–∏—Ä–æ–¥–Ω—ã–π (—Å—Ä–µ–¥–æ–≤–æ–π)",
        social: "–°–æ—Ü–∏–∞–ª—å–Ω—ã–π",
        culture: "–ö—É–ª—å—Ç—É—Ä–Ω—ã–π",
        life: "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –∂–∏–∑–Ω–∏"
    }
);
document.getElementById("detailsIPL").innerHTML = detailsHTML;
    }, immediate ? 0 : 1000);
}

// –£—Ç–∏–ª–∏—Ç—ã
function switchStep(f, t) { document.getElementById(f).classList.remove('active'); setTimeout(() => document.getElementById(t).classList.add('active'), 200); window.scrollTo(0,0); updateProgress(); }
function downloadJSON() { const fn = `Res_${state.meta.fio.replace(/[^–∞-—è–ê-–Øa-zA-Z0-9]/g,'_')}.json`; const blob = new Blob([JSON.stringify(state, null, 2)], {type: "application/json"}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = fn; document.body.appendChild(a); a.click(); a.remove(); }
function copyResult() { 
    let txt = document.getElementById('result-area'); 
    txt.style.display = 'block'; 
    txt.select(); 
    document.execCommand('copy'); 
    document.getElementById('copy-msg').style.display = 'block'; 
}
function validateGroup(prefix, c1, c2) {
    let err = null; let cont = prefix==='m'?state.milman:state.ipl;
    if(c2===1) { for(let i=0;i<c1;i++) if(!cont[i]) { err=document.getElementById('row_ipl_'+i); err.classList.add('highlight-error'); break; } }
    else { for(let q=0;q<c1;q++) for(let i=0;i<c2;i++) if(cont[`${q}_${i}`]===undefined) { err=document.getElementById(`row_m_${q}_${i}`); err.classList.add('highlight-error'); break; } }
    if(err) { err.scrollIntoView({behavior:"smooth", block:"center"}); document.getElementById(prefix==='m'?'milman-error':'ipl-error').style.display='block'; return false; }
    return true;
}
function toggleDetails(id) {
    const el = document.getElementById(id);
    if (!el) return;

    const isOpening = (el.style.display === 'none' || el.style.display === '');
    el.style.display = isOpening ? 'block' : 'none';

    if (isOpening && id === 'detailsMilman') {
        renderMilmanDetailedCharts();
    }
}

function renderMilmanDetailedCharts() {
    if (!window.milmanData) {
        console.warn("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ú–∏–ª—å–º–∞–Ω–∞ –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏");
        return;
    }

    const { scales_names, life_ideal_data, life_real_data, work_ideal_data, work_real_data } = window.milmanData;

    // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏, –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —ç—Ç–æ Chart
    if (window.chartMilmanLife && typeof window.chartMilmanLife.destroy === "function") {
        window.chartMilmanLife.destroy();
    }
    if (window.chartMilmanWork && typeof window.chartMilmanWork.destroy === "function") {
        window.chartMilmanWork.destroy();
    }

    // –ñ–ò–ó–ù–¨
    const ctxLife = document.getElementById('chartMilmanLife');
    if (ctxLife) {
        window.chartMilmanLife = new Chart(ctxLife.getContext('2d'), {
            type: 'line',
            data: {
                labels: scales_names,
                datasets: [
                    {
                        label: '–ò–¥–µ–∞–ª',
                        data: life_ideal_data,
                        fill: true
                    },
                    {
                        label: '–†–µ–∞–ª—å–Ω–æ—Å—Ç—å',
                        data: life_real_data,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                scales: { y: { min: 0 } }
            }
        });
    }

    // –†–ê–ë–û–¢–ê
    const ctxWork = document.getElementById('chartMilmanWork');
    if (ctxWork) {
        window.chartMilmanWork = new Chart(ctxWork.getContext('2d'), {
            type: 'line',
            data: {
                labels: scales_names,
                datasets: [
                    {
                        label: '–ò–¥–µ–∞–ª',
                        data: work_ideal_data,
                        fill: true
                    },
                    {
                        label: '–†–µ–∞–ª—å–Ω–æ—Å—Ç—å',
                        data: work_real_data,
                        fill: true
                    }
                ]
            },
            options: { responsive: true, scales: { y: { min: 0 } }
            }
        });
    }
    // ===== –≠–ú–û–¶–ò–û–ù–ê–õ–¨–ù–´–ô –ü–†–û–§–ò–õ–¨ (–ü–û –ú–ò–õ–¨–ú–ê–ù–£) =====

if (window.chartMilmanEmo && typeof window.chartMilmanEmo.destroy === "function") {
    window.chartMilmanEmo.destroy();
}

const ctxEmo = document.getElementById("chartMilmanEmo");
if (ctxEmo) {

    const labels = ["–û–±—ã—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ", "–°—Ç—Ä–µ—Å—Å–æ–≤–∞—è —Å–∏—Ç—É–∞—Ü–∏—è"];

    window.chartMilmanEmo = new Chart(ctxEmo.getContext("2d"), {
        type: "line",
        data: {
            labels,
            datasets: [
                {
                    label: "–°—Ç–µ–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ–∞–∫—Ü–∏–∏ (–∞–∫—Ç–∏–≤–Ω—ã–µ)",
                    data: [ emo.E_st, emo.F_st ],
                    borderWidth: 3,
                    tension: 0,
                    fill: false
                },
                {
                    label: "–ê—Å—Ç–µ–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ–∞–∫—Ü–∏–∏ (–ø–∞—Å—Å–∏–≤–Ω—ã–µ)",
                    data: [ emo.E_ast, emo.F_ast ],
                    borderWidth: 3,
                    tension: 0,
                    fill: false
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: true }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    suggestedMax: Math.max(
                        emo.E_ast, emo.E_st, emo.F_ast, emo.F_st
                    ) + 1
                }
            }
        }
    });
}
}

</script>
</body>
</html>
