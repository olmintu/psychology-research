<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #3498db; --success: #27ae60; --warning: #f39c12; --error: #e74c3c; --bg: #f4f6f8; --info-bg: #ebf5fb; --gray: #95a5a6; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); color: #333; margin: 0; padding: 15px; line-height: 1.5; }
        
        .container { max-width: 900px; margin: 0 auto; background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        
        h1 { font-size: 1.6rem; text-align: center; color: #2c3e50; margin-bottom: 10px; }
        h2 { font-size: 1.3rem; color: #34495e; margin-top: 0; text-align: center; margin-bottom: 15px; }
        h3 { color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 5px; margin-top: 30px; }
        
        .instruction { background-color: var(--info-bg); border-left: 5px solid var(--primary); padding: 15px; border-radius: 4px; margin-bottom: 25px; font-size: 0.95rem; color: #2c3e50; line-height: 1.6; }
        .instruction ul { margin: 5px 0 10px 20px; padding: 0; }
        
        .anon-switch { background: #fff3cd; border: 1px solid #ffeeba; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: flex-start; gap: 10px; }
        .anon-switch input { width: 20px; height: 20px; margin-top: 3px; }
        .anon-warning { font-size: 0.85em; color: #856404; margin-top: 5px; display: none; }
        
        .step { display: none; opacity: 0; transition: opacity 0.3s ease; }
        .step.active { display: block; opacity: 1; }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 0.9rem; color: #555; }
        input[type="text"], input[type="number"], select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; background: #fff; appearance: none; }
        input:disabled, select:disabled { background-color: #f9f9f9; color: #aaa; border-color: #eee; }
        
        .btn-container { display: flex; gap: 15px; margin-top: 25px; }
        .btn { flex: 1; padding: 16px; border: none; border-radius: 10px; font-size: 17px; font-weight: 600; cursor: pointer; transition: transform 0.1s; color: white; }
        .btn:active { transform: scale(0.98); opacity: 0.9; }
        .btn-next { background-color: var(--primary); }
        .btn-back { background-color: var(--gray); }
        .btn-success { background-color: var(--success); }
        .btn-secondary { background-color: #95a5a6; margin-top: 10px; width: 100%; padding: 12px; }
        
        .option-card { border: 2px solid #eee; padding: 12px; margin-bottom: 8px; border-radius: 10px; display: flex; align-items: center; cursor: pointer; transition: all 0.2s; background: #fff; }
        .option-card input { width: 22px; height: 22px; margin-right: 15px; flex-shrink: 0; }
        .option-card.checked { border-color: var(--primary); background-color: #f0f9ff; }

        .error-msg { color: #fff; background: var(--error); padding: 12px; border-radius: 8px; margin-top: 20px; text-align: center; display: none; font-weight: bold; }
        .highlight-error { border: 2px solid var(--error) !important; background-color: #fff5f5 !important; }

        table { width: 100%; border-collapse: collapse; margin-bottom: 40px; }
        th, td { padding: 12px; text-align: center; border-bottom: 1px solid #eee; vertical-align: middle; }
        th { background: #f8f9fa; font-size: 0.85rem; color: #333; position: sticky; top: 0; z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        td:first-child { text-align: left; font-weight: 500; font-size: 0.95rem; width: 45%; }
        
        .res-block { background: #fff; border: 1px solid #eee; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .score-badge { display: inline-block; padding: 5px 10px; border-radius: 15px; font-weight: bold; font-size: 0.9em; }
        .bg-green { background: #d4edda; color: #155724; }
        .bg-red { background: #f8d7da; color: #721c24; }
        .bg-blue { background: #d1ecf1; color: #0c5460; }
        canvas { max-height: 300px; margin-top: 15px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .dl-section { background: #f0f7fb; border: 2px dashed #3498db; padding: 20px; text-align: center; border-radius: 10px; margin-bottom: 30px; }
        #result-area { width: 100%; height: 80px; margin-top: 10px; font-size: 12px; padding: 10px; border: 1px solid #ddd; display: none; }

        /* DEV TOOLS */
        #dev-panel { display: none; background: #333; color: #fff; padding: 15px; border-radius: 8px; margin-top: 15px; }
        #dev-json-input { width: 100%; height: 100px; margin-top: 10px; font-family: monospace; font-size: 12px; color: #333; }
        .dev-btn { background: #555; border: 1px solid #777; color: white; padding: 8px 15px; cursor: pointer; border-radius: 4px; font-size: 0.9em; margin-right: 10px; }
        .dev-btn:hover { background: #666; }

        @media (max-width: 600px) {
            .container { padding: 15px; }
            th { font-size: 0.7rem; padding: 5px; }
            td { padding: 10px 2px; }
            td:first-child { font-size: 0.9rem; width: 100%; display: block; border-bottom: none; padding-bottom: 5px; color: var(--primary); font-weight: 600; }
            tr { display: block; border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 10px; }
            td:not(:first-child) { display: inline-block; width: 22%; border: none; }
            thead { display: none; } 
            td:not(:first-child)::before { content: attr(data-label); display: block; font-size: 0.7em; color: #888; margin-bottom: 5px; }
            input[type="radio"] { width: 24px; height: 24px; margin: 0; }
        }
        
        .progress-bar { height: 6px; background: #e9ecef; border-radius: 3px; margin-bottom: 20px; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }
    </style>
</head>
<body>

<div class="container">
    <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>

    <!-- –ê–ù–ö–ï–¢–ê -->
    <div class="step active" id="step-form">
        <h1>–ê–Ω–∫–µ—Ç–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞</h1>
        <div class="instruction">
            –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –í–∞–º –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ –≤ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏.<br>
            –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ <b>—Ç–æ–ª—å–∫–æ –≤ –æ–±–æ–±—â–µ–Ω–Ω–æ–º –≤–∏–¥–µ</b>.
        </div>
        
        <div class="anon-switch">
            <input type="checkbox" id="anon_mode" onchange="toggleAnon(); saveStateToLocal();">
            <div>
                <label for="anon_mode" style="margin:0; cursor:pointer;"><b>–ü—Ä–æ–π—Ç–∏ –æ–ø—Ä–æ—Å –∞–Ω–æ–Ω–∏–º–Ω–æ</b></label>
                <div class="anon-warning" id="anon_warning">
                    –°–≤–µ–¥–µ–Ω–∏—è –æ–± —É—á–∞—Å—Ç–Ω–∏–∫–µ –ø–æ–º–æ–≥–∞—é—Ç –ø–æ–Ω—è—Ç—å, –¥–ª—è –∫–∞–∫–∏—Ö –≥—Ä—É–ø–ø –ª—é–¥–µ–π –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã –≤ –±–æ–ª—å—à–µ–π —Å—Ç–µ–ø–µ–Ω–∏. 
                    –û—Ç–∫–∞–∑ –æ—Ç –∏—Ö —É–∫–∞–∑–∞–Ω–∏—è –ø—Ä–∏ –∞–Ω–æ–Ω–∏–º–Ω–æ–º –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ –º–æ–∂–µ—Ç —É–º–µ–Ω—å—à–∏—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å –∏ –æ–±–æ–±—â–∞–µ–º–æ—Å—Ç—å –≤—ã–≤–æ–¥–æ–≤ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.
                </div>
            </div>
        </div>

        <div class="form-group"><label>–í–∞—à–µ –∏–º—è (–∏–ª–∏ –ø—Å–µ–≤–¥–æ–Ω–∏–º): <span class="req">*</span></label><input type="text" id="fio" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω" onkeyup="checkDevMode(this.value)"></div>
        
        <!-- DEV TOOLS -->
        <div id="dev-panel">
            <div style="font-weight:bold; margin-bottom:10px;">üõ†Ô∏è –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</div>
            <div style="display:flex; align-items:center;">
                <button class="dev-btn" onclick="fillRandomData()">üé≤ –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å–ª—É—á–∞–π–Ω–æ</button>
                <button class="dev-btn" onclick="document.getElementById('dev-import').style.display='block'">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å JSON</button>
            </div>
            <div id="dev-import" style="display:none; margin-top:10px;">
                <textarea id="dev-json-input" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ JSON —Å—é–¥–∞..."></textarea>
                <button class="dev-btn" style="margin-top:5px; background:#27ae60" onclick="loadDevJSON()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                <div id="dev-error" style="color:#e74c3c; font-size:0.9em; margin-top:5px;"></div>
            </div>
        </div>

        <div style="display: flex; gap: 10px;">
            <div class="form-group" style="flex: 1;"><label>–ü–æ–ª: <span class="req">*</span></label><select id="gender" onchange="saveStateToLocal()"><option value="">–í—ã–±—Ä–∞—Ç—å...</option><option value="–ú—É–∂—Å–∫–æ–π">–ú—É–∂—Å–∫–æ–π</option><option value="–ñ–µ–Ω—Å–∫–∏–π">–ñ–µ–Ω—Å–∫–∏–π</option></select></div>
            <div class="form-group" style="flex: 1;"><label>–í–æ–∑—Ä–∞—Å—Ç: <span class="req">*</span></label><input type="number" id="age" placeholder="18" onchange="saveStateToLocal()"></div>
        </div>
        <div class="form-group"><label>–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: <span class="req">*</span></label><select id="family_status" onchange="saveStateToLocal()"><option value="">–í—ã–±—Ä–∞—Ç—å...</option><option value="–•–æ–ª–æ—Å—Ç/–ù–µ –∑–∞–º—É–∂–µ–º">–•–æ–ª–æ—Å—Ç / –ù–µ –∑–∞–º—É–∂–µ–º</option><option value="–ñ–µ–Ω–∞—Ç/–ó–∞–º—É–∂–µ–º">–ñ–µ–Ω–∞—Ç / –ó–∞–º—É–∂–µ–º</option><option value="–í —Ä–∞–∑–≤–æ–¥–µ">–í —Ä–∞–∑–≤–æ–¥–µ</option></select></div>
        <div class="form-group"><label>–ï—Å—Ç—å –ª–∏ –¥–µ—Ç–∏? <span class="req">*</span></label><select id="children" onchange="saveStateToLocal()"><option value="–ù–µ—Ç">–ù–µ—Ç</option><option value="–î–∞">–î–∞</option></select></div>
        <div class="form-group"><label>–†–∞–±–æ—Ç–∞–µ—Ç–µ –ª–∏ –í—ã? <span class="req">*</span></label><select id="is_working" onchange="toggleWorkPlace(); saveStateToLocal()"><option value="–ù–µ—Ç">–ù–µ—Ç</option><option value="–î–∞">–î–∞</option></select></div>
        <div class="form-group" id="work_place_block" style="display: none;"><label>–ì–¥–µ —Ä–∞–±–æ—Ç–∞–µ—Ç–µ? (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label><input type="text" id="work_place" onchange="saveStateToLocal()"></div>
        <div class="form-group"><label>–°—Ä–µ–¥–Ω–µ–µ —Å–ø–µ—Ü. –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ? <span class="req">*</span></label><select id="has_secondary_edu" onchange="saveStateToLocal()"><option value="–ù–µ—Ç">–ù–µ—Ç</option><option value="–î–∞">–î–∞</option></select></div>
        
        <div class="form-group"><label>–í–∞—à —Å—Ç–∞—Ç—É—Å –æ–±—É—á–µ–Ω–∏—è: <span class="req">*</span></label><select id="edu_status" onchange="toggleEduBlock(); saveStateToLocal()"><option value="">–í—ã–±—Ä–∞—Ç—å...</option><option value="–£—á—É—Å—å">–°—Ç—É–¥–µ–Ω—Ç (—É—á—É—Å—å —Å–µ–π—á–∞—Å)</option><option value="–ó–∞–∫–æ–Ω—á–∏–ª">–í—ã–ø—É—Å–∫–Ω–∏–∫ (—É–∂–µ –∑–∞–∫–æ–Ω—á–∏–ª)</option><option value="–ù–µ—Ç">–ù–µ —É—á–∏–ª—Å—è –≤ –í–£–ó–µ</option></select></div>
        <div id="edu_block" style="display: none; border-left: 3px solid #3498db; padding-left: 15px;">
            <div class="form-group"><label>–í–£–ó: <span class="req">*</span></label><input type="text" id="university" onchange="saveStateToLocal()"></div>
            <div class="form-group"><label>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å: <span class="req">*</span></label><input type="text" id="speciality" onchange="saveStateToLocal()"></div>
            <div style="display: flex; gap: 10px;">
                 <div class="form-group" style="flex: 1;"><label>–£—Ä–æ–≤–µ–Ω—å: <span class="req">*</span></label><select id="edu_level" onchange="saveStateToLocal()"><option value="–ë–∞–∫–∞–ª–∞–≤—Ä–∏–∞—Ç">–ë–∞–∫–∞–ª–∞–≤—Ä–∏–∞—Ç</option><option value="–ú–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞">–ú–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞</option><option value="–°–ø–µ—Ü–∏–∞–ª–∏—Ç–µ—Ç">–°–ø–µ—Ü–∏–∞–ª–∏—Ç–µ—Ç</option></select></div>
                 <div class="form-group" style="flex: 1;"><label>–û—Å–Ω–æ–≤–∞: <span class="req">*</span></label><select id="edu_basis" onchange="saveStateToLocal()"><option value="–ë—é–¥–∂–µ—Ç">–ë—é–¥–∂–µ—Ç</option><option value="–ü–ª–∞—Ç–Ω–æ–µ">–ü–ª–∞—Ç–Ω–æ–µ</option></select></div>
            </div>
            <div class="form-group" id="course_block"><label>–ö—É—Ä—Å: <span class="req">*</span></label><select id="course" onchange="saveStateToLocal()"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></div>
        </div>

        <div class="error-msg" id="form-error">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∏–ª–∏ –≤–∫–ª—é—á–∏—Ç–µ –ê–Ω–æ–Ω–∏–º–Ω—ã–π —Ä–µ–∂–∏–º!</div>
        <button class="btn btn-next" onclick="validateForm()">–ù–∞—á–∞—Ç—å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</button>
    </div>

    <!-- –ú–ï–¢–û–î–ò–ö–ê 1 -->
    <div class="step" id="step-bratus">
        <h2>1/3. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–µ —Å–º—ã—Å–ª—ã</h2>
        <div class="instruction">
            <p>–ü–µ—Ä–µ–¥ –≤–∞–º–∏ —Å–ø–∏—Å–æ–∫ –∏–∑ 24 —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π. –≠—Ç–æ –ø–µ—Ä–µ—á–µ–Ω—å –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–º—ã—Å–ª–æ–≤, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –ª—é–¥–∏.</p>
            <p>–í–∞–º –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç —Å–¥–µ–ª–∞—Ç—å –º—è–≥–∫—É—é —Ä–µ–π—Ç–∏–Ω–≥–æ–≤—É—é –æ—Ü–µ–Ω–∫—É –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞. –î–ª—è —ç—Ç–æ–≥–æ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ <b>—Ç—Ä–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</b>, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–Ω–∏–º–∞—é—Ç <b>1-–µ –º–µ—Å—Ç–æ</b> –≤ —Å–∏—Å—Ç–µ–º–µ –í–∞—à–∏—Ö –ª–∏—á–Ω—ã—Ö –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–º—ã—Å–ª–æ–≤, –∑–∞—Ç–µ–º —Ç—Ä–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –í—ã –º–æ–≥–ª–∏ –±—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ 2-–µ, –Ω–∞ 3-–µ –∏ —Ç.–¥. –¥–æ 8-–≥–æ –º–µ—Å—Ç–∞.</p>
        </div>
        <p style="text-align:center; font-weight:bold; color:#2980b9; margin-bottom:10px;" id="bratus-sub">–í—ã–±–µ—Ä–∏—Ç–µ 3 —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö</p>
        <div id="bratus-options"></div>
        <div class="error-msg" id="bratus-error">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–≤–Ω–æ 3 –ø—É–Ω–∫—Ç–∞!</div>
        <div class="btn-container"><button class="btn btn-back" onclick="prevBratusRank()">–ù–∞–∑–∞–¥</button><button class="btn btn-next" onclick="nextBratusRank()">–î–∞–ª–µ–µ</button></div>
    </div>

    <!-- –ú–ï–¢–û–î–ò–ö–ê 2 -->
    <div class="step" id="step-milman">
        <h2>2/3. –ú–æ—Ç–∏–≤–∞—Ü–∏—è</h2>
        <div class="instruction">
            <p>–ü–µ—Ä–µ–¥ –≤–∞–º–∏ 14 —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π, –∫–∞—Å–∞—é—â–∏—Ö—Å—è –≤–∞—à–∏—Ö –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–π –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å—Ç–æ—Ä–æ–Ω –≤–∞—à–µ–≥–æ –æ–±—Ä–∞–∑–∞ –∂–∏–∑–Ω–∏. –ü—Ä–æ—Å–∏–º –≤–∞—Å –≤—ã—Å–∫–∞–∑–∞—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –Ω–∏–º –ø–æ –∫–∞–∂–¥–æ–º—É –∏–∑ 8 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤, –ø—Ä–æ—Å—Ç–∞–≤–∏–≤ –æ–¥–Ω—É –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –æ—Ü–µ–Ω–æ–∫:</p>
            <ul><li><b>++</b> (–¥–∞, —Å–æ–≥–ª–∞—Å–µ–Ω)</li><li><b>+</b> (–ø–æ–∂–∞–ª—É–π —Å–æ–≥–ª–∞—Å–µ–Ω)</li><li><b>=</b> (–∫–æ–≥–¥–∞ –∫–∞–∫, —Å–æ–≥–ª–∞—Å–µ–Ω –≤ –Ω–µ–∫–æ—Ç–æ—Ä–æ–π —Å—Ç–µ–ø–µ–Ω–∏)</li><li><b>- / ?</b> (–Ω–µ—Ç, –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω / –Ω–µ –∑–Ω–∞—é)</li></ul>
        </div>
        <div id="milman-container"></div>
        <div class="error-msg" id="milman-error">–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –ø–æ–¥—Å–≤–µ—á–µ–Ω–Ω—ã–µ –∫—Ä–∞—Å–Ω—ã–º!</div>
        <div class="btn-container"><button class="btn btn-back" onclick="prevMilman()">–ù–∞–∑–∞–¥</button><button class="btn btn-next" onclick="finishMilman()">–î–∞–ª–µ–µ</button></div>
    </div>

    <!-- –ú–ï–¢–û–î–ò–ö–ê 3 -->
    <div class="step" id="step-ipl">
        <h2>3/3. –ò–Ω–Ω–æ–≤–∞—Ü–∏–∏</h2>
        <div class="instruction">
            <p>–í–∞—à–µ–º—É –≤–Ω–∏–º–∞–Ω–∏—é –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è —Ä—è–¥ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏–π, –∫–∞–∂–¥–æ–µ –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–Ω–µ—Å—Ç–∏ –∫ —Å–µ–±–µ –∏ —Ä–µ—à–∏—Ç—å, –≤ –∫–∞–∫–æ–π –º–µ—Ä–µ –æ–Ω–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –í–∞—à—É –∂–∏–∑–Ω–µ–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é.</p>
            <p>–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤:</p>
            <ul><li><b>1</b> ‚Äî –ù–µ —Å–æ–≥–ª–∞—Å–µ–Ω</li><li><b>2</b> ‚Äî –°–∫–æ—Ä–µ–µ –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω</li><li><b>3</b> ‚Äî –°–ª–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å</li><li><b>4</b> ‚Äî –°–∫–æ—Ä–µ–µ —Å–æ–≥–ª–∞—Å–µ–Ω</li><li><b>5</b> ‚Äî –°–æ–≥–ª–∞—Å–µ–Ω</li></ul>
        </div>
        <div id="ipl-container"></div>
        <div class="error-msg" id="ipl-error">–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –ø–æ–¥—Å–≤–µ—á–µ–Ω–Ω—ã–µ –∫—Ä–∞—Å–Ω—ã–º!</div>
        <div class="btn-container"><button class="btn btn-back" onclick="prevIPL()">–ù–∞–∑–∞–¥</button><button class="btn btn-success" onclick="finishSurvey()">–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button></div>
    </div>

    <div class="step" id="step-loading" style="text-align:center; padding: 40px 0;">
        <h2 style="color:var(--primary)">–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...</h2>
        <div class="spinner"></div>
        <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É</p>
    </div>

    <!-- –†–ï–ó–£–õ–¨–¢–ê–¢–´ -->
    <div class="step" id="step-results">
        <h1 style="color:var(--success)">–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!</h1>
        <p id="final-msg" style="text-align:center">–î–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è...</p>
        
        <div class="dl-section">
            <h3 style="margin-top:0">üìÅ –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h3>
            <p style="font-size:0.9em; margin-bottom:15px">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—é.</p>
            <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
                <button class="btn btn-success" style="flex:0 0 auto; min-width:200px;" onclick="downloadJSON()">üì• –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª</button>
                <button class="btn btn-secondary" style="flex:0 0 auto; min-width:200px; margin-top:0;" onclick="copyResult()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç</button>
            </div>
            <textarea id="result-area" readonly></textarea>
            <p id="copy-msg" style="color:var(--success); display:none; font-weight:bold; margin-top:5px;">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!</p>
        </div>

        <h2 style="margin-top:40px;">üìä –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h2>
        
        <div class="res-block">
            <h3>1. –ú–µ—Ç–æ–¥–∏–∫–∞ –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–º—ã—Å–ª–æ–≤</h3>
            <p>–ß–µ–º –Ω–∏–∂–µ —Å—Ç–æ–ª–±–µ—Ü (–º–µ–Ω—å—à–µ –±–∞–ª–ª–æ–≤), —Ç–µ–º <b>–≤–∞–∂–Ω–µ–µ</b> –¥–ª—è –≤–∞—Å —ç—Ç–∞ —Å—Ñ–µ—Ä–∞.</p>
            <canvas id="chartBratus"></canvas>
            <div id="textBratus" style="margin-top:15px; font-size:0.9em; line-height:1.6;"></div>
        </div>

        <div class="res-block">
            <h3>2. –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–∏—á–Ω–æ—Å—Ç–∏</h3>
            <p>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∂–µ–ª–∞–µ–º–æ–≥–æ (–ò–¥–µ–∞–ª—å–Ω–æ–µ) –∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–≥–æ (–†–µ–∞–ª—å–Ω–æ–µ).</p>
            <canvas id="chartMilman"></canvas>
            <div id="textMilman" style="margin-top:15px;"></div>
        </div>

        <div class="res-block">
            <h3>3. –ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –ª–∏—á–Ω–æ—Å—Ç–∏</h3>
            <div id="textIPL"></div>
        </div>

        <div style="text-align:center; margin-top:30px;">
            <button class="btn btn-secondary" onclick="clearState()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
        </div>
    </div>
</div>

<script>
// --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
const GOOGLE_URL = "https://script.google.com/macros/s/AKfycbyBH_ksIaHmQxklthf1SgxzmhxAPkqABdkTFTin1TObQJZ98DudLE_20IbqEHR-SKaqCg/exec";
const STORAGE_KEY = "survey_state_v10";

// –î–ê–ù–ù–´–ï
const bratus_stmts=[{id:1,t:"...—á—Ç–æ–±—ã –ø–æ–º–æ–≥–∞—Ç—å –¥—Ä—É–≥–∏–º –ª—é–¥—è–º"},{id:2,t:"...—á—Ç–æ–±—ã –±—ã—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–º"},{id:3,t:"...—á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ"},{id:4,t:"...—á—Ç–æ–±—ã —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å—Å—è"},{id:5,t:"...—á—Ç–æ–±—ã –¥–æ–±–∏–≤–∞—Ç—å—Å—è —É—Å–ø–µ—Ö–∞"},{id:6,t:"...—á—Ç–æ–±—ã –±—ã—Ç—å —Å –±–ª–∏–∑–∫–∏–º —á–µ–ª–æ–≤–µ–∫–æ–º"},{id:7,t:"...—á—Ç–æ–±—ã –ø–µ—Ä–µ–¥–∞—Ç—å –≤—Å–µ –ª—É—á—à–µ–µ —Å–≤–æ–∏–º –¥–µ—Ç—è–º"},{id:8,t:"...—á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å —Å–µ–±—è —Å–∞–º–æ–≥–æ"},{id:9,t:"...—á—Ç–æ–±—ã –¥–µ–ª–∞—Ç—å –¥–æ–±—Ä–æ"},{id:10,t:"...—á—Ç–æ–±—ã –∂–∏—Ç—å"},{id:11,t:"...—á—Ç–æ–±—ã –∏—Å–ø—ã—Ç—ã–≤–∞—Ç—å —Å—á–∞—Å—Ç—å–µ"},{id:12,t:"...—á—Ç–æ–±—ã –æ—Å—É—â–µ—Å—Ç–≤–∏—Ç—å —Å–µ–±—è"},{id:13,t:"...—á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —Ö–æ—Ä–æ—à—É—é –∫–∞—Ä—å–µ—Ä—É"},{id:14,t:"...—á—Ç–æ–±—ã —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å, —á—Ç–æ –∫–æ–º—É-—Ç–æ –Ω—É–∂–µ–Ω"},{id:15,t:"...—á—Ç–æ–±—ã –∂–∏—Ç—å —Ä–∞–¥–∏ —Å–≤–æ–µ–π —Å–µ–º—å–∏"},{id:16,t:"...—á—Ç–æ–±—ã –ø–æ–∑–Ω–∞–≤–∞—Ç—å –ë–æ–≥–∞"},{id:17,t:"...—á—Ç–æ–±—ã —É–ª—É—á—à–∞—Ç—å –º–∏—Ä"},{id:18,t:"...—á—Ç–æ–±—ã –ª—é–±–∏—Ç—å"},{id:19,t:"...—á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –æ—â—É—â–µ–Ω–∏–π –∏ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏–π"},{id:20,t:"...—á—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ —Å–≤–æ–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏"},{id:21,t:"...—á—Ç–æ–±—ã –∑–∞–Ω–∏–º–∞—Ç—å –¥–æ—Å—Ç–æ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –æ–±—â–µ—Å—Ç–≤–µ"},{id:22,t:"...—á—Ç–æ–±—ã —Ä–∞–¥–æ–≤–∞—Ç—å—Å—è –æ–±—â–µ–Ω–∏—é —Å –¥—Ä—É–≥–∏–º–∏"},{id:23,t:"...—á—Ç–æ–±—ã –ø–æ–º–æ–≥–∞—Ç—å —Å–≤–æ–∏–º —Ä–æ–¥–Ω—ã–º –∏ –±–ª–∏–∑–∫–∏–º"},{id:24,t:"...—á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –∂–∏–∑–Ω—å"}];

const milman_qs=[
    {q:"–í —Å–≤–æ–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –≤ –∂–∏–∑–Ω–∏ –Ω—É–∂–Ω–æ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è —Å–ª–µ–¥—É—é—â–∏—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤:", i:[ "¬´–í—Ä–µ–º—è - –¥–µ–Ω—å–≥–∏¬ª. –ù—É–∂–Ω–æ —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è –∏—Ö –±–æ–ª—å—à–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å.", "¬´–ì–ª–∞–≤–Ω–æ–µ - –∑–¥–æ—Ä–æ–≤—å–µ¬ª. –ù—É–∂–Ω–æ –±–µ—Ä–µ—á—å —Å–µ–±—è –∏ —Å–≤–æ–∏ –Ω–µ—Ä–≤—ã.", "–°–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç—å —Å –¥—Ä—É–∑—å—è–º–∏.", "–°–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞–¥–æ –æ—Ç–¥–∞–≤–∞—Ç—å —Å–µ–º—å–µ.", "–ù—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –¥–æ–±—Ä–æ, –¥–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ –¥–æ—Ä–æ–≥–æ –æ–±—Ö–æ–¥–∏—Ç—Å—è.", "–ù—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ–µ, —á—Ç–æ–±—ã –∑–∞–≤–æ–µ–≤–∞—Ç—å –º–µ—Å—Ç–æ –ø–æ–¥ —Å–æ–ª–Ω—Ü–µ–º.", "–ù—É–∂–Ω–æ –ø—Ä–∏–æ–±—Ä–µ—Ç–∞—Ç—å –±–æ–ª—å—à–µ –∑–Ω–∞–Ω–∏–π, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –ø—Ä–∏—á–∏–Ω—ã –∏ —Å—É—â–Ω–æ—Å—Ç—å —Ç–æ–≥–æ, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–æ–∫—Ä—É–≥.", "–ù—É–∂–Ω–æ —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è –æ—Ç–∫—Ä—ã—Ç—å —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ, —Å–æ–∑–¥–∞—Ç—å, –∏–∑–æ–±—Ä–µ—Å—Ç–∏." ]},
    {q:"–í —Å–≤–æ–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —Ä–∞–±–æ—Ç–µ –Ω—É–∂–Ω–æ —Å–ª–µ–¥–æ–≤–∞—Ç—å —Ç–∞–∫–∏–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º:", i:[ "–†–∞–±–æ—Ç–∞ - —ç—Ç–æ –≤—ã–Ω—É–∂–¥–µ–Ω–Ω–∞—è –∂–∏–∑–Ω–µ–Ω–Ω–∞—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å.", "–ì–ª–∞–≤–Ω–æ–µ - –Ω–µ –¥–æ–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.", "–ù—É–∂–Ω–æ —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å–µ–±—è —Å–ø–æ–∫–æ–π–Ω—ã–º–∏, —É–¥–æ–±–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏.", "–ù—É–∂–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ —Å—Ç—Ä–µ–º–∏—Ç—Å—è –∫ —Å–ª—É–∂–µ–±–Ω–æ–º—É –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—é.", "–ì–ª–∞–≤–Ω–æ–µ - –∑–∞–≤–æ–µ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç –∏ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ.", "–ù—É–∂–Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å—Å—è –≤ —Å–≤–æ–µ–º –¥–µ–ª–µ.", "–í —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç–µ –≤—Å–µ–≥–¥–∞ –Ω–∞–¥–æ –Ω–∞–π—Ç–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ, —á—Ç–æ –º–æ–∂–µ—Ç —É–≤–ª–µ—á—å.", "–ù—É–∂–Ω–æ –Ω–µ —Ç–æ–ª—å–∫–æ —É–≤–ª–µ—á—å—Å—è —Å–∞–º–æ–º—É, –Ω–æ –∏ —É–≤–ª–µ—á—å —Ä–∞–±–æ—Ç–æ–π –¥—Ä—É–≥–∏—Ö." ]},
    {q:"–°—Ä–µ–¥–∏ –º–æ–∏—Ö –¥–µ–ª –≤ —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –±–æ–ª—å—à–æ–µ –º–µ—Å—Ç–æ –∑–∞–Ω–∏–º–∞—é—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–ª–∞:", i:[ "–¢–µ–∫—É—â–∏–µ, –¥–æ–º–∞—à–Ω–∏–µ.", "–û—Ç–¥—ã—Ö, —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è.", "–í—Å—Ç—Ä–µ—á–∏ —Å –¥—Ä—É–∑—å—è–º–∏.", "–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–µ–ª–∞.", "–ó–∞–Ω—è—Ç–∏—è —Å –¥–µ—Ç—å–º–∏.", "–£—á–µ–±–∞, —á—Ç–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π –¥–ª—è —Ä–∞–±–æ—Ç—ã –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã.", "–•–æ–±–±–∏.", "–ü–æ–¥—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ –¥–µ–Ω–µ–≥." ]},
    {q:"–°—Ä–µ–¥–∏ –º–æ–∏—Ö —Ä–∞–±–æ—á–∏—Ö –¥–µ–ª –º–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –∑–∞–Ω–∏–º–∞—é—Ç:", i:[ "–î–µ–ª–æ–≤–æ–µ –æ–±—â–µ–Ω–∏–µ (–ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã, –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è, –æ–±—Å—É–∂–¥–µ–Ω–∏—è –∏ —Ç. –¥.).", "–õ–∏—á–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ (–Ω–∞ —Ç–µ–º—ã, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ä–∞–±–æ—Ç–æ–π).", "–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞.", "–£—á–µ–±–∞, –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –ø–æ–≤—ã—à–µ–Ω–∏–µ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏.", "–†–∞–±–æ—Ç–∞ —Ç–≤–æ—Ä—á–µ—Å–∫–æ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞.", "–†–∞–±–æ—Ç–∞, –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤–ª–∏—è—é—â–∞—è –Ω–∞ –∑–∞—Ä–∞–±–æ—Ç–æ–∫ (—Å–¥–µ–ª—å–Ω–∞—è, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è).", "–†–∞–±–æ—Ç–∞, —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥ –¥—Ä—É–≥–∏–º–∏.", "–°–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è, –ø–µ—Ä–µ–∫—É—Ä—ã, –æ—Ç–¥—ã—Ö." ]},
    {q:"–ï—Å–ª–∏ –±—ã –º–Ω–µ –¥–æ–±–∞–≤–∏–ª–∏ –≤—ã—Ö–æ–¥–Ω–æ–π –¥–µ–Ω—å, —è –±—ã —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—Ç–∏–ª –µ–≥–æ –Ω–∞ —Ç–æ, —á—Ç–æ–±—ã:", i:[ "–ó–∞–Ω–∏–º–∞—Ç—å—Å—è —Ç–µ–∫—É—â–∏–º–∏ –¥–æ–º–∞—à–Ω–∏–º–∏ –¥–µ–ª–∞–º–∏.", "–û—Ç–¥—ã—Ö–∞—Ç—å.", "–†–∞–∑–≤–ª–µ–∫–∞—Ç—å—Å—è.", "–ó–∞–Ω–∏–º–∞—Ç—å—Å—è –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–æ–π.", "–ó–∞–Ω–∏–º–∞—Ç—å—Å—è —É—á–µ–±–æ–π, –ø–æ–ª—É—á–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö –∑–Ω–∞–Ω–∏–π.", "–ó–∞–Ω–∏–º–∞—Ç—å—Å—è —Ç–≤–æ—Ä—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–æ–π.", "–î–µ–ª–∞—Ç—å –¥–µ–ª–æ, –≤ –∫–æ—Ç–æ—Ä–æ–º —á—É–≤—Å—Ç–≤—É–µ—à—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ –¥—Ä—É–≥–∏–º–∏.", "–î–µ–ª–∞—Ç—å –¥–µ–ª–æ, –¥–∞—é—â–µ–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å." ]},
    {q:"–ï—Å–ª–∏ –±—ã —É –º–µ–Ω—è –±—ã–ª–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ-—Å–≤–æ–µ–º—É –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å, —è –±—ã —Å—Ç–∞–ª —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è:", i:[ "–¢–µ–º, —á—Ç–æ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏.", "–û–±—â–µ–Ω–∏–µ–º —Å –ª—é–¥—å–º–∏ –ø–æ –¥–µ–ª–∞–º (–ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã, –æ–±—Å—É–∂–¥–µ–Ω–∏—è).", "–õ–∏—á–Ω—ã–º –æ–±—â–µ–Ω–∏–µ–º (—Ä–∞–∑–≥–æ–≤–æ—Ä–∞–º–∏, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Å —Ä–∞–±–æ—Ç–æ–π).", "–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–æ–π.", "–£—á–µ–±–æ–π, –ø–æ–ª—É—á–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö –∑–Ω–∞–Ω–∏–π, –ø–æ–≤—ã—à–µ–Ω–∏–µ–º –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏.", "–¢–≤–æ—Ä—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–æ–π.", "–†–∞–±–æ—Ç–æ–π, –≤ –∫–æ—Ç–æ—Ä–æ–π —á—É–≤—Å—Ç–≤—É–µ—à—å –ø–æ–ª—å–∑—É –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å.", "–†–∞–±–æ—Ç–æ–π, –∑–∞ –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –ø–æ–ª—É—á–∏—Ç—å." ]},
    {q:"–Ø —á–∞—Å—Ç–æ —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—é —Å –¥—Ä—É–∑—å—è–º–∏ –∏ –∑–Ω–∞–∫–æ–º—ã–º–∏ –Ω–∞ —Ç–∞–∫–∏–µ —Ç–µ–º—ã:", i:[ "–ì–¥–µ —á—Ç–æ –º–æ–∂–Ω–æ –∫—É–ø–∏—Ç—å, –∫–∞–∫ —Ö–æ—Ä–æ—à–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤—Ä–µ–º—è.", "–ü—Ä–æ –æ–±—â–∏—Ö –∑–Ω–∞–∫–æ–º—ã—Ö.", "–û —Ç–æ–º, —á—Ç–æ –≤–∏–∂—É –∏ —Å–ª—ã—à—É –≤–æ–∫—Ä—É–≥.", "–ö–∞–∫ –¥–æ–±–∏—Ç—å—Å—è —É—Å–ø–µ—Ö–∞ –≤ –∂–∏–∑–Ω–∏.", "–û —Ä–∞–±–æ—Ç–µ.", "–û —Å–≤–æ–∏—Ö —É–≤–ª–µ—á–µ–Ω–∏—è—Ö.", "–û —Å–≤–æ–∏—Ö —É—Å–ø–µ—Ö–∞—Ö –∏ –ø–ª–∞–Ω–∞—Ö.", "–û –∂–∏–∑–Ω–∏, –∫–Ω–∏–≥–∞—Ö, –∫–∏–Ω–æ—Ñ–∏–ª—å–º–∞—Ö, –ø–æ–ª–∏—Ç–∏–∫–µ." ]},
    {q:"–ú–æ—è —Ä–∞–±–æ—Ç–∞ –¥–∞–µ—Ç –º–Ω–µ –ø—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ:", i:[ "–î–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –¥–ª—è –∂–∏–∑–Ω–∏.", "–û–±—â–µ–Ω–∏–µ —Å –ª—é–¥—å–º–∏, –¥—Ä—É–∂–µ—Å–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è.", "–ê–≤—Ç–æ—Ä–∏—Ç–µ—Ç –∏ —É–≤–∞–∂–µ–Ω–∏–µ –æ–∫—Ä—É–∂–∞—é—â–∏—Ö.", "–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏ –∏ –±–µ—Å–µ–¥—ã.", "–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏–µ –æ—Ç —Ä–∞–±–æ—Ç—ã.", "–ß—É–≤—Å—Ç–≤–æ —Å–≤–æ–µ–π –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏.", "–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—ã—à–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å.", "–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–ª—É–∂–µ–±–Ω–æ–≥–æ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è." ]},
    {q:"–ë–æ–ª—å—à–µ –≤—Å–µ–≥–æ –º–Ω–µ —Ö–æ—á–µ—Ç—Å—è –±—ã–≤–∞—Ç—å –≤ —Ç–∞–∫–æ–º –æ–±—â–µ—Å—Ç–≤–µ, –≥–¥–µ:", i:[ "–£—é—Ç–Ω–æ, —Ö–æ—Ä–æ—à–∏–µ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è.", "–ú–æ–∂–Ω–æ –æ–±—Å—É–¥–∏—Ç—å –≤–æ–ª–Ω—É—é—â–∏–µ —Ç–µ–±—è —Ä–∞–±–æ—á–∏–µ —Ç–µ–º—ã.", "–¢–µ–±—è —É–≤–∞–∂–∞—é—Ç, —Å—á–∏—Ç–∞—é—Ç –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–æ–º.", "–ú–æ–∂–Ω–æ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è —Å –Ω—É–∂–Ω—ã–º–∏ –ª—é–¥—å–º–∏, –∑–∞–≤—è–∑–∞—Ç—å –ø–æ–ª–µ–∑–Ω—ã–µ —Å–≤—è–∑–∏.", "–ú–æ–∂–Ω–æ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –Ω–æ–≤—ã—Ö –¥—Ä—É–∑–µ–π.", "–ë—ã–≤–∞—é—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∑–∞—Å–ª—É–∂–µ–Ω–Ω—ã–µ –ª—é–¥–∏.", "–í—Å–µ —Å–≤—è–∑–∞–Ω—ã –æ–±—â–∏–º –¥–µ–ª–æ–º.", "–ú–æ–∂–Ω–æ –ø—Ä–æ—è–≤–∏—Ç—å –∏ —Ä–∞–∑–≤–∏—Ç—å —Å–≤–æ–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏." ]},
    {q:"–Ø —Ö–æ—Ç–µ–ª –±—ã –Ω–∞ —Ä–∞–±–æ—Ç–µ –±—ã—Ç—å —Ä—è–¥–æ–º —Å —Ç–∞–∫–∏–º–∏ –ª—é–¥—å–º–∏:", i:[ "–° –∫–æ—Ç–æ—Ä—ã–º–∏ –º–æ–∂–Ω–æ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Ç–µ–º—ã.", "–ö–æ—Ç–æ—Ä—ã–º –º–æ–≥ –±—ã –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Å–≤–æ–π –æ–ø—ã—Ç –∏ –∑–Ω–∞–Ω–∏—è.", "–° –∫–æ—Ç–æ—Ä—ã–º–∏ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å.", "–ö–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç –∏ –≤–µ—Å –Ω–∞ —Ä–∞–±–æ—Ç–µ.", "–ö–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –Ω–∞—É—á–∏—Ç—å —á–µ–º—É-–Ω–∏–±—É–¥—å –ø–æ–ª–µ–∑–Ω–æ–º—É.", "–ö–æ—Ç–æ—Ä—ã–µ –∑–∞—Å—Ç–∞–≤–ª—è—é—Ç —Ç–µ–±—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∞–∫—Ç–∏–≤–Ω–µ–µ –Ω–∞ —Ä–∞–±–æ—Ç–µ.", "–ö–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç –º–Ω–æ–≥–æ –∑–Ω–∞–Ω–∏–π –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –∏–¥–µ–π.", "–ö–æ—Ç–æ—Ä—ã–µ –≥–æ—Ç–æ–≤—ã –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Ç–µ–±—è –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö." ]},
    {q:"–ö –Ω–∞—Å—Ç–æ—è—â–µ–º—É –≤—Ä–µ–º–µ–Ω–∏ —è –∏–º–µ—é –≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏:", i:[ "–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–µ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ.", "–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ —Ä–∞–∑–≤–ª–µ–∫–∞—Ç—å—Å—è.", "–•–æ—Ä–æ—à–∏–µ —É—Å–ª–æ–≤–∏—è –∂–∏–∑–Ω–∏.", "–•–æ—Ä–æ—à—É—é —Å–µ–º—å—é.", "–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –≤—Ä–µ–º—è –≤ –æ–±—â–µ—Å—Ç–≤–µ.", "–£–≤–∞–∂–µ–Ω–∏–µ, –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –∏ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –¥—Ä—É–≥–∏—Ö.", "–ß—É–≤—Å—Ç–≤–æ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö.", "–°–æ–∑–¥–∞–Ω–∏–µ —á–µ–≥–æ-—Ç–æ —Ü–µ–Ω–Ω–æ–≥–æ, –ø–æ–ª–µ–∑–Ω–æ–≥–æ." ]},
    {q:"–Ø –¥—É–º–∞—é, —á—Ç–æ –∏–º–µ—é –≤ —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç–µ –≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏:", i:[ "–•–æ—Ä–æ—à—É—é –∑–∞—Ä–ø–ª–∞—Ç—É, –¥—Ä—É–≥–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ –±–ª–∞–≥–∞.", "–•–æ—Ä–æ—à–∏–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã.", "–•–æ—Ä–æ—à–∏–π –∫–æ–ª–ª–µ–∫—Ç–∏–≤, –¥—Ä—É–∂–µ—Å–∫–∏–µ –≤–∑–∞–∏–º–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è.", "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.", "–•–æ—Ä–æ—à—É—é –¥–æ–ª–∂–Ω–æ—Å—Ç—å.", "–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å.", "–ê–≤—Ç–æ—Ä–∏—Ç–µ—Ç –∏ —É–≤–∞–∂–µ–Ω–∏–µ –∫–æ–ª–ª–µ–≥.", "–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å." ]},
    {q:"–ë–æ–ª—å—à–µ –≤—Å–µ–≥–æ –º–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è, –∫–æ–≥–¥–∞:", i:[ "–ù–µ –Ω—É–∂–Ω–æ –¥—É–º–∞—Ç—å –æ –Ω–∞—Å—É—â–Ω—ã—Ö –∑–∞–±–æ—Ç–∞—Ö.", "–ï—Å—Ç—å –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–µ, –ø—Ä–∏—è—Ç–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ.", "–ö—Ä—É–≥–æ–º –æ–∂–∏–≤–ª–µ–Ω–∏–µ, –≤–µ—Å–µ–ª–∞—è —Å—É–µ—Ç–∞.", "–ü—Ä–µ–¥—Å—Ç–æ–∏—Ç –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤—Ä–µ–º—è –≤ –≤–µ—Å–µ–ª–æ–º –æ–±—â–µ—Å—Ç–≤–µ.", "–ò—Å–ø—ã—Ç—ã–≤–∞—é —á—É–≤—Å—Ç–≤–æ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è, –ø–æ–∏—Å–∫–∞.", "–ò—Å–ø—ã—Ç—ã–≤–∞—é —á—É–≤—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.", "–ü–æ–≥—Ä—É–∂–µ–Ω –≤ —Å–≤–æ—é —Ä–∞–±–æ—Ç—É.", "–í–∫–ª—é—á–µ–Ω –≤ —Å–æ–≤–º–µ—Å—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É —Å –¥—Ä—É–≥–∏–º–∏." ]},
    {q:"–ö–æ–≥–¥–∞ –º–µ–Ω—è –ø–æ—Å—Ç–∏–≥–∞–µ—Ç –Ω–µ—É–¥–∞—á–∞, –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Ç–æ, —á—Ç–æ —è —Ö–æ—á—É:", i:[ "–Ø —Ä–∞—Å—Å—Ç—Ä–∞–∏–≤–∞—é—Å—å –∏ –¥–æ–ª–≥–æ –ø–µ—Ä–µ–∂–∏–≤–∞—é.", "–°—Ç–∞—Ä–∞—é—Å—å –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —á—Ç–æ-–Ω–∏–±—É–¥—å –¥—Ä—É–≥–æ–µ, –ø—Ä–∏—è—Ç–Ω–æ–µ.", "–¢–µ—Ä—è—é—Å—å, –Ω–µ –∑–Ω–∞—é —á—Ç–æ –¥–µ–ª–∞—Ç—å, –∑–ª—é—Å—å –Ω–∞ —Å–µ–±—è.", "–ó–ª—é—Å—å –Ω–∞ —Ç–æ, —á—Ç–æ –º–Ω–µ –ø–æ–º–µ—à–∞–ª–æ.", "–°—Ç–∞—Ä–∞—é—Å—å –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è —Å–ø–æ–∫–æ–π–Ω—ã–º, –∏ –æ–±—ã—á–Ω–æ –º–Ω–µ —ç—Ç–æ —É–¥–∞–µ—Ç—Å—è.", "–ü–µ—Ä–µ–∂–∏–¥–∞—é, –∫–æ–≥–¥–∞ –ø—Ä–æ–π–¥–µ—Ç –ø–µ—Ä–≤–∞—è —Ä–µ–∞–∫—Ü–∏—è, –∏ —Å–ø–æ–∫–æ–π–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ.", "–°—Ç–∞—Ä–∞—é—Å—å –ø–æ–Ω—è—Ç—å, –≤ —á–µ–º —è —Å–∞–º –±—ã–ª –≤–∏–Ω–æ–≤–∞—Ç.", "–°—Ç–∞—Ä–∞—é—Å—å –ø–æ–Ω—è—Ç—å –ø—Ä–∏—á–∏–Ω—ã –Ω–µ—É–¥–∞—á–∏ –∏ –ø–æ–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª–æ–∂–µ–Ω–∏–µ." ]}
];

const ipl_qs=[
    "–í—Å–µ –∑–Ω–∞–Ω–∏—è –æ –º–∏—Ä–µ –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –∫–Ω–∏–≥, –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–π —Å–µ—Ç–∏.", "–ö–æ–≥–¥–∞ —è –¥—É–º–∞—é –æ –±—É–¥—É—â–µ–º, –Ω–µ —á—É–≤—Å—Ç–≤—É—é —Å—Ç—Ä–∞—Ö–∞ –∑–∞ —Å–≤–æ—é —Å–µ–º—å—é, —Å—Ç—Ä–∞–Ω—É, –≥–¥–µ —è –∂–∏–≤—É.", "–Ø —Å–º–æ–≥ –±—ã –ø–æ–±–æ—Ä–æ—Ç—å —Å—Ç—Ä–∞—Ö –∑–∞ —Å–≤–æ—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∑–∞–Ω—è—Ç—å—Å—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–º –≤–∏–¥–æ–º —Å–ø–æ—Ä—Ç–∞, –ø—Ä—ã–≥–Ω—É—Ç—å —Å –ø–∞—Ä–∞—à—é—Ç–æ–º, –Ω—ã—Ä–Ω—É—Ç—å —Å –∞–∫–≤–∞–ª–∞–Ω–≥–æ–º.", "–Ø –±–µ–∑ —É—Å–∏–ª–∏–π –ø–µ—Ä–µ–∫–ª—é—á–∞—é—Å—å –Ω–∞ —Ä–∞–±–æ—á–∏–π —Ä–µ–∂–∏–º –ø–æ—Å–ª–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ –∏–ª–∏ –æ—Ç–ø—É—Å–∫–∞.", "–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –ø–æ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ª–µ—Å—Ç–Ω–∏—Ü–µ ‚Äì –≥–ª–∞–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π —è —Å—Ç–∞—Ä–∞—é—Å—å –æ–≤–ª–∞–¥–µ—Ç—å –Ω–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∞ –¥–ª—è –º–µ–Ω—è –Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞.", "–ü—Ä–æ–∏—Å—Ö–æ–¥—è—â–∏–µ —Å–æ –º–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω—ã –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç —É –º–µ–Ω—è —á—É–≤—Å—Ç–≤–∞ —Ç—Ä–µ–≤–æ–≥–∏ –∏–ª–∏ –±–µ—Å–ø–æ–∫–æ–π—Å—Ç–≤–∞.", "–†—è–¥–æ–≤–æ–π —á–µ–ª–æ–≤–µ–∫ –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ –æ–∑–æ–Ω–æ–≤—ã—Ö –¥—ã—Ä, –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ –ø—Ä–∏—Ä–æ–¥–Ω–æ–π —Å—Ä–µ–¥—ã –∏ –ø—Ä–æ—á–∏–µ –ø–æ–¥–æ–±–Ω—ã–µ –∫–∞—Ç–∞–∫–ª–∏–∑–º—ã.", "–ö–æ–≥–¥–∞ —è –∏–¥—É –ø–æ —Ö–æ—Ä–æ—à–æ –∑–Ω–∞–∫–æ–º–æ–π –¥–æ—Ä–æ–≥–µ, —Ç–æ —Å—Ä–∞–∑—É –ø–æ–¥–º–µ—á–∞—é –ø—Ä–æ–∏–∑–æ—à–µ–¥—à–∏–µ –≤–æ–∫—Ä—É–≥ –ø–µ—Ä–µ–º–µ–Ω—ã.", "–õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–æ—Ü–∏–∞–ª—å–Ω–æ-–ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –æ—á–µ—Ä–µ–¥–Ω–æ–º—É –∫—Ä–∏–∑–∏—Å—É.", "–Ø - –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏, –ø–æ—ç—Ç–æ–º—É —á—å–∏-–ª–∏–±–æ –ø–æ–ø—ã—Ç–∫–∏ –≤–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –º–æ–µ–π —Ä–∞–±–æ—Ç—ã, —Ç–æ–ª—å–∫–æ –≤—Ä–µ–¥—è—Ç –¥–µ–ª—É.", "–Ø –ª–µ–≥–∫–æ –Ω–∞—Ö–æ–∂—É —è–∑—ã–∫ —Å –Ω–æ–≤—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º, –≤–µ–¥—É —Å–µ–±—è –∫–∞–∫ –æ–±—ã—á–Ω–æ –≤ –∫—Ä—É–≥—É –Ω–µ–∑–Ω–∞–∫–æ–º—ã—Ö –ª—é–¥–µ–π.", "–Ø –Ω–µ –ø—Ä–∏–¥–∞—é –æ—Å–æ–±–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–º—É –º–µ—Å—Ç—É –æ—Ç–¥—ã—Ö–∞, –ø–∏—Ç–∞–Ω–∏—é.", "–Ø —Ä–µ–≥—É–ª—è—Ä–Ω–æ –∏ —Å –∏–Ω—Ç–µ—Ä–µ—Å–æ–º —á–∏—Ç–∞—é –∫–Ω–∏–≥–∏ ¬´–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –∞–≤—Ç–æ—Ä–æ–≤¬ª, —Å–ª—É—à–∞—é –Ω–æ–≤—ã–µ, –Ω–µ–æ–±—ã—á–Ω—ã–µ –≤–∏–¥—ã –º—É–∑—ã–∫–∏, –ø–æ—Å–µ—â–∞—é –≤—ã—Å—Ç–∞–≤–∫–∏, —Ç–µ–∞—Ç—Ä.", "–í —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –º–∏—Ä–µ, —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ –ø–æ—Å–ª–æ–≤–∏—Ü–µ ‚Äì –º–Ω–æ–≥–æ –Ω–æ–≤–æ–≥–æ, –º–∞–ª–æ —Ö–æ—Ä–æ—à–µ–≥–æ.", "–û–±—ã—á–Ω–æ –º–Ω–µ —Ç—Ä—É–¥–Ω–æ –≤–∑—è—Ç—å—Å—è –∑–∞ –Ω–æ–≤–æ–µ –¥–µ–ª–æ.", "–ö—É–ª—å—Ç—É—Ä–Ω—ã–º –≤–ø–æ–ª–Ω–µ –º–æ–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å —Ç–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç –≤—ã—Å—à–µ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ.", "–ï—Å–ª–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç –º–æ–∏–º –º–æ—Ä–∞–ª—å–Ω—ã–º –∏–ª–∏ –Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω—ã–º –Ω–æ—Ä–º–∞–º, —è –±–µ–∑ –∫–æ–ª–µ–±–∞–Ω–∏–π —Å–º–µ–Ω—é –º–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∞ –ø—Ä–µ—Å—Ç–∏–∂–Ω–∞ –∏ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ –æ–ø–ª–∞—á–∏–≤–∞–µ–º–∞.", "–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ª—é–¥–µ–π –∂–∏–≤–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–π, –Ω–∞—Å—ã—â–µ–Ω–Ω–æ–π –∂–∏–∑–Ω—å—é.", "–Ø —Å—Ç–∞—Ä–∞—é—Å—å –ø—Ä–∏—Å–ª—É—à–∏–≤–∞—Ç—å—Å—è –∫ –ø—Ä–∏—Ä–æ–¥–Ω–æ–º—É —Ä–∏—Ç–º—É –º–∏—Ä–∞.", "–î–ª—è –º–µ–Ω—è –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å –ø—Ä–∏–Ω—è—Ç—ã–µ –≤ –º–æ–µ–π —Å—Ä–µ–¥–µ –ø—Ä–∞–≤–∏–ª–∞.", "–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —Å—É—Ç–∏ —á–µ–≥–æ-–ª–∏–±–æ, –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–ø—Ä–æ—Å–∏—Ç—å –æ–± —ç—Ç–æ–º —É —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤.", "–•–æ—Ä–æ—à–∏–π –¥—Ä—É–≥ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏–∑–º–µ–Ω–∏—Ç —Å–≤–æ–∏ —Å–∏–º–ø–∞—Ç–∏–∏ –∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–æ –º–Ω–µ.", "–Ø —Å –∏–Ω—Ç–µ—Ä–µ—Å–æ–º, –Ω–µ–ø—Ä–µ–¥–≤–∑—è—Ç–æ –∏ –±–µ–∑ —Å–∫–µ–ø—Ç–∏—Ü–∏–∑–º–∞ –æ—Ç–Ω–æ—à—É—Å—å –∫ –∫—É–ª—å—Ç—É—Ä–Ω—ã–º —Ç—Ä–∞–¥–∏—Ü–∏—è–º —Å–∞–º—ã—Ö —Ä–∞–∑–Ω—ã—Ö –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–µ–π.", "–ñ–∏–∑–Ω–µ–Ω–Ω—ã–µ, —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞ –Ω–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –º–Ω–µ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Å–ª–µ–¥–∏—Ç—å –∑–∞ –Ω–æ–≤–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–æ–π –ø–æ –º–æ–µ–π —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏.", "–õ—É—á—à–µ –∂–∏—Ç—å –≤ —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–∏–µ.", "–Ø —Å —Ç—Ä—É–¥–æ–º –ø—Ä–∏–≤—ã–∫–∞—é –∫ –Ω–æ–≤–æ–º—É –∫–æ–ª–ª–µ–∫—Ç–∏–≤—É, —Ä–∞–±–æ—Ç–µ, –º–µ—Å—Ç—É –æ—Ç–¥—ã—Ö–∞.", "–Ø —Å–∫–µ–ø—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–Ω–æ—à—É—Å—å –∫–æ –≤—Å—è–∫–æ–≥–æ —Ä–æ–¥–∞ –Ω–æ–≤–æ–≤–≤–µ–¥–µ–Ω–∏—è–º, –Ω–µ—Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–º –ø–æ–¥—Ö–æ–¥–∞–º –≤ –∂–∏–≤–æ–ø–∏—Å–∏, –∫–∏–Ω–æ, —Ç–µ–∞—Ç—Ä–∞–ª—å–Ω—ã—Ö –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞—Ö.", "–Ø –≤—Å–µ —á–∞—â–µ –∑–∞–¥—É–º—ã–≤–∞—é—Å—å –Ω–∞–¥ —Ç–µ–º, —á—Ç–æ –≤—Ä–µ–º—è –±—ã—Å—Ç—Ä–æ—Ç–µ—á–Ω–æ –∏ –±–µ–∑–∂–∞–ª–æ—Å—Ç–Ω–æ.", "–ú–µ–Ω—è —Ä–∞–¥—É—é—Ç —Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–æ—à–ª–∏ –≤ –º–æ–µ–π –∂–∏–∑–Ω–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è.", "–ú–µ–Ω—è –Ω–µ –ø—É–≥–∞–µ—Ç –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞ –≤–Ω–µ–∑–∞–ø–Ω–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –æ—Å–≤–æ–∏—Ç—å –Ω–æ–≤—É—é —Å—Ñ–µ—Ä—É –∑–Ω–∞–Ω–∏–π.", "–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∏–ª—å —Ä–∞–±–æ—Ç—ã, –æ–¥–Ω–∞–∂–¥—ã –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å, –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏ –ª—é–¥–µ–π –≤—ã–Ω—É–∂–¥–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å.", "–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –±–µ–∑ –æ—à–∏–±–æ–∫ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ —Å–æ–≤—Å–µ–º –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Å–º–µ–Ω–æ–π –ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞, –∏ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è–º–∏ –∫ –∫–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–∏.", "–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–∞—Å–ø–æ—Ä—è–¥–∫–µ –¥–Ω—è –≤—ã–∑—ã–≤–∞—é—Ç —É –º–µ–Ω—è —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ.", "–û–±—ã—á–Ω–æ —è –ª–µ–≥–∫–æ –º–µ–Ω—è—é –ø—Ä–∏–Ω—è—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ, —É—á–∏—Ç—ã–≤–∞—è —Ä–∞–∑—É–º–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥—Ä—É–≥–∏—Ö.", "–Ø –±–µ–∑ —Ç—Ä—É–¥–∞ –æ—Ä–∏–µ–Ω—Ç–∏—Ä—É—è—Å—å –Ω–∞ –Ω–µ–∑–Ω–∞–∫–æ–º–æ–π –º–µ—Å—Ç–Ω–æ—Å—Ç–∏.", "–ú–Ω–µ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–∏–ª, —á—Ç–æ–±—ã –æ–±—Ä–∞—Ç–∏—Ç—å –Ω–µ–±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–µ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞ –Ω–∞ —Å–≤–æ—é –ø–æ–ª—å–∑—É."
];

// –°–æ—Å—Ç–æ—è–Ω–∏–µ
let state = { meta: {}, bratus: {}, rank: 1, milman: {}, ipl: {}, timing: {start: Date.now(), milman_start:0, ipl_start:0} };
let anonMode = false;

// --- PERSISTENCE ---
function saveStateToLocal() { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); updateProgress(); }
function loadStateFromLocal() {
    let saved = localStorage.getItem(STORAGE_KEY);
    if (saved) Object.assign(state, JSON.parse(saved));
}
function clearState() { localStorage.removeItem(STORAGE_KEY); window.location.reload(); }

// INIT
window.onload = function() {
    if (localStorage.getItem(STORAGE_KEY)) {
        loadStateFromLocal();
        if (state.finished) {
            finishSurvey(true);
        } else if (Object.keys(state.ipl).length > 0) {
            switchStep('step-form', 'step-ipl'); renderIPL();
        } else if (Object.keys(state.milman).length > 0) {
            switchStep('step-form', 'step-milman'); renderMilman();
        } else if (state.rank > 1 || (state.bratus && Object.keys(state.bratus).length > 0)) {
            switchStep('step-form', 'step-bratus'); renderBratus();
        } else if (state.meta.fio) {
            restoreForm();
        }
    }
};

function restoreForm() {
    if (state.meta.mode === 'anon' || state.meta.fio === "–ê–Ω–æ–Ω–∏–º") {
        document.getElementById('anon_mode').checked = true;
        toggleAnon();
    }
    for(let k in state.meta) { let el = document.getElementById(k); if(el) el.value = state.meta[k]; }
    toggleWorkPlace(); toggleEduBlock();
}

function updateProgress() {
    let current = 0;
    if (document.getElementById('step-bratus').classList.contains('active')) current = state.rank;
    else if (document.getElementById('step-milman').classList.contains('active')) current = 9;
    else if (document.getElementById('step-ipl').classList.contains('active')) current = 10;
    else if (document.getElementById('step-results').classList.contains('active')) current = 11;
    
    let pct = Math.min(100, (current / 11) * 100);
    document.querySelector('.progress-fill').style.width = pct + "%";
}

// --- GOD MODE (DEV) ---
function checkDevMode(val) {
    if(val.toLowerCase().trim() === 'dev') {
        document.getElementById('dev-panel').style.display = 'block';
    }
}

function fillRandomData() {
    state.meta = { fio: "–¢–µ—Å—Ç–æ–≤—ã–π –Æ–∑–µ—Ä", gender: "–ú—É–∂—Å–∫–æ–π", age: "25", family_status: "–•–æ–ª–æ—Å—Ç/–ù–µ –∑–∞–º—É–∂–µ–º", children: "–ù–µ—Ç", is_working: "–î–∞", work_place: "IT", has_secondary_edu: "–ù–µ—Ç", edu_status: "–£—á—É—Å—å", university: "–°—É—Ä–ì–£", speciality: "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è", edu_level: "–ë–∞–∫–∞–ª–∞–≤—Ä–∏–∞—Ç", edu_basis: "–ë—é–¥–∂–µ—Ç", course: "4", mode: "dev" };
    
    let ids = Array.from({length:24}, (_, i) => i + 1);
    for(let r=1; r<=8; r++) {
        state.bratus[r] = [];
        for(let k=0; k<3; k++) {
            let randIdx = Math.floor(Math.random() * ids.length);
            state.bratus[r].push(ids[randIdx]);
            ids.splice(randIdx, 1);
        }
    }
    state.rank = 8;
    for(let q=0; q<14; q++) for(let i=0; i<8; i++) state.milman[`${q}_${i}`] = Math.floor(Math.random() * 4);
    for(let i=0; i<36; i++) state.ipl[i] = Math.floor(Math.random() * 5) + 1;
    
    saveStateToLocal();
    finishSurvey();
}

function loadDevJSON() {
    try {
        let json = document.getElementById('dev-json-input').value;
        let data = JSON.parse(json);
        if(data.bratus && data.milman && data.ipl) {
            state = data;
            state.meta.mode = "dev"; // Force dev to avoid pollution
            saveStateToLocal();
            finishSurvey(true);
        } else {
            alert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON (–Ω–µ—Ç –ø–æ–ª–µ–π bratus/milman/ipl)");
        }
    } catch(e) {
        document.getElementById('dev-error').innerText = "–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞: " + e.message;
    }
}

// --- –õ–û–ì–ò–ö–ê ---
function toggleAnon() {
    anonMode = document.getElementById('anon_mode').checked;
    state.meta.mode = anonMode ? 'anon' : 'normal';
    document.getElementById('anon_warning').style.display = anonMode ? 'block' : 'none';
    document.querySelectorAll('.req').forEach(el => el.style.display = anonMode ? 'none' : 'inline');
    const inputs = document.querySelectorAll('#step-form input:not(#anon_mode), #step-form select');
    inputs.forEach(el => el.style.backgroundColor = anonMode ? '#f9f9f9' : '#fff');
    saveStateToLocal();
}

function toggleWorkPlace() { document.getElementById('work_place_block').style.display = (document.getElementById('is_working').value === "–î–∞") ? 'block' : 'none'; }
function toggleEduBlock() {
    const status = document.getElementById('edu_status').value;
    document.getElementById('edu_block').style.display = (status === "–£—á—É—Å—å" || status === "–ó–∞–∫–æ–Ω—á–∏–ª") ? 'block' : 'none';
    document.getElementById('course_block').style.display = (status === "–£—á—É—Å—å") ? 'block' : 'none';
}

function validateForm() {
    let ids = ['fio','gender','age','family_status','children','is_working','has_secondary_edu','edu_status'];
    const status = document.getElementById('edu_status').value;
    if(status === '–£—á—É—Å—å') ids = ids.concat(['university','speciality','edu_level','edu_basis','course']);
    else if(status === '–ó–∞–∫–æ–Ω—á–∏–ª') ids = ids.concat(['university','speciality','edu_level','edu_basis']);
    
    let valid = true;
    anonMode = document.getElementById('anon_mode').checked;
    
    if (!anonMode) {
        ids.forEach(id => {
            let el = document.getElementById(id);
            if(!el || !el.value) { if(el) el.style.borderColor = "var(--error)"; valid = false; } 
            else { if(el) el.style.borderColor = "#ddd"; state.meta[id] = el.value; }
        });
    } else {
        ids.forEach(id => { state.meta[id] = "–ê–Ω–æ–Ω–∏–º"; });
    }
    if(!valid) { document.getElementById('form-error').style.display = 'block'; return; }
    
    saveStateToLocal();
    switchStep('step-form', 'step-bratus');
    renderBratus();
}

function renderBratus() {
    const c = document.getElementById('bratus-options'); c.innerHTML = "";
    document.getElementById('bratus-sub').innerHTML = `–í—ã–±–µ—Ä–∏—Ç–µ <b>3</b> —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è <b>${state.rank}-–≥–æ –º–µ—Å—Ç–∞</b>`;
    
    let used = []; 
    for(let k in state.bratus) if(parseInt(k) !== state.rank) used = used.concat(state.bratus[k]);
    
    bratus_stmts.forEach(s => {
        if(!used.includes(s.id)) {
            let div = document.createElement('div'); div.className = 'option-card'; div.innerHTML = `<input type="checkbox" value="${s.id}"> ${s.t}`;
            if(state.bratus[state.rank] && state.bratus[state.rank].includes(s.id)) { div.classList.add('checked'); div.querySelector('input').checked = true; }
            div.onclick = (e) => { 
                if(e.target.tagName!=='INPUT') div.querySelector('input').click(); 
                div.classList.toggle('checked', div.querySelector('input').checked); 
                saveStateToLocal();
            };
            div.querySelector('input').onchange = () => saveStateToLocal();
            c.appendChild(div);
        }
    });
    updateProgress();
}
function nextBratusRank() {
    const ch = document.querySelectorAll('#bratus-options input:checked');
    if(ch.length !== 3) { document.getElementById('bratus-error').style.display = 'block'; return; }
    document.getElementById('bratus-error').style.display = 'none';
    state.bratus[state.rank] = Array.from(ch).map(i => parseInt(i.value));
    saveStateToLocal();
    if(state.rank < 8) { state.rank++; renderBratus(); window.scrollTo(0,0); }
    else { state.timing.milman_start = Date.now(); switchStep('step-bratus', 'step-milman'); renderMilman(); }
}
function prevBratusRank() { if(state.rank > 1) { state.rank--; renderBratus(); } else switchStep('step-bratus', 'step-form'); saveStateToLocal(); }

function renderMilman() {
    const c = document.getElementById('milman-container');
    document.getElementById('progress').style.width = "60%"; 
    if(c.innerHTML) {
        for(let k in state.milman) { 
            let el = document.querySelector(`input[name="m_${k}"][value="${state.milman[k]}"]`); 
            if(el) el.checked = true; 
        }
        return; 
    }
    
    milman_qs.forEach((q, qi) => {
        let h = `<div class="q-block"><h3>${qi+1}. ${q.q}</h3><table><thead><tr><th>–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</th><th>++ (–î–∞, —Å–æ–≥–ª–∞—Å–µ–Ω)</th><th>+ (–ü–æ–∂–∞–ª—É–π —Å–æ–≥–ª–∞—Å–µ–Ω)</th><th>= (–ö–æ–≥–¥–∞ –∫–∞–∫)</th><th>- / ? (–ù–µ—Ç / –ù–µ –∑–Ω–∞—é)</th></tr></thead><tbody>`;
        q.i.forEach((txt, ii) => {
            let nm = `m_${qi}_${ii}`;
            h += `<tr id="row_${nm}"><td>${txt}</td>
            <td data-label="++ (–î–∞)"><input type="radio" name="${nm}" value="3" onclick="saveM('${nm}',3)"></td>
            <td data-label="+ (–ü–æ–∂–∞–ª—É–π)"><input type="radio" name="${nm}" value="2" onclick="saveM('${nm}',2)"></td>
            <td data-label="= (–ö–æ–≥–¥–∞ –∫–∞–∫)"><input type="radio" name="${nm}" value="1" onclick="saveM('${nm}',1)"></td>
            <td data-label="- / ? (–ù–µ—Ç)"><input type="radio" name="${nm}" value="0" onclick="saveM('${nm}',0)"></td></tr>`;
        });
        c.innerHTML += h + "</tbody></table></div>";
    });
    for(let k in state.milman) { 
        let el = document.querySelector(`input[name="m_${k}"][value="${state.milman[k]}"]`); 
        if(el) el.checked = true; 
    }
    updateProgress();
}
function saveM(k, v) { state.milman[k.replace('m_','')] = v; document.getElementById('row_'+k).classList.remove('highlight-error'); saveStateToLocal(); }
function finishMilman() {
    if(!validateGroup('m', 14, 8)) return;
    
    // Check for Fast Clicker (less than 60s)
    if (state.timing && state.timing.milman_start) {
        let dur = (Date.now() - state.timing.milman_start) / 1000;
        if (dur < 60) {
            state.meta.flags = (state.meta.flags || "") + "FAST_MILMAN;";
        }
    }

    switchStep('step-milman', 'step-ipl');
    renderIPL();
}
function prevMilman() { switchStep('step-milman', 'step-bratus'); saveStateToLocal(); }

function renderIPL() {
    const c = document.getElementById('ipl-container');
    if(c.innerHTML) {
        for(let k in state.ipl) { 
            let el = document.querySelector(`input[name="ipl_${k}"][value="${state.ipl[k]}"]`); 
            if(el) el.checked = true; 
        }
        return;
    }
    let h = `<table><thead><tr><th>–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</th><th>1 (–ù–µ —Å–æ–≥–ª–∞—Å–µ–Ω)</th><th>2</th><th>3</th><th>4</th><th>5 (–°–æ–≥–ª–∞—Å–µ–Ω)</th></tr></thead><tbody>`;
    ipl_qs.forEach((txt, i) => {
        let nm = `ipl_${i}`;
        h += `<tr id="row_${nm}"><td>${i+1}. ${txt}</td>${[1,2,3,4,5].map(v => `<td data-label="${v}"><input type="radio" name="${nm}" value="${v}" onclick="saveI(${i},${v})"></td>`).join('')}</tr>`;
    });
    c.innerHTML = h + "</tbody></table>";
    for(let k in state.ipl) { 
        let el = document.querySelector(`input[name="ipl_${k}"][value="${state.ipl[k]}"]`); 
        if(el) el.checked = true; 
    }
    updateProgress();
}
function saveI(i, v) { state.ipl[i] = v; document.getElementById('row_ipl_'+i).classList.remove('highlight-error'); saveStateToLocal(); }
function prevIPL() { switchStep('step-ipl', 'step-milman'); saveStateToLocal(); }

// --- –§–ò–ù–ê–õ ---
function finishSurvey(skipFetch = false) {
    if(!skipFetch && !validateGroup('ipl', 36, 1)) return;
    
    state.finished = true; 
    saveStateToLocal();
    updateProgress();

    if(skipFetch) {
        switchStep('step-ipl', 'step-results'); 
        switchStep('step-form', 'step-results'); 
        calculateAndShowResults(true);
        return;
    }

    switchStep('step-ipl', 'step-loading');
    
    const isDev = state.meta.mode === 'dev';

    if (!isDev) {
        fetch(GOOGLE_URL, { method: "POST", mode: "no-cors", headers: { "Content-Type": "application/json" }, body: JSON.stringify(state) })
        .then(() => { document.getElementById('final-msg').innerHTML = "–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ <b style='color:green'>—Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –æ–±–ª–∞–∫–µ</b>."; })
        .catch(() => { document.getElementById('final-msg').innerHTML = "<b style='color:red'>–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏!</b> –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª."; });
    } else {
        console.log("DEV MODE: –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞.");
        document.getElementById('final-msg').innerHTML = "<b style='color:orange'>[–†–ï–ñ–ò–ú –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–ê]</b> –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –æ–±–ª–∞–∫–æ –æ—Ç–∫–ª—é—á–µ–Ω–∞.";
    }

    calculateAndShowResults();
}

function calculateAndShowResults(immediate = false) {
    // 1. –ë–†–ê–¢–£–°–¨
    const cats_map = { '–ê–ª—å—Ç—Ä—É–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ': [1,9,17], '–≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ': [2,10,18], '–ì–µ–¥–æ–Ω–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ': [3,11,19], '–°–∞–º–æ—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏': [4,12,20], '–°—Ç–∞—Ç—É—Å–Ω—ã–µ': [5,13,21], '–ö–æ–º–º—É–Ω–∏–∫–∞—Ç–∏–≤–Ω—ã–µ': [6,14,22], '–°–µ–º–µ–π–Ω—ã–µ': [7,15,23], '–ö–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ': [8,16,24] };
    let b_labels=[], b_data=[], b_desc="";
    let id_to_rank = {}; for(let r in state.bratus) state.bratus[r].forEach(id => id_to_rank[id] = parseInt(r));
    for(let c in cats_map) { 
        let sum = 0; cats_map[c].forEach(id => sum += (id_to_rank[id] || 0)); 
        b_labels.push(c); b_data.push(sum);
        let status = sum <= 9 ? "<span style='color:green'>–î–æ–º–∏–Ω–∏—Ä—É—é—Ç</span>" : (sum <= 17 ? "–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ" : "<span style='color:red'>–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã —Å–ª–∞–±–æ</span>");
        b_desc += `<div><b>${c}:</b> ${sum} (${status})</div>`;
    }

    // 2. –ú–ò–õ–¨–ú–ê–ù
    const m_keys = [ ['P','P','O','D','OD','S','DR','DR'], ['P','K','K','S','S','DR','DR','OD'], ['P','K','O','OD','OD','-','D','P'], ['D','O','OD','D','DR','P','OD','K'], ['P','K','K','OD','DR','DR','OD','P'], ['D','D','O','S','-','DR','OD','P'], ['K','O','S','S','P','DR','DR','O'], ['P','O','S','O','DR','OD','DR','S'], ['K','D','S','S','O','S','D','K'], ['O','OD','P','S','P','OD','DR','-'], ['P','K','K','O','S','S','OD','DR'], ['P','K','K','DR','S','S','OD','P'], ['ast','ast','ast','ast','st','st','st','st'], ['ast','ast','ast','ast','st','st','st','st'] ];
    const sub_map = { 0:'id', 4:'id', 8:'id', 1:'id', 5:'id', 9:'id', 2:'re', 6:'re', 10:'re', 3:'re', 7:'re', 11:'re' };
    let m_scores = { 'id': {'P':0,'K':0,'S':0,'O':0,'D':0,'DR':0,'OD':0}, 're': {'P':0,'K':0,'S':0,'O':0,'D':0,'DR':0,'OD':0} };
    
    // –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
    let emo = { st:0, ast:0, fst:0, fast:0 };

    for(let q=0; q<14; q++) { 
        if (q < 12) { // –ú–æ—Ç–∏–≤–∞—Ü–∏—è
            let type = sub_map[q]; 
            for(let i=0; i<8; i++) { 
                let val = state.milman[`${q}_${i}`] || 0; 
                let scale = m_keys[q][i]; 
                if(scale !== '-' && m_scores[type][scale] !== undefined) m_scores[type][scale] += val; 
            }
        } else { // –≠–º–æ—Ü–∏–∏ (13, 14)
            for(let i=0; i<8; i++) {
                let val = state.milman[`${q}_${i}`] || 0;
                let scale = m_keys[q][i]; // 'st' –∏–ª–∏ 'ast'
                if(q === 12) emo[scale] += val;
                if(q === 13) scale === 'st' ? emo.fst += val : emo.fast += val;
            }
        }
    }
    
    // –¢–∏–ø –ø—Ä–æ—Ñ–∏–ª—è –ú–∏–ª—å–º–∞–Ω–∞
    let sum_maintain = m_scores['id']['P'] + m_scores['id']['K'] + m_scores['id']['S']; 
    let sum_develop = m_scores['id']['D'] + m_scores['id']['DR'] + m_scores['id']['OD'];
    let m_type = (sum_develop - sum_maintain >= 5) ? "<span class='score-badge bg-green'>–ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π</span> (—Ä–∞–∑–≤–∏—Ç–∏–µ –ø—Ä–µ–æ–±–ª–∞–¥–∞–µ—Ç)" : (sum_maintain > sum_develop ? "<span class='score-badge bg-red'>–†–µ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π</span> (–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø—Ä–µ–æ–±–ª–∞–¥–∞–µ—Ç)" : "<span class='score-badge bg-blue'>–ò–º–ø—É–ª—å—Å–∏–≤–Ω—ã–π/–°–º–µ—à–∞–Ω–Ω—ã–π</span>");

    // –¢–∏–ø –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π
    let emo_type = (emo.st > emo.ast) ? "<span class='score-badge bg-green'>–°—Ç–µ–Ω–∏—á–µ—Å–∫–∏–π</span> (–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å)" : "<span class='score-badge bg-red'>–ê—Å—Ç–µ–Ω–∏—á–µ—Å–∫–∏–π</span> (—Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å, –Ω–µ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å)";

    const scales_order = ['P','K','S','O','D','DR','OD'];
    const scales_names = ['–ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ','–ö–æ–º—Ñ–æ—Ä—Ç','–°–æ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å','–û–±—â–µ–Ω–∏–µ','–û–±—â–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å','–¢–≤–æ—Ä—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å','–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–æ–ª—å–∑–∞'];
    let data_id = scales_order.map(s => m_scores['id'][s]);
    let data_re = scales_order.map(s => m_scores['re'][s]);

    // 3. –ò–ü–õ
    let ipl_sum = 0;
    let rev_idx = [0, 4, 6, 8, 9, 13, 14, 15, 19, 21, 23, 24, 25, 26, 27, 30, 31, 32];
    for(let i=0; i<36; i++) { let val = state.ipl[i]; if(rev_idx.includes(i)) val = 6 - val; ipl_sum += val; }

    setTimeout(() => {
        if(!immediate) switchStep('step-loading', 'step-results');
        
        document.getElementById('result-area').value = JSON.stringify(state, null, 2);

        if(window.chartB) window.chartB.destroy();
        window.chartB = new Chart(document.getElementById('chartBratus').getContext('2d'), {
            type: 'bar', data: { labels: b_labels, datasets: [{ label: '–°—É–º–º–∞ —Ä–∞–Ω–≥–æ–≤ (–ú–µ–Ω—å—à–µ = –í–∞–∂–Ω–µ–µ)', data: b_data, backgroundColor: '#3498db' }] },
            options: { scales: { y: { reverse: true, min: 0, max: 25 } } }
        });
        document.getElementById('textBratus').innerHTML = b_desc;
        
        if(window.chartM) window.chartM.destroy();
        window.chartM = new Chart(document.getElementById('chartMilman').getContext('2d'), {
            type: 'line', data: { labels: scales_names, datasets: [ { label: '–ñ–µ–ª–∞–µ–º–æ–µ (–ò–¥–µ–∞–ª)', data: data_id, borderColor: '#27ae60', backgroundColor: 'rgba(39,174,96,0.1)', fill: true }, { label: '–¢–µ–∫—É—â–µ–µ (–†–µ–∞–ª)', data: data_re, borderColor: '#e74c3c', backgroundColor: 'rgba(231,76,60,0.1)', fill: true } ] },
            options: { scales: { y: { min: 0 } } }
        });
        document.getElementById('textMilman').innerHTML = `
            <div style="margin-top:15px; border-top:1px solid #eee; padding-top:10px;">
                <div><b>–¢–∏–ø –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è:</b> ${m_type}</div>
                <div><b>–¢–∏–ø —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è:</b> ${emo_type}</div>
            </div>
        `;

        let ipl_level = ipl_sum >= 118 ? "–í—ã—Å–æ–∫–∏–π" : (ipl_sum >= 95 ? "–°—Ä–µ–¥–Ω–∏–π" : "–ù–∏–∑–∫–∏–π");
        let ipl_cls = ipl_sum >= 118 ? "bg-green" : (ipl_sum >= 95 ? "bg-blue" : "bg-red");
        let ipl_text = ipl_sum >= 118 ? "<b>–ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–Ω–æ-–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π —Ç–∏–ø.</b> –í—ã –æ—Ç–∫—Ä—ã—Ç—ã –Ω–æ–≤–æ–º—É, –ª–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç–µ—Å—å –∫ –ø–µ—Ä–µ–º–µ–Ω–∞–º –∏ –≥–æ—Ç–æ–≤—ã –∫ —Ä–∏—Å–∫—É." : (ipl_sum >= 95 ? "<b>–ü–æ–∑–∏—Ç–∏–≤–Ω–æ-–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–∏–ø.</b> –í—ã –≤–∑–≤–µ—à–µ–Ω–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç–µ –∫ –∏–Ω–Ω–æ–≤–∞—Ü–∏—è–º, –ø—Ä–∏–Ω–∏–º–∞—è –∏—Ö, –∫–æ–≥–¥–∞ –≤–∏–¥–∏—Ç–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é –ø–æ–ª—å–∑—É." : "<b>–í—ã–Ω—É–∂–¥–µ–Ω–Ω–æ-–ø—Ä–∏—Å–ø–æ—Å–æ–±–∏—Ç–µ–ª—å–Ω—ã–π —Ç–∏–ø.</b> –í—ã —Ü–µ–Ω–∏—Ç–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ —Ç—Ä–∞–¥–∏—Ü–∏–∏, –ø–µ—Ä–µ–º–µ–Ω—ã –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å —É –≤–∞—Å –¥–∏—Å–∫–æ–º—Ñ–æ—Ä—Ç.");

        document.getElementById('textIPL').innerHTML = `
            <div style="display:flex; align-items:center; gap:15px; margin-bottom:15px;">
                <div style="font-size:2.5em; font-weight:bold; color:#2c3e50;">${ipl_sum}</div>
                <div><span class="score-badge ${ipl_cls}" style="font-size:1.1em;">–£—Ä–æ–≤–µ–Ω—å: ${ipl_level}</span></div>
            </div>
            <p>${ipl_text}</p>
        `;
    }, immediate ? 0 : 1000);
}

// –£—Ç–∏–ª–∏—Ç—ã
function switchStep(f, t) { document.getElementById(f).classList.remove('active'); setTimeout(() => document.getElementById(t).classList.add('active'), 200); window.scrollTo(0,0); updateProgress(); }
function downloadJSON() { const fn = `Res_${state.meta.fio.replace(/[^–∞-—è–ê-–Øa-zA-Z0-9]/g,'_')}.json`; const blob = new Blob([JSON.stringify(state, null, 2)], {type: "application/json"}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = fn; document.body.appendChild(a); a.click(); a.remove(); }
function copyResult() { 
    let txt = document.getElementById('result-area'); 
    txt.style.display = 'block'; 
    txt.select(); 
    document.execCommand('copy'); 
    document.getElementById('copy-msg').style.display = 'block'; 
}
function validateGroup(prefix, c1, c2) {
    let err = null; let cont = prefix==='m'?state.milman:state.ipl;
    if(c2===1) { for(let i=0;i<c1;i++) if(!cont[i]) { err=document.getElementById('row_ipl_'+i); err.classList.add('highlight-error'); break; } }
    else { for(let q=0;q<c1;q++) for(let i=0;i<c2;i++) if(cont[`${q}_${i}`]===undefined) { err=document.getElementById(`row_m_${q}_${i}`); err.classList.add('highlight-error'); break; } }
    if(err) { err.scrollIntoView({behavior:"smooth", block:"center"}); document.getElementById(prefix==='m'?'milman-error':'ipl-error').style.display='block'; return false; }
    return true;
}
</script>
</body>
</html>
