<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</title>
    <style>
        :root { --primary: #3498db; --success: #27ae60; --error: #e74c3c; --bg: #f4f6f8; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); color: #333; margin: 0; padding: 15px; line-height: 1.5; }
        
        .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        
        h1 { font-size: 1.6rem; text-align: center; color: #2c3e50; margin-bottom: 10px; }
        h2 { font-size: 1.3rem; color: #34495e; margin-top: 0; text-align: center; }
        .subtitle { text-align: center; color: #7f8c8d; font-size: 0.9em; margin-bottom: 20px; }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ */
        .step { display: none; opacity: 0; transition: opacity 0.3s ease; }
        .step.active { display: block; opacity: 1; }
        
        /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 0.9rem; color: #555; }
        input[type="text"], input[type="number"], select { 
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; 
            font-size: 16px; box-sizing: border-box; background: #fff; appearance: none;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn { 
            display: block; width: 100%; padding: 16px; margin-top: 25px;
            background-color: var(--primary); color: white; border: none; border-radius: 10px; 
            font-size: 17px; font-weight: 600; cursor: pointer; transition: transform 0.1s; 
        }
        .btn:active { transform: scale(0.98); opacity: 0.9; }
        .btn-success { background-color: var(--success); }
        .btn-secondary { background-color: #95a5a6; margin-top: 10px; }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –≤—ã–±–æ—Ä–∞ (–ë—Ä–∞—Ç—É—Å—å) */
        .option-card { 
            border: 2px solid #eee; padding: 12px; margin-bottom: 8px; border-radius: 10px; 
            display: flex; align-items: center; cursor: pointer; transition: all 0.2s; 
            background: #fff;
        }
        .option-card input { width: 22px; height: 22px; margin-right: 15px; flex-shrink: 0; }
        .option-card.checked { border-color: var(--primary); background-color: #f0f9ff; }

        /* –û—à–∏–±–∫–∏ */
        .error-msg { 
            color: #fff; background: var(--error); padding: 12px; border-radius: 8px; 
            margin-top: 20px; text-align: center; display: none; font-weight: bold; 
        }
        .highlight-error { 
            border: 2px solid var(--error) !important; 
            background-color: #fff5f5 !important;
        }

        /* –¢–∞–±–ª–∏—Ü—ã –∏ –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { padding: 10px; text-align: center; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; font-size: 0.9rem; color: #555; }
        td:first-child { text-align: left; font-weight: 500; }
        
        /* –ú–û–ë–ò–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø */
        @media (max-width: 600px) {
            .container { padding: 15px; }
            table, thead, tbody, th, td, tr { display: block; }
            thead tr { position: absolute; top: -9999px; left: -9999px; }
            tr { border: 1px solid #e0e0e0; border-radius: 12px; margin-bottom: 15px; padding: 15px; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
            td { border: none; padding: 5px 0; text-align: left; }
            td:first-child { 
                font-weight: 600; border-bottom: 1px solid #eee; margin-bottom: 10px; 
                padding-bottom: 10px; text-align: center; font-size: 1.05rem; color: var(--primary); 
            }
            /* –†–∞–¥–∏–æ–∫–Ω–æ–ø–∫–∏ –≤ —Ä—è–¥ */
            td:not(:first-child) { display: inline-block; width: 22%; text-align: center; vertical-align: top; }
            td:not(:first-child)::before { 
                content: attr(data-label); display: block; font-size: 0.75em; color: #7f8c8d; margin-bottom: 4px; font-weight: 600; 
            }
            input[type="radio"] { width: 24px; height: 24px; margin: 0; }
        }

        .progress-bar { height: 6px; background: #e9ecef; border-radius: 3px; margin-bottom: 20px; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }
        
        /* –ë–ª–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ */
        #result-area { width: 100%; height: 100px; margin-top: 10px; font-size: 12px; padding: 10px; border: 1px solid #ddd; display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>

    <!-- –ê–ù–ö–ï–¢–ê -->
    <div class="step active" id="step-form">
        <h1>–ê–Ω–∫–µ—Ç–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞</h1>
        <p class="subtitle">–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã</p>
        
        <div class="form-group"><label>–§–ò–û: *</label><input type="text" id="fio" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" onchange="saveState()"></div>
        
        <div style="display: flex; gap: 10px;">
            <div class="form-group" style="flex: 1;"><label>–ü–æ–ª: *</label>
                <select id="gender" onchange="saveState()"><option value="">–í—ã–±—Ä–∞—Ç—å...</option><option value="–ú—É–∂—Å–∫–æ–π">–ú—É–∂—Å–∫–æ–π</option><option value="–ñ–µ–Ω—Å–∫–∏–π">–ñ–µ–Ω—Å–∫–∏–π</option></select>
            </div>
            <div class="form-group" style="flex: 1;"><label>–í–æ–∑—Ä–∞—Å—Ç: *</label>
                <input type="number" id="age" placeholder="18" onchange="saveState()">
            </div>
        </div>

        <div class="form-group"><label>–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: *</label>
            <select id="family_status" onchange="saveState()">
                <option value="">–í—ã–±—Ä–∞—Ç—å...</option>
                <option value="–•–æ–ª–æ—Å—Ç/–ù–µ –∑–∞–º—É–∂–µ–º">–•–æ–ª–æ—Å—Ç / –ù–µ –∑–∞–º—É–∂–µ–º</option>
                <option value="–ñ–µ–Ω–∞—Ç/–ó–∞–º—É–∂–µ–º">–ñ–µ–Ω–∞—Ç / –ó–∞–º—É–∂–µ–º</option>
                <option value="–í —Ä–∞–∑–≤–æ–¥–µ">–í —Ä–∞–∑–≤–æ–¥–µ</option>
            </select>
        </div>
        
        <div class="form-group"><label>–ï—Å—Ç—å –ª–∏ –¥–µ—Ç–∏? *</label>
            <select id="children" onchange="saveState()"><option value="–ù–µ—Ç">–ù–µ—Ç</option><option value="–î–∞">–î–∞</option></select>
        </div>

        <div class="form-group"><label>–†–∞–±–æ—Ç–∞–µ—Ç–µ –ª–∏ –í—ã? *</label>
            <select id="is_working" onchange="toggleWorkPlace(); saveState()"><option value="–ù–µ—Ç">–ù–µ—Ç</option><option value="–î–∞">–î–∞</option></select>
        </div>
        <div class="form-group" id="work_place_block" style="display: none;">
            <label>–ì–¥–µ —Ä–∞–±–æ—Ç–∞–µ—Ç–µ? (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label><input type="text" id="work_place" onchange="saveState()">
        </div>

        <div class="form-group"><label>–°—Ä–µ–¥–Ω–µ–µ —Å–ø–µ—Ü. –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ? *</label>
            <select id="has_secondary_edu" onchange="saveState()"><option value="–ù–µ—Ç">–ù–µ—Ç</option><option value="–î–∞">–î–∞</option></select>
        </div>

        <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ –í–£–ó–∞: *</label><input type="text" id="university" onchange="saveState()"></div>
        <div class="form-group"><label>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å: *</label><input type="text" id="speciality" onchange="saveState()"></div>
        
        <div style="display: flex; gap: 10px;">
             <div class="form-group" style="flex: 1;"><label>–£—Ä–æ–≤–µ–Ω—å: *</label>
                <select id="edu_level" onchange="saveState()"><option value="–ë–∞–∫–∞–ª–∞–≤—Ä–∏–∞—Ç">–ë–∞–∫–∞–ª–∞–≤—Ä–∏–∞—Ç</option><option value="–ú–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞">–ú–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞</option><option value="–°–ø–µ—Ü–∏–∞–ª–∏—Ç–µ—Ç">–°–ø–µ—Ü–∏–∞–ª–∏—Ç–µ—Ç</option></select>
            </div>
             <div class="form-group" style="flex: 1;"><label>–û—Å–Ω–æ–≤–∞: *</label>
                <select id="edu_basis" onchange="saveState()"><option value="–ë—é–¥–∂–µ—Ç">–ë—é–¥–∂–µ—Ç</option><option value="–ü–ª–∞—Ç–Ω–æ–µ">–ü–ª–∞—Ç–Ω–æ–µ</option></select>
            </div>
        </div>
        <div class="form-group"><label>–ö—É—Ä—Å: *</label>
            <select id="course" onchange="saveState()"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select>
        </div>

        <div class="error-msg" id="form-error">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!</div>
        <button class="btn" onclick="validateForm()">–î–∞–ª–µ–µ</button>
        <p style="text-align:center; font-size:0.8em; margin-top:15px; color:#999">–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
    </div>

    <!-- –ë–†–ê–¢–£–°–¨ -->
    <div class="step" id="step-bratus">
        <h2>1/3. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–µ —Å–º—ã—Å–ª—ã</h2>
        <p class="subtitle" id="bratus-sub">–í—ã–±–µ—Ä–∏—Ç–µ 3 —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</p>
        <div id="bratus-options"></div>
        <div class="error-msg" id="bratus-error">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–≤–Ω–æ 3 –ø—É–Ω–∫—Ç–∞!</div>
        <button class="btn" onclick="nextBratusRank()">–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥</button>
    </div>

    <!-- –ú–ò–õ–¨–ú–ê–ù -->
    <div class="step" id="step-milman">
        <h2>2/3. –ú–æ—Ç–∏–≤–∞—Ü–∏—è</h2>
        <p class="subtitle">–í–∞—Ä–∏–∞–Ω—Ç—ã: <b>++</b>(–î–∞) <b>+</b>(–ü–æ–∂–∞–ª—É–π) <b>=</b>(–ö–æ–≥–¥–∞ –∫–∞–∫) <b>?</b>(–ù–µ—Ç)</p>
        <div id="milman-container"></div>
        <div class="error-msg" id="milman-error">–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –ø–æ–¥—Å–≤–µ—á–µ–Ω–Ω—ã–µ –∫—Ä–∞—Å–Ω—ã–º!</div>
        <button class="btn" onclick="finishMilman()">–î–∞–ª–µ–µ</button>
    </div>

    <!-- –ò–ü–õ -->
    <div class="step" id="step-ipl">
        <h2>3/3. –ò–Ω–Ω–æ–≤–∞—Ü–∏–∏</h2>
        <p class="subtitle">–û—Ü–µ–Ω–∏—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ –æ—Ç 1 (–ù–µ—Ç) –¥–æ 5 (–î–∞)</p>
        <div id="ipl-container"></div>
        <div class="error-msg" id="ipl-error">–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –ø–æ–¥—Å–≤–µ—á–µ–Ω–Ω—ã–µ –∫—Ä–∞—Å–Ω—ã–º!</div>
        <button class="btn btn-success" onclick="finishSurvey()">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
    </div>

    <!-- –§–ò–ù–ê–õ -->
    <div class="step" id="step-final" style="text-align: center;">
        <h1 style="color:var(--success)">–ì–æ—Ç–æ–≤–æ!</h1>
        <p>–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω.</p>
        
        <button class="btn btn-success" onclick="downloadJSON()">üì• –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</button>
        <p style="font-size: 0.9em; color:#666; margin-top:5px;">(–û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—é)</p>

        <div style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
            <p>–ù–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª?</p>
            <button class="btn btn-secondary" onclick="copyResult()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</button>
            <textarea id="result-area" readonly></textarea>
            <p id="copy-msg" style="color:var(--success); display:none; font-weight:bold;">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! –í—Å—Ç–∞–≤—å—Ç–µ –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—é.</p>
        </div>
    </div>
</div>

<script>
// –î–ê–ù–ù–´–ï
const bratus_stmts=[{id:1,t:"–ø–æ–º–æ–≥–∞—Ç—å –¥—Ä—É–≥–∏–º –ª—é–¥—è–º"},{id:2,t:"–±—ã—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–º"},{id:3,t:"–ø–æ–ª—É—á–∞—Ç—å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ"},{id:4,t:"—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å—Å—è"},{id:5,t:"–¥–æ–±–∏–≤–∞—Ç—å—Å—è —É—Å–ø–µ—Ö–∞"},{id:6,t:"–±—ã—Ç—å —Å –±–ª–∏–∑–∫–∏–º —á–µ–ª–æ–≤–µ–∫–æ–º"},{id:7,t:"–ø–µ—Ä–µ–¥–∞—Ç—å –ª—É—á—à–µ–µ –¥–µ—Ç—è–º"},{id:8,t:"–ø–æ–Ω—è—Ç—å —Å–µ–±—è"},{id:9,t:"–¥–µ–ª–∞—Ç—å –¥–æ–±—Ä–æ"},{id:10,t:"–∂–∏—Ç—å"},{id:11,t:"–∏—Å–ø—ã—Ç—ã–≤–∞—Ç—å —Å—á–∞—Å—Ç—å–µ"},{id:12,t:"–æ—Å—É—â–µ—Å—Ç–≤–∏—Ç—å —Å–µ–±—è"},{id:13,t:"—Å–¥–µ–ª–∞—Ç—å –∫–∞—Ä—å–µ—Ä—É"},{id:14,t:"—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å, —á—Ç–æ –Ω—É–∂–µ–Ω"},{id:15,t:"–∂–∏—Ç—å —Ä–∞–¥–∏ —Å–µ–º—å–∏"},{id:16,t:"–ø–æ–∑–Ω–∞–≤–∞—Ç—å –ë–æ–≥–∞"},{id:17,t:"—É–ª—É—á—à–∞—Ç—å –º–∏—Ä"},{id:18,t:"–ª—é–±–∏—Ç—å"},{id:19,t:"–ø–æ–ª—É—á–∞—Ç—å –æ—â—É—â–µ–Ω–∏—è"},{id:20,t:"—Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏"},{id:21,t:"–∑–∞–Ω–∏–º–∞—Ç—å –ø–æ–ª–æ–∂–µ–Ω–∏–µ"},{id:22,t:"—Ä–∞–¥–æ–≤–∞—Ç—å—Å—è –æ–±—â–µ–Ω–∏—é"},{id:23,t:"–ø–æ–º–æ–≥–∞—Ç—å —Ä–æ–¥–Ω—ã–º"},{id:24,t:"–ø–æ–Ω—è—Ç—å –∂–∏–∑–Ω—å"}];
const milman_qs=[{q:"–ü—Ä–∏–Ω—Ü–∏–ø—ã –≤ –∂–∏–∑–Ω–∏:",i:["–í—Ä–µ–º—è - –¥–µ–Ω—å–≥–∏","–ì–ª–∞–≤–Ω–æ–µ - –∑–¥–æ—Ä–æ–≤—å–µ","–í—Ä–µ–º—è —Å –¥—Ä—É–∑—å—è–º–∏","–í—Ä–µ–º—è —Å–µ–º—å–µ","–î–µ–ª–∞—Ç—å –¥–æ–±—Ä–æ","–ú–µ—Å—Ç–æ –ø–æ–¥ —Å–æ–ª–Ω—Ü–µ–º","–ü—Ä–∏–æ–±—Ä–µ—Ç–∞—Ç—å –∑–Ω–∞–Ω–∏—è","–û—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤–æ–µ"]},{q:"–ü—Ä–∏–Ω—Ü–∏–ø—ã –Ω–∞ —Ä–∞–±–æ—Ç–µ:",i:["–í—ã–Ω—É–∂–¥–µ–Ω–Ω–∞—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å","–ù–µ –¥–æ–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤","–°–ø–æ–∫–æ–π–Ω—ã–µ —É—Å–ª–æ–≤–∏—è","–°–ª—É–∂–µ–±–Ω–æ–µ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ","–ó–∞–≤–æ–µ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç","–°–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å—Å—è","–ù–∞–π—Ç–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ","–£–≤–ª–µ—á—å –¥—Ä—É–≥–∏—Ö"]},{q:"–î–µ–ª–∞ –≤ —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è:",i:["–î–æ–º–∞—à–Ω–∏–µ","–û—Ç–¥—ã—Ö","–î—Ä—É–∑—å—è","–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ","–î–µ—Ç–∏","–£—á–µ–±–∞","–•–æ–±–±–∏","–ü–æ–¥—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ"]},{q:"–ú–µ—Å—Ç–æ –≤ —Ä–∞–±–æ—Ç–µ –∑–∞–Ω–∏–º–∞—é—Ç:",i:["–î–µ–ª–æ–≤–æ–µ –æ–±—â–µ–Ω–∏–µ","–õ–∏—á–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ","–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞","–£—á–µ–±–∞","–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ","–ó–∞—Ä–∞–±–æ—Ç–æ–∫","–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å","–ü–µ—Ä–µ–∫—É—Ä—ã"]},{q:"–õ–∏—à–Ω–∏–π –≤—ã—Ö–æ–¥–Ω–æ–π –ø–æ—Ç—Ä–∞—á—É –Ω–∞:",i:["–î–æ–º","–û—Ç–¥—ã—Ö","–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞","–£—á–µ–±–∞","–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ","–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –¥–µ–ª–æ","–ó–∞—Ä–∞–±–æ—Ç–æ–∫"]},{q:"–ü—Ä–∏ —Å–≤–æ–±–æ–¥–Ω–æ–º –≥—Ä–∞—Ñ–∏–∫–µ –∑–∞–π–º—É—Å—å:",i:["–û–±—è–∑–∞–Ω–Ω–æ—Å—Ç—è–º–∏","–î–µ–ª–æ–≤—ã–º –æ–±—â–µ–Ω–∏–µ–º","–õ–∏—á–Ω—ã–º –æ–±—â–µ–Ω–∏–µ–º","–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–æ–π","–£—á–µ–±–æ–π","–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ–º","–ü–æ–ª–µ–∑–Ω–æ–π —Ä–∞–±–æ—Ç–æ–π","–ó–∞—Ä–∞–±–æ—Ç–∫–æ–º"]},{q:"–¢–µ–º—ã —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤ —Å –¥—Ä—É–∑—å—è–º–∏:",i:["–ü–æ–∫—É–ø–∫–∏/—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","–û–±—â–∏–µ –∑–Ω–∞–∫–æ–º—ã–µ","–í–æ–∫—Ä—É–≥ –Ω–∞—Å","–£—Å–ø–µ—Ö","–†–∞–±–æ—Ç–∞","–£–≤–ª–µ—á–µ–Ω–∏—è","–ü–ª–∞–Ω—ã","–ü–æ–ª–∏—Ç–∏–∫–∞/–∫–Ω–∏–≥–∏"]},{q:"–†–∞–±–æ—Ç–∞ –¥–∞–µ—Ç –º–Ω–µ:",i:["–°—Ä–µ–¥—Å—Ç–≤–∞","–û–±—â–µ–Ω–∏–µ","–ê–≤—Ç–æ—Ä–∏—Ç–µ—Ç","–í—Å—Ç—Ä–µ—á–∏","–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏–µ","–ü–æ–ª–µ–∑–Ω–æ—Å—Ç—å","–ü—Ä–æ—Ñ. —É—Ä–æ–≤–µ–Ω—å","–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ"]},{q:"–•–æ—á—É –æ–±—â–µ—Å—Ç–≤–æ, –≥–¥–µ:",i:["–£—é—Ç–Ω–æ","–†–∞–±–æ—á–∏–µ —Ç–µ–º—ã","–£–≤–∞–∂–∞—é—Ç","–ü–æ–ª–µ–∑–Ω—ã–µ —Å–≤—è–∑–∏","–ù–æ–≤—ã–µ –¥—Ä—É–∑—å—è","–ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ª—é–¥–∏","–û–±—â–µ–µ –¥–µ–ª–æ","–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏"]},{q:"–•–æ—á—É –ª—é–¥–µ–π —Ä—è–¥–æ–º:",i:["–†–∞–∑–Ω—ã–µ —Ç–µ–º—ã","–ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –æ–ø—ã—Ç","–ë–æ–ª—å—à–µ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å","–ê–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ","–ù–∞—É—á–∞—Ç –ø–æ–ª–µ–∑–Ω–æ–º—É","–ê–∫—Ç–∏–≤–Ω—ã–µ","–ó–Ω–∞—é—â–∏–µ","–ü–æ–¥–¥–µ—Ä–∂–∞—Ç"]},{q:"–ò–º–µ—é –≤ –¥–æ—Å—Ç–∞—Ç–∫–µ:",i:["–ú–∞—Ç. –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ","–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","–£—Å–ª–æ–≤–∏—è –∂–∏–∑–Ω–∏","–°–µ–º—å—é","–û–±—â–µ–Ω–∏–µ","–£–≤–∞–∂–µ–Ω–∏–µ","–ü–æ–ª–µ–∑–Ω–æ—Å—Ç—å","–¶–µ–Ω–Ω–æ–µ"]},{q:"–ò–º–µ—é –≤ —Ä–∞–±–æ—Ç–µ:",i:["–ó–∞—Ä–ø–ª–∞—Ç—É","–£—Å–ª–æ–≤–∏—è","–ö–æ–ª–ª–µ–∫—Ç–∏–≤","–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è","–î–æ–ª–∂–Ω–æ—Å—Ç—å","–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å","–ê–≤—Ç–æ—Ä–∏—Ç–µ—Ç","–ü—Ä–æ—Ñ. —É—Ä–æ–≤–µ–Ω—å"]},{q:"–ù—Ä–∞–≤–∏—Ç—Å—è, –∫–æ–≥–¥–∞:",i:["–ù–µ—Ç –∑–∞–±–æ—Ç","–ö–æ–º—Ñ–æ—Ä—Ç","–í–µ—Å–µ–ª–∞—è —Å—É–µ—Ç–∞","–í–µ—Å–µ–ª–æ–µ –æ–±—â–µ—Å—Ç–≤–æ","–°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ","–ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ","–ü–æ–≥—Ä—É–∂–µ–Ω –≤ —Ä–∞–±–æ—Ç—É","–°–æ–≤–º–µ—Å—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞"]},{q:"–ü—Ä–∏ –Ω–µ—É–¥–∞—á–µ —è:",i:["–†–∞—Å—Å—Ç—Ä–∞–∏–≤–∞—é—Å—å","–ü–µ—Ä–µ–∫–ª—é—á–∞—é—Å—å","–¢–µ—Ä—è—é—Å—å","–ó–ª—é—Å—å –Ω–∞ –ø–æ–º–µ—Ö—É","–°–ø–æ–∫–æ–µ–Ω","–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é","–í–∏–Ω–æ–≤–∞—Ç —Å–∞–º","–ò—â—É –ø—Ä–∏—á–∏–Ω—ã"]}];
const ipl_qs=["–ó–Ω–∞–Ω–∏—è –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –∫–Ω–∏–≥","–ë—É–¥—É—â–µ–µ –Ω–µ –ø—É–≥–∞–µ—Ç","–°–º–æ–≥ –±—ã –∑–∞–Ω—è—Ç—å—Å—è —ç–∫—Å—Ç—Ä–∏–º–æ–º","–õ–µ–≥–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—é—Å—å –Ω–∞ —Ä–∞–±–æ—Ç—É","–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ ‚Äì –ø—Ä–∏—á–∏–Ω–∞ —É—á–∏—Ç—å—Å—è","–ü–µ—Ä–µ–º–µ–Ω—ã –Ω–µ —Ç—Ä–µ–≤–æ–∂–∞—Ç","–ß–µ–ª–æ–≤–µ–∫ –Ω–µ –≤ –æ—Ç–≤–µ—Ç–µ –∑–∞ —ç–∫–æ–ª–æ–≥–∏—é","–ó–∞–º–µ—á–∞—é –ø–µ—Ä–µ–º–µ–Ω—ã –Ω–∞ –¥–æ—Ä–æ–≥–µ","–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–µ–¥—É—Ç –∫ –∫—Ä–∏–∑–∏—Å—É","–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–∞–±–æ—Ç–µ –≤—Ä–µ–¥—è—Ç","–õ–µ–≥–∫–æ –Ω–∞—Ö–æ–∂—É –æ–±—â–∏–π —è–∑—ã–∫","–ù–µ –≤–∞–∂–Ω–æ –º–µ—Å—Ç–æ –æ—Ç–¥—ã—Ö–∞","–ß–∏—Ç–∞—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –∞–≤—Ç–æ—Ä–æ–≤","–ú–Ω–æ–≥–æ –Ω–æ–≤–æ–≥–æ ‚Äì –º–∞–ª–æ —Ö–æ—Ä–æ—à–µ–≥–æ","–¢—Ä—É–¥–Ω–æ –≤–∑—è—Ç—å—Å—è –∑–∞ –Ω–æ–≤–æ–µ","–ö—É–ª—å—Ç—É—Ä–∞ —Ç–æ–ª—å–∫–æ —Å –≤/–æ","–°–º–µ–Ω—é —Ä–∞–±–æ—Ç—É, –µ—Å–ª–∏ –ø—Ä–æ—Ç–∏–≤ –º–æ—Ä–∞–ª–∏","–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∂–∏–≤–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ","–°–ª—É—à–∞—é —Ä–∏—Ç–º –º–∏—Ä–∞","–í–∞–∂–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞","–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–ø—Ä–æ—Å–∏—Ç—å —Å–ø–µ—Ü–æ–≤","–î—Ä—É–≥ –Ω–µ –∏–∑–º–µ–Ω–∏—Ç —Å–∏–º–ø–∞—Ç–∏–∏","–ò–Ω—Ç–µ—Ä–µ—Å—É—é—Å—å —Ç—Ä–∞–¥–∏—Ü–∏—è–º–∏ –¥—Ä—É–≥–∏—Ö","–ù–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—É","–õ—É—á—à–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å","–¢—Ä—É–¥–Ω–æ –ø—Ä–∏–≤—ã–∫–∞—é –∫ –∫–æ–ª–ª–µ–∫—Ç–∏–≤—É","–°–∫–µ–ø—Ç–∏–∫ –∫ –Ω–æ–≤–æ–º—É –≤ –∏—Å–∫—É—Å—Å—Ç–≤–µ","–í—Ä–µ–º—è –±—ã—Å—Ç—Ä–æ—Ç–µ—á–Ω–æ","–†–∞–¥—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è","–ù–µ –ø—É–≥–∞–µ—Ç –Ω–æ–≤–∞—è —Å—Ñ–µ—Ä–∞","–ú–µ–Ω—è—é—Å—å —Ç–æ–ª—å–∫–æ –ø–æ –Ω—É–∂–¥–µ","–ù–µ —Å–ª–µ–∂—É –∑–∞ –ø–æ–ª–∏—Ç–∏–∫–æ–π","–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–∑–¥—Ä–∞–∂–∞—é—Ç","–ú–µ–Ω—è—é —Ä–µ—à–µ–Ω–∏—è","–û—Ä–∏–µ–Ω—Ç–∏—Ä—É—é—Å—å –Ω–∞ –º–µ—Å—Ç–Ω–æ—Å—Ç–∏","–û–±—Ä–∞—â—É –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞ –≤ –ø–æ–ª—å–∑—É"];

// –°–û–°–¢–û–Ø–ù–ò–ï (–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ LocalStorage)
let saved = localStorage.getItem('survey_state');
let state = saved ? JSON.parse(saved) : { meta: {}, bratus: {}, rank: 1, milman: {}, ipl: {}, timing: {start: Date.now(), milman_start:0, ipl_start:0} };

// –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ü–û–õ–ï–ô –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï
window.onload = function() {
    if(state.meta.fio) {
        for(let k in state.meta) {
            let el = document.getElementById(k);
            if(el) el.value = state.meta[k];
        }
        toggleWorkPlace();
    }
    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –Ω–∞—á–∞–ª —Ç–µ—Å—Ç, –ø–µ—Ä–µ–∫–∏–¥—ã–≤–∞–µ–º –µ–≥–æ
    if(state.rank > 1 || Object.keys(state.bratus).length > 0) {
        switchStep('step-form', 'step-bratus');
        renderBratus();
    }
};

function saveState() {
    localStorage.setItem('survey_state', JSON.stringify(state));
}

function toggleWorkPlace() {
    document.getElementById('work_place_block').style.display = (document.getElementById('is_working').value === "–î–∞") ? 'block' : 'none';
}

function validateForm() {
    const ids = ['fio','gender','age','family_status','children','is_working','has_secondary_edu','university','speciality','edu_level','edu_basis','course'];
    let valid = true;
    ids.forEach(id => {
        let val = document.getElementById(id).value;
        if(!val) { document.getElementById(id).style.borderColor = "var(--error)"; valid = false; }
        else { document.getElementById(id).style.borderColor = "#ddd"; state.meta[id] = val; }
    });
    
    if(!valid) { document.getElementById('form-error').style.display = 'block'; return; }
    state.meta.work_place = document.getElementById('work_place').value;
    state.meta.start_fmt = new Date().toLocaleString();
    
    saveState();
    switchStep('step-form', 'step-bratus');
    renderBratus();
}

function renderBratus() {
    const c = document.getElementById('bratus-options');
    c.innerHTML = "";
    document.getElementById('bratus-sub').innerHTML = `–í—ã–±–µ—Ä–∏—Ç–µ <b>3</b> —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è <b>${state.rank}-–≥–æ –º–µ—Å—Ç–∞</b>`;
    document.getElementById('progress').style.width = (state.rank/8*30)+"%";

    let used = [];
    for(let k in state.bratus) used = used.concat(state.bratus[k]);

    bratus_stmts.forEach(s => {
        if(!used.includes(s.id)) {
            let div = document.createElement('div');
            div.className = 'option-card';
            div.innerHTML = `<input type="checkbox" value="${s.id}"> ...${s.t}`;
            div.onclick = (e) => {
                if(e.target.tagName!=='INPUT') div.querySelector('input').click();
                div.classList.toggle('checked', div.querySelector('input').checked);
            };
            c.appendChild(div);
        }
    });
    window.scrollTo(0,0);
}

function nextBratusRank() {
    const ch = document.querySelectorAll('#bratus-options input:checked');
    if(ch.length !== 3) { document.getElementById('bratus-error').style.display = 'block'; return; }
    document.getElementById('bratus-error').style.display = 'none';
    
    state.bratus[state.rank] = Array.from(ch).map(i => parseInt(i.value));
    saveState();
    
    if(state.rank < 8) { state.rank++; renderBratus(); }
    else { 
        state.timing.milman_start = Date.now();
        switchStep('step-bratus', 'step-milman'); 
        renderMilman(); 
    }
}

function renderMilman() {
    const c = document.getElementById('milman-container');
    document.getElementById('progress').style.width = "60%";
    if(c.innerHTML) return; // –£–∂–µ –æ—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω–æ

    milman_qs.forEach((q, qi) => {
        let h = `<div class="q-block"><h3>${qi+1}. ${q.q}</h3><table>`;
        q.i.forEach((txt, ii) => {
            let nm = `m_${qi}_${ii}`;
            h += `<tr id="row_${nm}">
                <td>${txt}</td>
                <td data-label="++"><input type="radio" name="${nm}" value="3" onclick="saveM('${nm}',3)"></td>
                <td data-label="+"><input type="radio" name="${nm}" value="2" onclick="saveM('${nm}',2)"></td>
                <td data-label="="><input type="radio" name="${nm}" value="1" onclick="saveM('${nm}',1)"></td>
                <td data-label="?"><input type="radio" name="${nm}" value="0" onclick="saveM('${nm}',0)"></td>
            </tr>`;
        });
        c.innerHTML += h + "</table></div>";
    });
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç–≤–µ—Ç—ã
    for(let k in state.milman) {
        let el = document.querySelector(`input[name="m_${k}"][value="${state.milman[k]}"]`);
        if(el) el.checked = true;
    }
    window.scrollTo(0,0);
}

function saveM(key, val) {
    let k = key.replace('m_','');
    state.milman[k] = val;
    document.getElementById('row_'+key).classList.remove('highlight-error');
    saveState();
}

function finishMilman() {
    if(!validateGroup('m', 14, 8)) return;
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–ø–∏–¥—Ä–∞–Ω (–º–µ–Ω—å—à–µ 90 —Å–µ–∫ –Ω–∞ 112 –≤–æ–ø—Ä–æ—Å–æ–≤)
    let dur = (Date.now() - state.timing.milman_start)/1000;
    if(dur < 90) state.meta.flags = (state.meta.flags || "") + "FAST_MILMAN;";
    
    state.timing.ipl_start = Date.now();
    switchStep('step-milman', 'step-ipl');
    renderIPL();
}

function renderIPL() {
    const c = document.getElementById('ipl-container');
    document.getElementById('progress').style.width = "90%";
    if(c.innerHTML) return;

    let h = `<table>`;
    ipl_qs.forEach((txt, i) => {
        let nm = `ipl_${i}`;
        h += `<tr id="row_${nm}">
            <td>${i+1}. ${txt}</td>
            ${[1,2,3,4,5].map(v => `<td data-label="${v}"><input type="radio" name="${nm}" value="${v}" onclick="saveI(${i},${v})"></td>`).join('')}
        </tr>`;
    });
    c.innerHTML = h + "</table>";
    
    for(let k in state.ipl) {
        let el = document.querySelector(`input[name="ipl_${k}"][value="${state.ipl[k]}"]`);
        if(el) el.checked = true;
    }
    window.scrollTo(0,0);
}

function saveI(idx, val) {
    state.ipl[idx] = val;
    document.getElementById('row_ipl_'+idx).classList.remove('highlight-error');
    saveState();
}

function finishSurvey() {
    if(!validateGroup('ipl', 36, 1)) return;
    state.meta.end_fmt = new Date().toLocaleString();
    
    // –ß–∏—Å—Ç–∏–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω
    localStorage.removeItem('survey_state');
    
    switchStep('step-ipl', 'step-final');
    downloadJSON();
}

// –û–ë–©–ò–ï
function switchStep(f, t) {
    document.getElementById(f).classList.remove('active');
    setTimeout(() => document.getElementById(t).classList.add('active'), 200);
}

function validateGroup(prefix, c1, c2) {
    let firstErr = null;
    let container = prefix==='m' ? state.milman : state.ipl;
    
    if(c2 === 1) { // IPL
        for(let i=0; i<c1; i++) {
            if(container[i] === undefined) {
                let row = document.getElementById(`row_ipl_${i}`);
                row.classList.add('highlight-error');
                if(!firstErr) firstErr = row;
            }
        }
    } else { // Milman
        for(let q=0; q<c1; q++) {
            for(let i=0; i<c2; i++) {
                if(container[`${q}_${i}`] === undefined) {
                    let row = document.getElementById(`row_m_${q}_${i}`);
                    row.classList.add('highlight-error');
                    if(!firstErr) firstErr = row;
                }
            }
        }
    }
    
    if(firstErr) {
        firstErr.scrollIntoView({behavior:"smooth", block:"center"});
        document.getElementById(prefix==='m'?'milman-error':'ipl-error').style.display='block';
        return false;
    }
    return true;
}

function downloadJSON() {
    const fn = `Res_${state.meta.fio.replace(/[^–∞-—è–ê-–Øa-zA-Z0-9]/g,'_')}.json`;
    const txt = JSON.stringify(state, null, 2);
    const blob = new Blob([txt], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = fn;
    document.body.appendChild(a); a.click(); a.remove();
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
    document.getElementById('result-area').value = txt;
}

function copyResult() {
    let txt = document.getElementById('result-area');
    txt.style.display = 'block';
    txt.select();
    document.execCommand('copy');
    document.getElementById('copy-msg').style.display = 'block';
}
</script>
</body>
</html>
